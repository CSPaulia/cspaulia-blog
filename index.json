[{"content":"Post Training ä¸‰é˜¶æ®µ æ¥æºäº InstructGPT[1]\næ”¶é›†æ•°æ®å¹¶è®­ç»ƒç›‘ç£ç­–ç•¥ ä»æç¤ºè¯æ•°æ®é›†ä¸­é‡‡æ ·ä¸€ä¸ªæç¤ºè¯ æ ‡æ³¨è€…å¯¹æ•°æ®è¿›è¡Œæ ‡æ³¨ï¼ˆè¯¥æ ‡æ³¨å³ä¸ºæœŸæœ›è¾“å‡ºï¼‰ è¯¥æ ‡æ³¨æ•°æ®ç”¨äºå¯¹ LLM è¿›è¡Œç›‘ç£è®­ç»ƒ æ”¶é›†å¯¹æ¯”æ•°æ®å¹¶è®­ç»ƒå¥–åŠ±æ¨¡å‹ é‡‡æ ·ä¸€ä¸ªæç¤ºè¯åŠå¤šä¸ªæ¨¡å‹çš„è¾“å‡º æ ‡æ³¨è€…ä»â€œæœ€å¥½â€åˆ°â€œæœ€å·®â€å¯¹è¿™äº›è¾“å‡ºè¿›è¡Œæ’åº è¯¥æ ‡æ³¨æ•°æ®ç”¨äºå¯¹å¥–åŠ±æ¨¡å‹è¿›è¡Œè®­ç»ƒ åœ¨è®­ç»ƒå¥½çš„å¥–åŠ±æ¨¡å‹çš„åŠ æŒä¸‹åˆ©ç”¨å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–ç­–ç•¥ ä»æ•°æ®é›†ä¸­é‡‡ç”¨ä¸€ä¸ªæ–°çš„æç¤ºè¯ åˆ©ç”¨ç­–ç•¥ç”Ÿæˆä¸€ä¸ªè¾“å‡º å¥–åŠ±æ¨¡å‹è®¡ç®—è¾“å‡ºçš„å¥–åŠ±åˆ†æ•°ï¼ˆRewardï¼‰ æ ¹æ®å¥–åŠ±åˆ†æ•°åˆ©ç”¨ PPO ç­‰å¼ºåŒ–å­¦ä¹ æ–¹æ³•å¯¹ç­–ç•¥è¿›è¡Œæ›´æ–° SFT æ•°æ®é›†çš„æ„å»º æ•°æ®é›†ä¸­çš„é—®é¢˜ æ¥è‡ª FLAN æ•°æ®é›†çš„ä¸€ä¸ªä¾‹å­:\nWhat is this text about? OPTIONS: - World - Sport - Business - Science/Tech\nè‡ªç„¶çš„å¯¹è¯ä¸€èˆ¬ä¸åŒ…å«è¿™æ ·çš„é€‰é¡¹ æ¥è‡ª OpenAssistant çš„ä¾‹å­:\nQuestion: Can you write a short introduction about the relevance of the term\u0026quot;monopsony\u0026quot; in economics? Please use examples related to potential monopsonies in the labour market and cite relevant research.\nAnswer: \u0026ldquo;Monopsony\u0026rdquo; refers to a market structure where there is only one buyer for a particular good or service. In economics, this term is particularly relevant in the labor market, where a monopsony employer has significant power over the wages and working conditions of their employees. [\u0026hellip;]. Overall, the concept of monopsony is essential to understanding the dynamics of labor markets and the impact of market power on workers. Further research is needed to understand the extent and impact of monopsonies on the economy and to develop policies to address this issue. References: Bivens, J., \u0026amp; Mishel, L.(2013). The Pay of Corporate Executives and Financial Professionals as Evidence of Rents in Top 1 Percent Incomes. Journal of Economic Perspectives, 27(3), 57-78.\näººç±»æ ‡æ³¨è€…å¾ˆéš¾æ’°å†™å¦‚æ­¤é•¿è€Œè¯¦ç»†çš„ç­”æ¡ˆ è¾“å‡ºä¸­çš„ç¬¦å·ï¼ˆç”šè‡³é£æ ¼ï¼‰å¦‚ä½•æŠ‰æ‹© æ˜¯å¦è¾“å‡ºå‚è€ƒæ–‡çŒ® å¦‚ä½•è¾“å‡ºå‡†ç¡®çš„å‚è€ƒæ–‡çŒ®ï¼šæˆ‘ä»¬å¾€å¾€å¸Œæœ›æ¨¡å‹èƒ½å¤Ÿè¾“å‡ºæ›´åŠ ä¸¥è°¨ã€å­¦æœ¯çš„è¾“å‡ºï¼Œå› æ­¤æˆ‘ä»¬ä¼šåœ¨æ•°æ®é›†çš„å›ç­”ä¸­åŠ å…¥å‚è€ƒæ–‡çŒ®ï¼Œä½†æ˜¯æ¨¡å‹å¯èƒ½åªå­¦åˆ°äº†â€œè¾“å‡ºå†…å®¹è¦åŠ ä¸Šå‚è€ƒæ–‡çŒ®â€ï¼Œè¿™ä¼šå¯¼è‡´æ¨¡å‹äº§ç”Ÿå¹»è§‰ï¼ˆHallucinationï¼‰ æ˜¯å¦è¾“å‡ºå¤æ‚çš„çŸ¥è¯† æ•°æ®é›†çš„è§„æ¨¡å¤§å° æ•°æ®é›†çš„å®‰å…¨é—®é¢˜ å¦‚ä½•å†³å®šæ¨¡å‹è¾“å‡ºçš„é•¿çŸ­ï¼šé€šè¿‡ä¸‹å›¾ä½ å¯ä»¥å‘ç°ï¼Œä¸åŒæŒ‡ä»¤æ•°æ®çš„è¾“å…¥å’Œè¾“å‡ºé•¿åº¦åŒºåˆ«æ˜¯å¾ˆå¤§çš„ SFT æ•°æ®é›†æ„å»ºç»éªŒ SFT åœ¨æ¨¡å‹å·²ç»å…·å¤‡æŸäº›èƒ½åŠ›çš„å‰æä¸‹ï¼Œé€šè¿‡æ•°æ®æ¥â€œæŠ½å–â€è¿™äº›èƒ½åŠ›çš„è¡¨ç°æ•ˆæœæœ€å¥½ï¼›ä½†å¦‚æœè¯•å›¾ç”¨ SFT å»â€œæ·»åŠ â€æ¨¡å‹åŸæœ¬ä¸å…·å¤‡çš„æ–°è¡Œä¸ºï¼Œå¾€å¾€æ•ˆæœä¸ä½³ å¹¶ä¸æ˜¯æ‰€æœ‰äº‹å®æ­£ç¡®çš„æ•°æ®éƒ½ä¼šæå‡æ¨¡å‹è¡¨ç°ï¼Œæœ‰æ—¶å³ä½¿æ˜¯é«˜è´¨é‡çš„äº‹å®æ•°æ®ï¼Œä¹Ÿå¯èƒ½å¹²æ‰°æ¨¡å‹å·²æœ‰çš„åˆ†å¸ƒæˆ–å¯¹é½ï¼Œåè€Œè®©æ€§èƒ½ä¸‹é™ æŸäº›ç±»å‹çš„æ•°æ®ï¼ˆä¾‹å¦‚å®‰å…¨æ€§ã€éµå¾ªæŒ‡ä»¤ã€é£æ ¼ç­‰ï¼‰å“ªæ€•åªæœ‰å°‘é‡ï¼Œä¹Ÿèƒ½å¯¹æ¨¡å‹å¸¦æ¥å·¨å¤§æå‡ï¼Œä¸è¿‡ï¼Œæ¨¡å‹çš„é•¿å°¾è¡Œä¸ºï¼ˆè¦†ç›–é¢å¹¿ã€ç¨€ç–åˆ†å¸ƒçš„åœºæ™¯ï¼‰åˆ™æ›´ä¾èµ–äºå¤§é‡æ•°æ®æ¥æ”¹å–„ åœ¨é¢„è®­ç»ƒä¸­ä½¿ç”¨æŒ‡ä»¤å¾®è°ƒï¼ˆInstruction Tuningï¼‰ åœ¨ç½‘é¡µæˆ–é¢„è®­ç»ƒæ•°æ®é›†ä¸Šè¿›è¡Œé¢„è®­ç»ƒ å°†æŒ‡ä»¤å¾®è°ƒæ•°æ®æ··å…¥é¢„è®­ç»ƒä¸­ é¢å¤–è¿›è¡Œä¸€ä¸ªç®€çŸ­çš„æŒ‡ä»¤å¾®è°ƒ \u0026lsquo;Midtraining\u0026rsquo; / \u0026lsquo;Two-phase Training\u0026rsquo; è¿™ç§æ–¹æ¡ˆ[2]å¥½ä¼¼å·²è¢«å¤§éƒ¨åˆ† LLM å…¬å¸é‡‡çº³ï¼ˆä½†æ²¡æœ‰è¯¦ç»†çš„æ–‡æ¡£ï¼‰ï¼š\nåœ¨ Stable é˜¶æ®µé‡‡ç”¨çº¯é¢„è®­ç»ƒæ•°æ®é›†è®­ç»ƒï¼ˆå¦‚ä¸Šå›¾å·¦ä¾§æ‰€ç¤ºï¼‰ï¼› åœ¨ Decay é˜¶æ®µé‡‡ç”¨é¢„è®­ç»ƒ+æŒ‡ä»¤å¾®è°ƒæ··åˆæ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼ˆå¦‚ä¸Šå›¾å³ä¾§æ‰€ç¤ºï¼‰ RLHFï¼ˆReinforcement Learning with Human Feedbackï¼‰ ä»æ¨¡ä»¿ï¼ˆImitationï¼‰åˆ°ä¼˜åŒ–ï¼ˆoptimizationï¼‰ æ¨¡ä»¿ï¼ˆImitationï¼Œå³SFTï¼‰ï¼šæ ¹æ®ä¸€äº›å‚è€ƒåˆ†å¸ƒ $p^*(y|x)$ è°ƒæ•´æ¨¡å‹çš„è¾“å‡ºåˆ†å¸ƒï¼Œä½¿å¾—è¾“å‡ºåˆ†å¸ƒ $\\hat{p}(y|x) \\approx p^*(y|x)$\nä»çº¯ç”Ÿæˆå»ºæ¨¡çš„è§’åº¦çœ‹ï¼ŒSFT å°±æ˜¯è®©ç”Ÿæˆæ¨¡å‹å­¦ä¼šæ¨¡ä»¿å‚è€ƒåˆ†å¸ƒ è®­ç»ƒéœ€è¦æ¥è‡ªå‚è€ƒç­–ç•¥çš„æ•°æ®ï¼ˆæ¯”å¦‚äººå·¥æ ‡æ³¨çš„æ•°æ®é›†ï¼‰ï¼Œå¦åˆ™æ— æ³•â€œæ¨¡ä»¿â€ ä¼˜åŒ–ï¼ˆOptimizationï¼Œå³RLHFï¼‰ï¼šä¸æ–­è°ƒæ•´è¾“å‡ºåˆ†å¸ƒ$\\hat{p}(y|x)$ï¼Œä½¿å¾— $\\max\\limits_{p} E_p[R(y,x)]$ï¼Œå…¶ä¸­ $R(y,x)$ ä¸ºå¥–åŠ±ï¼ˆRewardï¼‰\nä¼˜åŒ–çš„ä¸æ˜¯æŠ½è±¡çš„â€œçœŸå®åˆ†å¸ƒâ€ï¼Œè€Œæ˜¯ä¸€ä¸ªæˆ‘ä»¬èƒ½å®šä¹‰å¹¶æµ‹é‡çš„å¥–åŠ±å‡½æ•°ï¼ˆåœ¨ RLHF é‡Œï¼Œè¿™ä¸ªå¥–åŠ±å‡½æ•°æ¥è‡ªäººç±»åé¦ˆï¼Œæ¯”å¦‚äººç±»æ’åºã€åå¥½æ¯”è¾ƒï¼Œæˆ–è€…è®­ç»ƒå‡ºçš„ reward modelï¼‰ åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¸å†æŠŠè¯­è¨€æ¨¡å‹çœ‹ä½œâ€œè¿‘ä¼¼çœŸå®åˆ†å¸ƒ$p^*(y|x)$çš„æ¨¡å‹â€ï¼ˆåƒ SFT é‚£æ ·ï¼‰ï¼Œè€Œæ˜¯æŠŠå®ƒå½“ä½œä¸€ä¸ª ç­–ç•¥ policyï¼Œç”¨æ¥æœ€å¤§åŒ–å¥–åŠ±ä¿¡å· éœ€è¦RLHFçš„åŸå›  æˆæœ¬ï¼šSFT çš„æˆæœ¬éå¸¸é«˜æ˜‚ï¼Œå°¤å…¶æ˜¯æ ‡æ³¨æˆæœ¬ G-V Gap (Generation-Value Gap)ï¼šäººä»¬å†™çš„å†…å®¹ï¼ˆç”Ÿæˆåˆ†å¸ƒ Gï¼‰å’Œ äººä»¬å®é™…åå¥½çš„å†…å®¹ï¼ˆä»·å€¼æ¨¡å‹ V çš„è§†è§’ï¼‰å¹¶ä¸æ€»æ˜¯ä¸€è‡´ åœ¨ä¸€é¡¹è¿‡å»çš„å®éªŒ[3]ä¸­å‘ç°ï¼Œä¸€äº›æ ‡æ³¨è€…åœ¨å¯¹æ¯”è‡ªå·±å†™çš„æ‘˜è¦å’Œæ¨¡å‹å†™çš„æ‘˜è¦æ—¶ï¼Œæœ‰æ—¶ä¼šæ›´å–œæ¬¢æ¨¡å‹å†™çš„æ‘˜è¦ï¼Œä¹Ÿå°±æ˜¯è¯´äººç±»æ ‡æ³¨å¹¶ä¸æ˜¯æœ€ä¼˜çš„\nå¦‚ä½•è·å¾—RLHFçš„æ•°æ® æ–¹æ¡ˆä¸€ï¼šï¼ˆåœ¨ç½‘é¡µä¸Šï¼‰è®©æ¨¡å‹è¾“å‡º N ä¸ªç»“æœï¼Œè®©æ ‡æ³¨è€…ï¼ˆç”¨æˆ·ï¼‰å¯¹ç»“æœè¿›è¡Œæ’åº\nå­˜åœ¨çš„é—®é¢˜ï¼š æ ‡æ³¨ç»“æœå¯èƒ½æ˜¯ä½è´¨é‡çš„ã€ä¸æ­£ç¡®çš„ï¼Œç”šè‡³æ˜¯ç”¨å¤§é¢„è¨€æ¨¡å‹ç”Ÿæˆçš„ï¼Œè¿™å–å†³äºæ ‡æ³¨è€…æœ¬èº« RLHF æ ‡æ³¨è€…çš„åˆ†å¸ƒä¼šæå¤§çš„å½±å“æ¨¡å‹çš„è¡Œä¸º å¦‚æœæ ‡æ³¨è€…ä¸­äºšæ´²äººå¤šï¼Œåˆ™æ¨¡å‹ä¼šå€¾å‘äºè¾“å‡ºäºšæ´²é£æ ¼çš„ç»“æœ\nä¸åŒçš„æ ‡æ³¨è€…å…³æ³¨ç‚¹ä¸åŒ æœ‰äº›æ ‡æ³¨è€…æ›´å…³æ³¨æ ¼å¼ï¼Œæœ‰äº›æ ‡æ³¨è€…æ›´å…³æ³¨å†…å®¹\næ–¹æ¡ˆäºŒï¼šä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚GPT-4ï¼‰å¯¹æ¨¡å‹ï¼ˆå¯ä»¥æ˜¯å¤šä¸ªä¸åŒçš„æ¨¡å‹ï¼‰è¾“å‡ºçš„ N ä¸ªç»“æœè¿›è¡Œæ’åºï¼Œæˆ‘ä»¬å¸¸å¸¸ç§°ä¹‹ä¸º AI Feedback\nå®ç°RLHFçš„æ–¹æ³• å‚è€ƒæ–‡çŒ® Ouyang L, Wu J, Jiang X, et al. Training language models to follow instructions with human feedback[J]. Advances in neural information processing systems, 2022, 35: 27730-27744. Hu S, Tu Y, Han X, et al. Minicpm: Unveiling the potential of small language models with scalable training strategies[J]. arXiv preprint arXiv:2404.06395, 2024. Zhang T, Ladhak F, Durmus E, et al. Benchmarking large language models for news summarization[J]. Transactions of the Association for Computational Linguistics, 2024, 12: 39-57. ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/sft_rlhf/","summary":"\u003ch2 id=\"post-training-ä¸‰é˜¶æ®µ\"\u003ePost Training ä¸‰é˜¶æ®µ\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ¥æºäº InstructGPT\u003ca href=\"#ref1\"\u003e[1]\u003c/a\u003e\u003c/p\u003e\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg alt=\"stages\" loading=\"lazy\" src=\"/cspaulia-blog/posts/sft_rlhf/stage.png\"\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eæ”¶é›†æ•°æ®å¹¶è®­ç»ƒ\u003cstrong\u003eç›‘ç£\u003c/strong\u003eç­–ç•¥\n\u003cul\u003e\n\u003cli\u003eä»æç¤ºè¯æ•°æ®é›†ä¸­é‡‡æ ·ä¸€ä¸ªæç¤ºè¯\u003c/li\u003e\n\u003cli\u003eæ ‡æ³¨è€…å¯¹æ•°æ®è¿›è¡Œæ ‡æ³¨ï¼ˆè¯¥æ ‡æ³¨å³ä¸ºæœŸæœ›è¾“å‡ºï¼‰\u003c/li\u003e\n\u003cli\u003eè¯¥æ ‡æ³¨æ•°æ®ç”¨äºå¯¹ LLM è¿›è¡Œç›‘ç£è®­ç»ƒ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eæ”¶é›†\u003cstrong\u003eå¯¹æ¯”æ•°æ®\u003c/strong\u003eå¹¶è®­ç»ƒ\u003cstrong\u003eå¥–åŠ±æ¨¡å‹\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003eé‡‡æ ·ä¸€ä¸ªæç¤ºè¯åŠå¤šä¸ªæ¨¡å‹çš„è¾“å‡º\u003c/li\u003e\n\u003cli\u003eæ ‡æ³¨è€…ä»â€œæœ€å¥½â€åˆ°â€œæœ€å·®â€å¯¹è¿™äº›è¾“å‡ºè¿›è¡Œæ’åº\u003c/li\u003e\n\u003cli\u003eè¯¥æ ‡æ³¨æ•°æ®ç”¨äºå¯¹å¥–åŠ±æ¨¡å‹è¿›è¡Œè®­ç»ƒ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eåœ¨\u003cstrong\u003eè®­ç»ƒå¥½çš„å¥–åŠ±æ¨¡å‹\u003c/strong\u003eçš„åŠ æŒä¸‹åˆ©ç”¨\u003cstrong\u003eå¼ºåŒ–å­¦ä¹ \u003c/strong\u003eä¼˜åŒ–ç­–ç•¥\n\u003cul\u003e\n\u003cli\u003eä»æ•°æ®é›†ä¸­é‡‡ç”¨ä¸€ä¸ªæ–°çš„æç¤ºè¯\u003c/li\u003e\n\u003cli\u003eåˆ©ç”¨ç­–ç•¥ç”Ÿæˆä¸€ä¸ªè¾“å‡º\u003c/li\u003e\n\u003cli\u003eå¥–åŠ±æ¨¡å‹è®¡ç®—è¾“å‡ºçš„å¥–åŠ±åˆ†æ•°ï¼ˆRewardï¼‰\u003c/li\u003e\n\u003cli\u003eæ ¹æ®å¥–åŠ±åˆ†æ•°åˆ©ç”¨ PPO ç­‰å¼ºåŒ–å­¦ä¹ æ–¹æ³•å¯¹ç­–ç•¥è¿›è¡Œæ›´æ–°\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"sft-æ•°æ®é›†çš„æ„å»º\"\u003eSFT æ•°æ®é›†çš„æ„å»º\u003c/h2\u003e\n\u003ch3 id=\"æ•°æ®é›†ä¸­çš„é—®é¢˜\"\u003eæ•°æ®é›†ä¸­çš„é—®é¢˜\u003c/h3\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ¥è‡ª FLAN æ•°æ®é›†çš„ä¸€ä¸ªä¾‹å­:\u003c/p\u003e\n\u003cp\u003eWhat is this text about? OPTIONS: - World - Sport - Business - Science/Tech\u003c/p\u003e\u003c/blockquote\u003e\n\u003cul\u003e\n\u003cli\u003eè‡ªç„¶çš„å¯¹è¯ä¸€èˆ¬ä¸åŒ…å«è¿™æ ·çš„é€‰é¡¹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ¥è‡ª OpenAssistant çš„ä¾‹å­:\u003c/p\u003e\n\u003cp\u003eQuestion: Can you write a short introduction about the relevance of the term\u0026quot;monopsony\u0026quot; in economics? Please use examples related to potential monopsonies in the labour market and cite relevant research.\u003c/p\u003e","title":"SFT and RLHF"},{"content":"æ·±åº¦å­¦ä¹ ä¸»è¦èµ„æº å†…å­˜ï¼ˆGBï¼‰ï¼šå­˜å‚¨å‚æ•°ã€æ¢¯åº¦ã€ä¼˜åŒ–å™¨çŠ¶æ€ã€æ¿€æ´»å€¼ç­‰ã€‚ è®¡ç®—é‡ï¼ˆFLOPsï¼‰ï¼šæµ®ç‚¹è¿ç®—æ¬¡æ•°ï¼Œè¡¡é‡è®­ç»ƒæ‰€éœ€çš„è®¡ç®—èµ„æºã€‚ 1. å¼ é‡åŸºç¡€ä¸å†…å­˜ç®¡ç† 1.1. å¼ é‡çš„åˆ›å»ºä¸å­˜å‚¨ å¼ é‡æ˜¯å­˜å‚¨å‚æ•°ã€æ¢¯åº¦ã€ä¼˜åŒ–å™¨çŠ¶æ€ã€æ•°æ®ã€æ¿€æ´»å€¼çš„åŸºæœ¬å•å…ƒ PyTorch æ”¯æŒå¤šç§æ–¹å¼åˆ›å»ºå¼ é‡ï¼ˆå¦‚ torch.zerosã€torch.onesã€torch.randn ç­‰ï¼‰ x = torch.tensor([[1., 2, 3], [4, 5, 6]]) # @inspect x x = torch.zeros(4, 8) # 4x8 matrix of all zeros @inspect x x = torch.ones(4, 8) # 4x8 matrix of all ones @inspect x x = torch.randn(4, 8) # 4x8 matrix of iid Normal(0, 1) samples @inspect x ä½ ä¹Ÿå¯ä»¥å…ˆåˆ†é…ç©ºé—´ï¼Œå†åˆ†é…æ•°å€¼ x = torch.empty(4, 8) # 4x8 matrix of uninitialized values @inspect x nn.init.trunc_normal_(x, mean=0, std=1, a=-2, b=2) # @inspect x å¼ é‡çš„å†…å­˜ç”±å…ƒç´ æ•°é‡å’Œæ•°æ®ç±»å‹å…±åŒå†³å®š 1.2. å¸¸è§æ•°æ®ç±»å‹ å‚æ•°ã€æ¢¯åº¦ã€æ¿€æ´»ä»¥åŠä¼˜åŒ–çŠ¶æ€å‡ ä¹å‡å­˜å‚¨ä¸ºæµ®ç‚¹æ•°\n1.2.1 float32ï¼ˆå•ç²¾åº¦ï¼‰ é»˜è®¤ç±»å‹ï¼Œ4 å­—èŠ‚ï¼ŒåŠ¨æ€èŒƒå›´å¤§ã€‚\nå†…å­˜æ˜¯ç”±(i)æ•°å€¼çš„æ•°é‡å’Œ(ii)æ•°å€¼çš„ç±»å‹å†³å®šçš„\nx = torch.zeros(4, 8) # @inspect x assert x.dtype == torch.float32 # Default type assert x.numel() == 4 * 8 assert x.element_size() == 4 # Float is 4 bytes assert get_memory_usage(x) == 4 * 8 * 4 # 128 bytes 1.2.2 float16ï¼ˆåŠç²¾åº¦ï¼‰ 2 å­—èŠ‚ï¼ŒèŠ‚çœå†…å­˜ä½†åŠ¨æ€èŒƒå›´å°ï¼Œæ˜“ä¸‹æº¢\nx = torch.zeros(4, 8, dtype=torch.float16) # @inspect x assert x.element_size() == 2 # Float is 2 bytes åŠ¨æ€èŒƒå›´ä¸ä½³ï¼ˆæ˜“ä¸‹æº¢ï¼‰\nx = torch.tensor([1e-8], dtype=torch.float16) # @inspect x assert x == 0 # Underflow! 1.2.3 bfloat16 2 å­—èŠ‚ï¼ŒåŠ¨æ€èŒƒå›´ä¸ float32 ç›¸åŒï¼Œç²¾åº¦ç•¥ä½\nä¸æ˜“ä¸‹æº¢ï¼š\nx = torch.tensor([1e-8], dtype=torch.bfloat16) # @inspect x assert x != 0 # No underflow! ä¸åŒæ•°æ®ç±»å‹çš„åŠ¨æ€èŒƒå›´ä»¥åŠå†…å­˜ä½¿ç”¨çš„æ¯”è¾ƒ:\nfloat32_info = torch.finfo(torch.float32) # @inspect float32_info float16_info = torch.finfo(torch.float16) # @inspect float16_info bfloat16_info = torch.finfo(torch.bfloat16) # @inspect bfloat16_info è¾“å‡ºï¼š\nfloat32 info=\u0026#34;finfo(resolution=1e-06,min=-3.40282e+38,max=3.40282e+38, eps=1.19209e-07,smallest normal=1.17549e-38,tiny=1.17549e-38dtype=float32)\u0026#34; float1l6 info=\u0026#34;finfo(resolution=0.001,min=-65504,max=65504, eps=0.000976562,sma1lest norma1=6.10352e-05,tiny=6.10352e-05,dtype=float16)\u0026#34; bfloat16 info=\u0026#34;finfo(resolution=0.01, min=-3.38953e+38,max=3.38953e+38, eps=0.0078125,smallest normal=1.17549e38, tiny=1.17549e-38,dtype=bfloat16)\u0026#34; 1.2.4 fp8 FP8ä½¿ç”¨æ–‡æ¡£\n1 å­—èŠ‚ï¼Œæè‡´å‹ç¼©ï¼Œé€‚åˆæ–°ä¸€ä»£ç¡¬ä»¶ï¼ˆå¦‚ H100ï¼‰\nH100sæ”¯æŒä¸¤ç§ç±»å‹çš„FP8: E4M3 (range [-448, 448]) and E5M2 ([-57344, 57344])\n1.2.5 æ··åˆç²¾åº¦è®­ç»ƒ TODO: æ›´æ–°æ··åˆç²¾åº¦è®­ç»ƒ\nä½¿ç”¨ä¸åŒçš„æ•°æ®ç±»å‹æ˜¯æœ‰ä¸€å®šçš„ä»£ä»·çš„ï¼š\né«˜ç²¾åº¦ï¼šæ›´å‡†ç¡®å’Œç¨³å®šï¼Œä½†æ˜¯éœ€è¦æ›´å¤šå†…å­˜å’Œæ›´å¤šè®¡ç®—åŠ› ä½ç²¾åº¦ï¼šä¸å‡†ç¡®ä¹Ÿä¸ç¨³å®šï¼Œä½†æ˜¯å†…å­˜å’Œç®—åŠ›éœ€æ±‚å‡å° ä¸€ç§æ··åˆç²¾åº¦è®­ç»ƒæ–¹æ³•ï¼š\nå‰å‘ä¼ æ’­ï¼ˆæ¿€æ´»è¿‡ç¨‹ï¼‰æ—¶ä½¿ç”¨ bfloat16, fp8 å¯¹å‚æ•°å’Œæ¢¯åº¦ä½¿ç”¨ float32 æ··åˆç²¾åº¦è®­ç»ƒè®ºæ–‡/æ··åˆç²¾åº¦è®­ç»ƒpytorchæ–‡æ¡£/æ··åˆç²¾åº¦è®­ç»ƒnvidiaæ–‡æ¡£\n2. è®¡ç®—èµ„æº 2.1. å¼ é‡æ“ä½œ 2.1.1. å­˜å‚¨ä¸è§†å›¾ å¼ é‡æ˜¯å†…å­˜æŒ‡é’ˆ+å…ƒæ•°æ®ï¼ˆæè¿°å¦‚ä½•ä»å¼ é‡ä¸­è·å–æ•°æ®ï¼Œå¦‚æ­¥å¹… strideï¼‰ pytorchä¸­å¯¹strideçš„å®šä¹‰\nå¯¹äºä¸€ä¸ªå¼ é‡ï¼š\nx = torch.tensor([ [0., 1, 2, 3], [4, 5, 6, 7], [8, 9, 10, 11], [12, 13, 14, 15], ]) ä¸ºäº†è·å–å¼ é‡çš„ä¸‹ä¸€è¡Œï¼ˆdim 0ï¼‰ï¼Œéœ€è·³è¿‡å­˜å‚¨ä¸­çš„4ä¸ªå…ƒç´ \nassert x.stride(0) == 4 ä¸ºäº†è·å–å¼ é‡çš„ä¸‹ä¸€åˆ—ï¼ˆdim 1ï¼‰ï¼Œéœ€è·³è¿‡å­˜å‚¨ä¸­çš„1ä¸ªå…ƒç´ \nassert x.stride(1) == 1 é€šè¿‡æ­¥å¹…å¯»æ‰¾å¼ é‡ä¸­çš„å…ƒç´ \nr, c = 1, 2 index = r * x.stride(0) + c * x.stride(1) # @inspect index assert index == 6 2.1.2. å¼ é‡åˆ‡ç‰‡ è®¸å¤šå¼ é‡æ“ä½œä»…ä»…æä¾›äº†ä¸€ä¸ªå¼ é‡çš„ä¸åŒè§†å›¾ï¼ˆviewï¼‰ï¼Œå®ƒä»¬å¾€å¾€ä¸è¿›è¡Œå¤åˆ¶ï¼ˆcopyï¼‰æ“ä½œï¼Œè¿™ä½¿å¾—åœ¨æŸä¸ªå¼ é‡ä¸Šè¿›è¡Œæ“ä½œä¼šå½±å“å…¶ä»–å¼ é‡\nx = torch.tensor([[1., 2, 3], [4, 5, 6]]) # @inspect x æ“ä½œä¸€ è·å¾— row 0\ndef same_storage(x: torch.Tensor, y: torch.Tensor): return x.untyped_storage().data_ptr() == y.untyped_storage().data_ptr() y = x[0] # @inspect y assert torch.equal(y, torch.tensor([1., 2, 3])) assert same_storage(x, y) æ“ä½œäºŒ è·å¾— column 1\ny = x[:, 1] # @inspect y assert torch.equal(y, torch.tensor([2, 5])) assert same_storage(x, y) æ“ä½œä¸‰ å°† 2x3 çŸ©é˜µè½¬æ¢ä¸º 3x2 çŸ©é˜µï¼ˆviewï¼‰\ny = x.view(3, 2) # @inspect y assert torch.equal(y, torch.tensor([[1, 2], [3, 4], [5, 6]])) assert same_storage(x, y) æ“ä½œå›› è½¬ç½®çŸ©é˜µï¼ˆtransposeï¼‰\ny = x.transpose(1, 0) # @inspect y assert torch.equal(y, torch.tensor([[1, 4], [2, 5], [3, 6]])) assert same_storage(x, y) æ“ä½œäº” ä¿®æ”¹xæ—¶ä¹Ÿä¼šä¿®æ”¹y\nx[0][0] = 100 # @inspect x, @inspect y assert y[0][0] == 100 æ“ä½œå…­ å­˜å‚¨è¿ç»­æ€§ï¼ˆcontiguousï¼‰\nä¸€äº›è½¬æ¢æ“ä½œï¼ˆviewï¼‰ä¼šå¯¼è‡´å¼ é‡è®¿é—®ä¸è¿ç»­ï¼Œè¿™ä¼šå¯¼è‡´æ— æ³•è¿›è¡Œåç»­çš„è½¬æ¢æ“ä½œ\nx = torch.tensor([[1., 2, 3], [4, 5, 6]]) # @inspect x y = x.transpose(1, 0) # @inspect y assert not y.is_contiguous() try: y.view(2, 3) assert False except RuntimeError as e: assert \u0026#34;view size is not compatible with input tensor\u0026#39;s size and stride\u0026#34; in str(e) å¯ä»¥å¼ºåˆ¶ä¸€ä¸ªå¼ é‡å˜ä¸ºè¿ç»­ï¼Œè¿™ä¼šå¯¼è‡´å¼€è¾Ÿæ–°çš„å­˜å‚¨ç©ºé—´\ny = x.transpose(1, 0).contiguous().view(2, 3) # @inspect y assert not same_storage(x, y) 2.1.3. å¼ é‡å…ƒç´ çº§æ“ä½œï¼ˆelementwiseï¼‰ è¿™äº›æ“ä½œä¼šå°†æ“ä½œåº”ç”¨äºå¼ é‡ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¤§å°ç›¸åŒçš„å¼ é‡\nx = torch.tensor([1, 4, 9]) assert torch.equal(x.pow(2), torch.tensor([1, 16, 81])) assert torch.equal(x.sqrt(), torch.tensor([1, 2, 3])) assert torch.equal(x.rsqrt(), torch.tensor([1, 1 / 2, 1 / 3])) # i -\u0026gt; 1/sqrt(x_i) assert torch.equal(x + x, torch.tensor([2, 8, 18])) assert torch.equal(x * 2, torch.tensor([2, 8, 18])) assert torch.equal(x / 0.5, torch.tensor([2, 8, 18])) triuæ„å»ºä¸€ä¸ªçŸ©é˜µçš„ä¸Šä¸‰è§’ï¼Œè¿™ä¸ªæ“ä½œåœ¨è®¡ç®—å› æœæ³¨æ„åŠ›æ©ç ï¼ˆcausal attention maskï¼‰æ—¶éå¸¸æœ‰ç”¨\nx = torch.ones(3, 3).triu() # @inspect x assert torch.equal(x, torch.tensor([ [1, 1, 1], [0, 1, 1], [0, 0, 1]], )) 2.1.4. å¼ é‡ä¹˜æ³• x = torch.ones(16, 32) w = torch.ones(32, 2) y = x @ w assert y.size() == torch.Size([16, 2]) é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šå°†ä¹˜æ³•æ“ä½œåº”ç”¨äº batch çš„æ¯ä¸€ä¸ªç¤ºä¾‹ï¼ˆexampleï¼‰ï¼Œä»¥åŠåºåˆ—ï¼ˆsequenceï¼‰ä¸­çš„æ¯ä¸€ä¸ª token ä¸­\nx = torch.ones(4, 8, 16, 32) ## [batch, sequence, H, W] w = torch.ones(32, 2) y = x @ w assert y.size() == torch.Size([4, 8, 16, 2]) 2.2. å¼ é‡ einops 2.2.1. ä½¿ç”¨ einops çš„åŠ¨æœº x = torch.ones(2, 2, 3) # batch, sequence, hidden @inspect x y = torch.ones(2, 2, 3) # batch, sequence, hidden @inspect y z = x @ y.transpose(-2, -1) # batch, sequence, sequence @inspect z ä»€ä¹ˆæ˜¯ç»´åº¦ -2ï¼Œ -1ï¼Ÿ\nå¾ˆå®¹æ˜“ææ··å¼ é‡ç»´åº¦\neinopsæ˜¯ä¸€ä¸ª python åº“ï¼Œç”¨äºå‘½åå¼ é‡ç»´åº¦å¹¶æ“ä½œå¼ é‡\neinopsæ–‡æ¡£\n2.2.2. jaxtypingå‘½åçŸ©é˜µç»´åº¦ å¦‚ä½•å®šä¹‰å¼ é‡ç»´åº¦\nè€æ–¹æ³•\nx = torch.ones(2, 2, 1, 3) # batch seq heads hidden @inspect x æ–°æ–¹æ³•ï¼ˆjaxtypingï¼‰\nx: Float[torch.Tensor, \u0026#34;batch seq heads hidden\u0026#34;] = torch.ones(2, 2, 1, 3) # @inspect x 2.2.3. einopsæ“ä½œ æ“ä½œä¸€ einsum Einsum æ˜¯å…·æœ‰è‰¯å¥½è®°å½•åŠŸèƒ½çš„é€šç”¨çŸ©é˜µä¹˜æ³•\nå®šä¹‰ä¸¤ä¸ªå¼ é‡\nx: Float[torch.Tensor, \u0026#34;batch seq1 hidden\u0026#34;] = torch.ones(2, 3, 4) # @inspect x y: Float[torch.Tensor, \u0026#34;batch seq2 hidden\u0026#34;] = torch.ones(2, 3, 4) # @inspect y è€æ–¹æ³•\nz = x @ y.transpose(-2, -1) # batch, sequence, sequence @inspect z æ–°æ–¹æ³•ï¼ˆjaxtypingï¼‰\nz = einsum(x, y, \u0026#34;batch seq1 hidden, batch seq2 hidden -\u0026gt; batch seq1 seq2\u0026#34;) # @inspect z z = einsum(x, y, \u0026#34;... seq1 hidden, ... seq2 hidden -\u0026gt; ... seq1 seq2\u0026#34;) # @inspect z è¾“å‡ºä¸­æœªå‘½åçš„ç»´åº¦å°†è¢«æ±‚å’Œ\næ“ä½œäºŒ reduce ä½ å¯ä»¥é€šè¿‡ä¸€äº›æ“ä½œå‡å°‘ä¸€ä¸ªtensorçš„ç»´åº¦ï¼Œä¾‹å¦‚sumã€meanã€maxã€min\nå®šä¹‰ä¸€ä¸ªå¼ é‡\nx: Float[torch.Tensor, \u0026#34;batch seq hidden\u0026#34;] = torch.ones(2, 3, 4) # @inspect x è€æ–¹æ³•\ny = x.mean(dim=-1) # @inspect y æ–°æ–¹æ³•ï¼ˆjaxtypingï¼‰\ny = reduce(x, \u0026#34;... hidden -\u0026gt; ...\u0026#34;, \u0026#34;sum\u0026#34;) # @inspect y æ“ä½œä¸‰ rearrange æœ‰æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªç»´åº¦è¡¨å¾äº†ä¸¤ä¸ªç»´åº¦ï¼Œä½ å¸Œæœ›æ“ä½œä¸¤ä¸ªç»´åº¦ä¸­çš„ä¸€ä¸ª\nå®šä¹‰ä¸€ä¸ªå¼ é‡\nx: Float[torch.Tensor, \u0026#34;batch seq total_hidden\u0026#34;] = torch.ones(2, 3, 8) # @inspect x å…¶ä¸­total_hiddenæ˜¯heads * hidden1çš„å±•å¹³è¡¨å¾\nw: Float[torch.Tensor, \u0026#34;hidden1 hidden2\u0026#34;] = torch.ones(4, 4) å°†total_hiddenæ‹†åˆ†æˆheadså’Œhidden1\nx = rearrange(x, \u0026#34;... (heads hidden1) -\u0026gt; ... heads hidden1\u0026#34;, heads=2) # @inspect x å°†headså’Œhidden1åˆå¹¶\nx = rearrange(x, \u0026#34;... heads hidden2 -\u0026gt; ... (heads hidden2)\u0026#34;) # @inspect x 2.3. å¼ é‡æ“ä½œ flops ä¸€ä¸ªæµ®ç‚¹è¿ç®—ï¼ˆFLOP, floating-point operationï¼‰æ˜¯ä¸€æ¬¡åŸºç¡€æ“ä½œï¼Œä¾‹å¦‚åŠ æ³•ï¼ˆ$x+y$ï¼‰æˆ–ä¹˜æ³•ï¼ˆ$x \\cdot y$ï¼‰\nâš  è­¦å‘Šä¸¤ä¸ªæå…¶ä»¤äººå›°æƒ‘çš„ç¼©å†™è¯ï¼ˆå‘éŸ³å®Œå…¨ç›¸åŒï¼ï¼‰\nFLOPsï¼šæµ®ç‚¹è¿ç®—ï¼ˆè¡¡é‡è®¡ç®—é‡ï¼‰ FLOP/sï¼šæ¯ç§’æµ®ç‚¹è¿ç®—æ¬¡æ•°ï¼ˆä¹Ÿå†™ä½œFLOPSï¼‰ï¼Œç”¨äºè¡¡é‡ç¡¬ä»¶çš„é€Ÿåº¦ \u0026times; è®­ç»ƒ GPT-3ï¼ˆ2020ï¼‰ éœ€è¦ 3.14e23 FLOPs\nè®­ç»ƒ GPT-4ï¼ˆ2023ï¼‰ éœ€è¦å¤§çº¦ 2e25 FLOPs\nA100 å¤„ç† torch.bfloat16 æˆ– torch.float16 çš„å³°å€¼æ€§èƒ½æ˜¯ 312 teraFLOP/sï¼Œå¤„ç† torch.float32 çš„å³°å€¼æ€§èƒ½ä¸º 19.5 teraFLOP/s\nH100 å¤„ç† torch.bfloat16 æˆ– torch.float16 çš„å³°å€¼æ€§èƒ½æ˜¯ 1979 teraFLOP/sï¼Œä½†å®é™…ä¼šæœ‰50%çš„æ€§èƒ½æŠ˜æŸï¼›å¤„ç† torch.float32 çš„å³°å€¼æ€§èƒ½ä¸º 67.5 teraFLOP/s\n8 å¼  H100 ä¸¤å‘¨å¯ä»¥å®Œæˆï¼š\ntotal_flops = 8 * (60 * 60 * 24 * 7) * h100_flop_per_sec # @inspect total_flops è¾“å‡ºï¼š\ntotal_flops = 4.788e+21 2.3.1. FLOPsè®¡ç®— çº¿æ€§æ¨¡å‹ï¼šå¯¹äºä¸€ä¸ªç»´åº¦ä¸º B x D çš„çŸ©é˜µå’Œä¸€ä¸ª D x K çš„çŸ©é˜µï¼Œå…¶æ‰€éœ€çš„ FLOPs ä¸º\nx = torch.ones(B, D, device=device) w = torch.randn(D, K, device=device) y = x @ w actual_num_flops = 2 * B * D * K # @inspect actual_num_flops å¯¹äºä¸€ä¸ªä¸‰å…ƒç»„ (i, j, k)ï¼Œéœ€è¦ä¸€æ¬¡ä¹˜æ³• (x[i][j] * w[j][k]) å’Œä¸€æ¬¡åŠ æ³•ï¼Œæœ€ç»ˆå®ç°çŸ©é˜µç›¸ä¹˜è¿ç®—\nå…ƒç´ çº§æ“ä½œï¼šä¸€ä¸ª m x n çš„çŸ©é˜µéœ€è¦ O(m x n) FLOPs\nåŠ æ³•æ“ä½œï¼šä¸¤ä¸ª m x n çš„çŸ©é˜µå®ŒæˆåŠ æ³•éœ€è¦ m x n FLOPs\næ€»ç»“ï¼ŒçŸ©é˜µä¹˜æ³•æ˜¯æ·±åº¦å­¦ä¹ ä¸­ FLOP éœ€æ±‚æœ€å¤§çš„ï¼Œä½ åªéœ€è¦ç»Ÿè®¡æ·±åº¦å­¦ä¹ ä¸­æ‰€éœ€çš„ä¹˜æ³•æ“ä½œå³å¯å¤§è‡´è®¡ç®—å‡ºæ‰€éœ€ FLOPs\n2.3.2. æ¨¡å‹ FLOPs ä½¿ç”¨é‡ï¼ˆModel FLOPs utilizationï¼ŒMFUï¼‰ å®šä¹‰ï¼š (actual FLOP/s) / (promised FLOP/s)ï¼Œå¿½ç•¥é€šä¿¡å¼€é”€\nå®é™…ä¸Šï¼ŒMFU \u0026gt;= 0.5 å°±å·²ç»å¾ˆæ£’äº†ï¼ˆå¦‚æœæ¨¡å‹ä¸­ä¹˜æ³•è¿ç®—ä¸»å¯¼çš„è¯å¾€å¾€ä¼šæ›´é«˜ï¼‰\n2.3.3. æ€»ç»“ çŸ©é˜µä¹˜æ³•å ä¸»å¯¼åœ°ä½ï¼š(2 x m x n x p) FLOPs\nFLOP/s å–å†³äºç¡¬ä»¶ï¼ˆH100 \u0026raquo; A100ï¼‰å’Œæ•°æ®ç±»å‹ï¼ˆbfloat16 \u0026raquo; float32ï¼‰\næ¨¡å‹ FLOPs åˆ©ç”¨ç‡ï¼ˆMFUï¼‰ï¼š(å®é™… FLOP/s) / (æ‰¿è¯º FLOP/s)\n2.4. æ¢¯åº¦ä¸åå‘ä¼ æ’­ 2.4.1. æ¢¯åº¦åŸºç¡€ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„çº¿æ€§æ¨¡å‹\n$$ y = 0.5 \\cdot (x \\times w - 5)^2 $$\nå‰å‘ä¼ æ’­ï¼šè®¡ç®—æŸå¤±\nx = torch.tensor([1., 2, 3]) w = torch.tensor([1., 1, 1], requires_grad=True) # Want gradient pred_y = x @ w loss = 0.5 * (pred_y - 5).pow(2) åå‘ä¼ æ’­ï¼šè®¡ç®—æ¢¯åº¦\nloss.backward() assert loss.grad is None assert pred_y.grad is None assert x.grad is None assert torch.equal(w.grad, torch.tensor([1, 2, 3])) 2.4.2. æ¢¯åº¦ FLOPs è®¡ç®—æ¢¯åº¦ FLOPsï¼Œæˆ‘ä»¬ä»¥çº¿æ€§æ¨¡å‹ä¸ºä¾‹\nx = torch.ones(B, D, device=device) w1 = torch.randn(D, D, device=device, requires_grad=True) w2 = torch.randn(D, K, device=device, requires_grad=True) h1 = x @ w1 h2 = h1 @ w2 loss = h2.pow(2).mean() å›é¡¾ä¸€ä¸‹å‰å‘ä¼ æ’­çš„ FLOPs è®¡ç®—ï¼š\nMultiply x[i][j] * w1[j][k] Add to h1[i][k] Multiply h1[i][j] * w2[j][k] Add to h2[i][k] num_forward_flops = (2 * B * D * D) + (2 * B * D * K) # @inspect num_forward_flops åå‘ä¼ æ’­è·¯å¾„ï¼šloss \u0026ndash;\u0026gt; h2 \u0026ndash;\u0026gt; w2 \u0026ndash;\u0026gt; h1 \u0026ndash;\u0026gt; w1 \u0026ndash;\u0026gt; x\nå¯¹äºå‚æ•° w2ï¼Œæ ¹æ®é“¾å¼æ³•åˆ™ï¼Œå¯ä»¥å¾—å‡ºå…¶æ¢¯åº¦ä¸º\n$$ \\text{w2.grad} = \\frac{\\partial loss}{\\partial w2} = \\frac{\\partial loss}{\\partial h2} \\cdot \\frac{\\partial h2}{\\partial w2} $$ $$ w2.grad[j,k] = \\frac{\\partial loss}{\\partial w2[j, k]} = \\sum_{i=0}^{N-1} \\frac{\\partial loss}{\\partial h2[i, k]} \\cdot \\frac{\\partial h2[i, k]}{\\partial w2[j, k]} = \\sum_{i=0}^{N-1} h2.grad[i,k] \\cdot h1[i,j] $$\nå¯¹äºæ¯ä¸€ä¸ªä¸‰å…ƒç»„ (i,j,k)ï¼Œéƒ½è¦åšä¸€æ¬¡ä¹˜æ³•å’ŒåŠ æ³•ï¼Œæ‰€ä»¥\nnum_backward_flops += 2 * B * D * K # @inspect num_backward_flops è€Œè¿™å…¶ä¸­ï¼Œæœ‰å››ä¸ªå‚æ•°éœ€è¦è®¡ç®—æ¢¯åº¦ï¼Œæ‰€ä»¥æœ€ç»ˆéœ€è¦çš„ FLOPs ä¸º\nnum_backward_flops = (2 + 2) * B * D * K + (2 + 2) * B * D * D # @inspect num_backward_flops i æ€»ç»“ å‰å‘ä¼ æ’­ï¼š2 (# data points) (# parameters) FLOPs åå‘ä¼ æ’­ï¼š4 (# data points) (# parameters) FLOPs æ€»åˆï¼š6 (# data points) (# parameters) FLOPs \u0026times; 3. æ¨¡å‹ 3.1. æ¨¡å‹å‚æ•° æ¨¡å‹å‚æ•°å‡ä»¥nn.Parameterå¯¹è±¡çš„å½¢å¼å­˜å‚¨äº Pytorch\ninput_dim = 16384 output_dim = 32 w = nn.Parameter(torch.randn(input_dim, output_dim)) assert isinstance(w, torch.Tensor) # Behaves like a tensor assert type(w.data) == torch.Tensor # Access the underlying tensor 3.1.1. å‚æ•°åˆå§‹åŒ– å‡è®¾æˆ‘ä»¬éšæœºåˆå§‹åŒ–æƒé‡ wï¼Œå¹¶ä¸ x åšä¹˜æ³•æ“ä½œ\nx = nn.Parameter(torch.randn(input_dim)) output = x @ w # @inspect output assert output.size() == torch.Size([output_dim]) è¾“å‡ºï¼š\noutput = [ 18.919979095458984, ... ] ç”±äº $output[k] = x \\times w[:, k]$ï¼Œæ‰€ä»¥ output ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ çš„å¤§å°å‡ä¸ input_dim çº¿æ€§ç›¸å…³\nå½“ input_dim è¿‡å¤§æ—¶ï¼Œä¼šå¯¼è‡´å‚æ•°æ¢¯åº¦çˆ†ç‚¸ï¼Œå€’æ˜¯æ¨¡å‹è®­ç»ƒä¸ç¨³å®š\næˆ‘ä»¬å¸Œæœ›åˆå§‹å€¼ä¸ input_dim æ— å…³ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†å‚æ•°ç»Ÿä¸€æ”¾ç¼© 1/sqrt(input_dim)\nw = nn.Parameter(torch.randn(input_dim, output_dim) / np.sqrt(input_dim)) output = x @ w # @inspect output è¾“å‡ºï¼š\noutput = [ -1.5302726030349731, ... ] ç®€å•æ¥è¯´ï¼Œè¿™å°±æ˜¯ Xavier åˆå§‹åŒ–\nä¸ºäº†æ›´åŠ å®‰å…¨ï¼Œæˆ‘ä»¬å°†æ­£æ€åˆ†å¸ƒæˆªæ–­ä¸º[-3, 3]ï¼Œä»¥é¿å…å‡ºç°ä»»ä½•å¼‚å¸¸å€¼\nw = nn.Parameter(nn.init.trunc_normal_(torch.empty(input_dim, output_dim), std=1 / np.sqrt(input_dim), a=-3, b=3)) 3.1.2. æ„å»ºæ¨¡å‹ ä»¥çº¿æ€§æ¨¡å‹ä¸ºä¾‹\nclass Linear(nn.Module): \u0026#34;\u0026#34;\u0026#34;Simple linear layer.\u0026#34;\u0026#34;\u0026#34; def __init__(self, input_dim: int, output_dim: int): super().__init__() self.weight = nn.Parameter(torch.randn(input_dim, output_dim) / np.sqrt(input_dim)) def forward(self, x: torch.Tensor) -\u0026gt; torch.Tensor: return x @ self.weight class Cruncher(nn.Module): def __init__(self, dim: int, num_layers: int): super().__init__() self.layers = nn.ModuleList([ Linear(dim, dim) for i in range(num_layers) ]) self.final = Linear(dim, 1) def forward(self, x: torch.Tensor) -\u0026gt; torch.Tensor: # Apply linear layers B, D = x.size() for layer in self.layers: x = layer(x) # Apply final head x = self.final(x) assert x.size() == torch.Size([B, 1]) # Remove the last dimension x = x.squeeze(-1) assert x.size() == torch.Size([B]) return x B = 8 # Batch size x = torch.randn(B, D, device=device) y = model(x) assert y.size() == torch.Size([B]) æ¨¡å‹å‚æ•°\nparam_sizes = [ (name, param.numel()) for name, param in model.state_dict().items() ] assert param_sizes == [ (\u0026#34;layers.0.weight\u0026#34;, D * D), (\u0026#34;layers.1.weight\u0026#34;, D * D), (\u0026#34;final.weight\u0026#34;, D), ] num_parameters = get_num_parameters(model) assert num_parameters == (D * D) + (D * D) + D 3.2. æ¨¡å‹è®­ç»ƒ 3.2.1. éšæœºæ€§ éšæœºæ€§åœ¨è®¸å¤šåœ°æ–¹éƒ½ä¼šå‡ºç°ï¼šå‚æ•°åˆå§‹åŒ–ã€dropoutã€æ•°æ®æ’åºç­‰ã€‚ ä¸ºäº†ç¡®ä¿å¯é‡å¤æ€§ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨åœ¨æ¯æ¬¡ä½¿ç”¨éšæœºæ€§æ—¶éƒ½ä¼ å…¥ä¸åŒçš„éšæœºç§å­ ç¡®å®šæ€§åœ¨è°ƒè¯•æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œè¿™æ ·æ‚¨å¯ä»¥å®šä½å¹¶è§£å†³é—®é¢˜ è®¾ç½®éšæœºç§å­æœ‰ä¸‰ä¸ªåœ°æ–¹ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œæ‚¨åº”è¯¥ä¸€æ¬¡æ€§å…¨éƒ¨è®¾ç½®å¥½ # Torch seed = 0 torch.manual_seed(seed) # NumPy import numpy as np np.random.seed(seed) # Python import random random.seed(seed) 3.2.2. æ•°æ®åŠ è½½ åœ¨è¯­è¨€æ¨¡å‹ä¸­ï¼Œæ•°æ®å¯ä»¥è¡¨å¾ä¸ºæ•´æ•°çš„åºåˆ—ï¼ˆä»¥ token çš„å½¢å¼è¾“å‡ºï¼‰\nå¯ä»¥ä½¿ç”¨ numpy æ•°ç»„è¿›è¡Œåºåˆ—åŒ–\norig_data = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10], dtype=np.int32) orig_data.tofile(\u0026#34;data.npy\u0026#34;) ä½ å¯ä»¥ä½¿ç”¨ numpy æ•°ç»„åŠ è½½æ•°æ®\nå¦‚æœä½ ä¸å¸Œæœ›ä¸€æ¬¡æ€§å°†æ‰€æœ‰æ•°æ®è½½å…¥å†…å­˜ï¼ˆæœ‰äº›æ•°æ®é›†å·¨å¤§æ— æ¯”ï¼Œä¾‹å¦‚ LLaMA åŒ…å« 2.8TB æ•°æ®ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ memmap å°†éœ€è¦è®¿é—®çš„éƒ¨åˆ†è½½å…¥å†…å­˜\ndata = np.memmap(\u0026#34;data.npy\u0026#34;, dtype=np.int32) assert np.array_equal(data, orig_data) ä¸€ä¸ªæ•°æ®åŠ è½½å™¨ï¼ˆdataloaderï¼‰ä¼šç”Ÿæˆä¸€ä¸ª batch çš„æ•°æ®ç”¨äºè®­ç»ƒ\ndef get_batch(data: np.array, batch_size: int, sequence_length: int, device: str) -\u0026gt; torch.Tensor: # Sample batch_size random positions into data. start_indices = torch.randint(len(data) - sequence_length, (batch_size,)) assert start_indices.size() == torch.Size([batch_size]) # Index into the data. x = torch.tensor([data[start:start + sequence_length] for start in start_indices]) assert x.size() == torch.Size([batch_size, sequence_length]) # Pinned memory if torch.cuda.is_available(): x = x.pin_memory() x = x.to(device, non_blocking=True) return x B = 2 # Batch size L = 4 # Length of sequence x = get_batch(data, batch_size=B, sequence_length=L, device=get_device()) assert x.size() == torch.Size([B, L]) é»˜è®¤æƒ…å†µä¸‹ï¼ŒCPU å¼ é‡å­˜å‚¨åœ¨åˆ†é¡µå†…å­˜ï¼ˆpaged memoryï¼‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°å°†å…¶å›ºå®šï¼ˆpinï¼‰ï¼Œè¿è¡Œä»£ç x = x.pin_memory()\nè¿™å…è®¸æˆ‘ä»¬å¹¶è¡Œå®Œæˆä¸¤é¡¹ä»»åŠ¡ï¼š\nä»æ•°æ®ä¸­æå–ä¸‹ä¸€ä¸ª batch åˆ° CPU ä¸Š åœ¨ GPU ä¸Šå¤„ç† x 3.2.3. ä¼˜åŒ–å™¨ Optimizer ä¾æ—§è¯·å‡ºè€æœ‹å‹çº¿æ€§æ¨¡å‹\nB = 2 D = 4 num_layers = 2 model = Cruncher(dim=D, num_layers=num_layers).to(get_device()) å®šä¹‰ AdaGrad ä¼˜åŒ–å™¨\nmomentum = SGD + exponential averaging of grad AdaGrad = SGD + averaging by grad^2 RMSProp = AdaGrad + exponentially averaging of grad^2 Adam = RMSProp + momentum AdaGrad\nclass AdaGrad(torch.optim.Optimizer): def __init__(self, params: Iterable[nn.Parameter], lr: float = 0.01): super(AdaGrad, self).__init__(params, dict(lr=lr)) def step(self): for group in self.param_groups: lr = group[\u0026#34;lr\u0026#34;] for p in group[\u0026#34;params\u0026#34;]: # Optimizer state state = self.state[p] grad = p.grad.data # Get squared gradients g2 = sum_{i\u0026lt;t} g_i^2 g2 = state.get(\u0026#34;g2\u0026#34;, torch.zeros_like(grad)) # Update optimizer state g2 += torch.square(grad) state[\u0026#34;g2\u0026#34;] = g2 # Update parameters p.data -= lr * grad / torch.sqrt(g2 + 1e-5) optimizer = AdaGrad(model.parameters(), lr=0.01) state = model.state_dict() # @inspect state è®¡ç®—æ¢¯åº¦\nx = torch.randn(B, D, device=get_device()) y = torch.tensor([4., 5.], device=get_device()) pred_y = model(x) loss = F.mse_loss(input=pred_y, target=y) loss.backward() ä¼˜åŒ–ä¸€ä¸ª step\noptimizer.step() state = model.state_dict() # @inspect state é‡Šæ”¾å†…å­˜ï¼ˆå¯é€‰ï¼‰\noptimizer.zero_grad(set_to_none=True) å…³äºå†…å­˜ å‚æ•°æ‰€éœ€çš„å†…å­˜\ndef get_num_parameters(model: nn.Module) -\u0026gt; int: return sum(param.numel() for param in model.parameters()) num_parameters = (D * D * num_layers) + D # @inspect num_parameters assert num_parameters == get_num_parameters(model) è¾“å‡º\nnum_parameters = 36 æ¿€æ´»å‡½æ•°æ‰€éœ€çš„å†…å­˜\nnum_activations = B * D * num_layers # @inspect num_activations è¾“å‡º\nnum_parameters = 16 æ¢¯åº¦æ‰€éœ€çš„å†…å­˜\nnum_gradients = num_parameters # @inspect num_gradients è¾“å‡º\nnum_parameters = 36 ä¼˜åŒ–å™¨ state æ‰€éœ€çš„å†…å­˜\nnum_optimizer_states = num_parameters # @inspect num_optimizer_states è¾“å‡º\nnum_parameters = 36 æ€»å…±éœ€è¦ï¼ˆå‡è®¾æ•°æ®å‡ä»¥ float32 å­˜å‚¨ï¼Œéœ€è¦ 4 Bytesï¼‰\ntotal_memory = 4 * (num_parameters + num_activations + num_gradients + num_optimizer_states) # @inspect total_memory è¾“å‡º\nnum_parameters = 496 3.2.4. è®­ç»ƒå¾ªç¯ï¼ˆloopï¼‰ def train(name: str, get_batch, D: int, num_layers: int, B: int, num_train_steps: int, lr: float): model = Cruncher(dim=D, num_layers=0).to(get_device()) optimizer = SGD(model.parameters(), lr=0.01) for t in range(num_train_steps): # Get data x, y = get_batch(B=B) # Forward (compute loss) pred_y = model(x) loss = F.mse_loss(pred_y, y) # Backward (compute gradients) loss.backward() # Update parameters optimizer.step() optimizer.zero_grad(set_to_none=True) train(\u0026#34;simple\u0026#34;, get_batch, D=D, num_layers=0, B=4, num_train_steps=10, lr=0.01) 3.2.5. checkpoint åœ¨è®­ç»ƒé˜¶æ®µï¼Œé˜¶æ®µæ€§çš„ä¿å­˜æ¨¡å‹ä»¥åŠä¼˜åŒ–å™¨çŠ¶æ€ï¼ˆstateï¼‰åˆ°ç¡¬ç›˜ä¸­æ˜¯éå¸¸æœ‰ç”¨çš„\ncheckpoint = { \u0026#34;model\u0026#34;: model.state_dict(), \u0026#34;optimizer\u0026#34;: optimizer.state_dict(), } torch.save(checkpoint, \u0026#34;model_checkpoint.pt\u0026#34;) åŠ è½½ checkpoint\nloaded_checkpoint = torch.load(\u0026#34;model_checkpoint.pt\u0026#34;) 3.2.6. æ··åˆç²¾åº¦è®­ç»ƒ æ•°æ®ç±»å‹çš„é€‰æ‹©ï¼ˆfloat32ã€bfloat16ã€fp8ï¼‰å­˜åœ¨æƒè¡¡ æ›´é«˜ç²¾åº¦ï¼šæ›´å‡†ç¡®/ç¨³å®šï¼Œå ç”¨æ›´å¤šå†…å­˜ï¼Œè®¡ç®—é‡æ›´å¤§ ç²¾åº¦è¾ƒä½ï¼šç²¾åº¦/ç¨³å®šæ€§è¾ƒä½ï¼Œå†…å­˜å ç”¨è¾ƒå°‘ï¼Œè®¡ç®—é‡è¾ƒå°‘ å¦‚ä½•å…¼é¡¾ä¸¤è€…ä¼˜åŠ¿ï¼Ÿ è§£å†³æ–¹æ¡ˆï¼šé»˜è®¤ä½¿ç”¨float32ï¼Œä½†åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä½¿ç”¨{bfloat16, fp8} å…·ä½“è®¡åˆ’ï¼š åœ¨å‰å‘ä¼ æ’­ï¼ˆæ¿€æ´»å‡½æ•°ï¼‰ä¸­ä½¿ç”¨{bfloat16, fp8} ä½¿ç”¨float32è¿›è¡Œå…¶ä½™æ“ä½œï¼ˆå‚æ•°ã€æ¢¯åº¦ï¼‰ æ··åˆç²¾åº¦è®­ç»ƒ Pytorch æä¾›è‡ªåŠ¨æ··åˆç²¾åº¦ï¼ˆAMPï¼‰åº“ NVIDIA çš„ Transformer Engine æ”¯æŒ FP8 ç”¨äºçº¿æ€§å±‚ åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¹¿æ³›ä½¿ç”¨ FP8 å‚è€ƒæ–‡çŒ® stanford-cs336 lecture 2 ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/primitives/","summary":"\u003ch2 id=\"æ·±åº¦å­¦ä¹ ä¸»è¦èµ„æº\"\u003eæ·±åº¦å­¦ä¹ ä¸»è¦èµ„æº\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eå†…å­˜\u003c/strong\u003eï¼ˆGBï¼‰ï¼šå­˜å‚¨å‚æ•°ã€æ¢¯åº¦ã€ä¼˜åŒ–å™¨çŠ¶æ€ã€æ¿€æ´»å€¼ç­‰ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eè®¡ç®—é‡\u003c/strong\u003eï¼ˆFLOPsï¼‰ï¼šæµ®ç‚¹è¿ç®—æ¬¡æ•°ï¼Œè¡¡é‡è®­ç»ƒæ‰€éœ€çš„è®¡ç®—èµ„æºã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"1-å¼ é‡åŸºç¡€ä¸å†…å­˜ç®¡ç†\"\u003e1. å¼ é‡åŸºç¡€ä¸å†…å­˜ç®¡ç†\u003c/h2\u003e\n\u003ch3 id=\"11-å¼ é‡çš„åˆ›å»ºä¸å­˜å‚¨\"\u003e1.1. å¼ é‡çš„åˆ›å»ºä¸å­˜å‚¨\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eå¼ é‡æ˜¯å­˜å‚¨å‚æ•°ã€æ¢¯åº¦ã€ä¼˜åŒ–å™¨çŠ¶æ€ã€æ•°æ®ã€æ¿€æ´»å€¼çš„åŸºæœ¬å•å…ƒ\u003c/li\u003e\n\u003cli\u003ePyTorch æ”¯æŒå¤šç§æ–¹å¼åˆ›å»ºå¼ é‡ï¼ˆå¦‚ \u003ccode\u003etorch.zeros\u003c/code\u003eã€\u003ccode\u003etorch.ones\u003c/code\u003eã€\u003ccode\u003etorch.randn\u003c/code\u003e ç­‰ï¼‰\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etensor\u003c/span\u003e\u003cspan class=\"p\"\u003e([[\u003c/span\u003e\u003cspan class=\"mf\"\u003e1.\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]])\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# @inspect x\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezeros\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 4x8 matrix of all zeros @inspect x\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eones\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 4x8 matrix of all ones @inspect x\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erandn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 4x8 matrix of iid Normal(0, 1) samples @inspect x\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003eä½ ä¹Ÿå¯ä»¥å…ˆåˆ†é…ç©ºé—´ï¼Œå†åˆ†é…æ•°å€¼\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eempty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 4x8 matrix of uninitialized values @inspect x\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003enn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrunc_normal_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emean\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e=-\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# @inspect x\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003eå¼ é‡çš„å†…å­˜ç”±\u003cstrong\u003eå…ƒç´ æ•°é‡\u003c/strong\u003eå’Œ\u003cstrong\u003eæ•°æ®ç±»å‹\u003c/strong\u003eå…±åŒå†³å®š\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch3 id=\"12-å¸¸è§æ•°æ®ç±»å‹\"\u003e1.2. å¸¸è§æ•°æ®ç±»å‹\u003c/h3\u003e\n\u003cp\u003eå‚æ•°ã€æ¢¯åº¦ã€æ¿€æ´»ä»¥åŠä¼˜åŒ–çŠ¶æ€å‡ ä¹å‡å­˜å‚¨ä¸ºæµ®ç‚¹æ•°\u003c/p\u003e\n\u003ch4 id=\"121-float32å•ç²¾åº¦\"\u003e1.2.1 float32ï¼ˆå•ç²¾åº¦ï¼‰\u003c/h4\u003e\n\u003cp\u003eé»˜è®¤ç±»å‹ï¼Œ4 å­—èŠ‚ï¼ŒåŠ¨æ€èŒƒå›´å¤§ã€‚\u003c/p\u003e\n\u003cp align=\"center\"\u003e\n  \u003cimg src=\"fp32.png\" alt=\"fp32\" /\u003e\n\u003c/p\u003e\n\u003cp\u003eå†…å­˜æ˜¯ç”±(i)æ•°å€¼çš„æ•°é‡å’Œ(ii)æ•°å€¼çš„ç±»å‹å†³å®šçš„\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezeros\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# @inspect x\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eassert\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edtype\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003etorch\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efloat32\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# Default type\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eassert\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enumel\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eassert\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eelement_size\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# Float is 4 bytes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eassert\u003c/span\u003e \u003cspan class=\"n\"\u003eget_memory_usage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 128 bytes\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"122-float16åŠç²¾åº¦\"\u003e1.2.2 float16ï¼ˆåŠç²¾åº¦ï¼‰\u003c/h4\u003e\n\u003cp\u003e2 å­—èŠ‚ï¼ŒèŠ‚çœå†…å­˜ä½†åŠ¨æ€èŒƒå›´å°ï¼Œæ˜“ä¸‹æº¢\u003c/p\u003e","title":"åŸºæœ¬åŸè¯­ï¼ˆprimitivesï¼‰ä¸èµ„æºè®¡ç®—"},{"content":"ğŸ‘‰ åœ¨çº¿ä½“éªŒåœ°å€ï¼šTokenization å¯è§†åŒ–å·¥å…·\nåŸå§‹çš„æ–‡æœ¬ç»Ÿä¸€è¡¨å¾ä¸º Unicode å­—ç¬¦ä¸²\nstring = \u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34; è¯­è¨€æ¨¡å‹ä¼šå¯¹ä¸€ç³»åˆ—tokenï¼ˆé€šå¸¸ç”¨æ•´æ•°ç´¢å¼•è¡¨ç¤ºï¼‰ä¸Šçš„å¯èƒ½æ€§è¿›è¡Œå»ºæ¨¡ï¼Œæ„æˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒ\nindices = [15496, 11, 995, 0] æˆ‘ä»¬éœ€è¦ï¼š\nâœ… ä¸€ä¸ªæ–¹æ³•ï¼šå°†å­—ç¬¦ä¸²ç¼–ç ä¸º token âœ… ä¸€ä¸ªæ–¹æ³•ï¼šå°† token è§£ç å›å­—ç¬¦ä¸² class Tokenizer: def encode(self, string: str) -\u0026gt; list[int]: ... def decode(self, indices: list[int]) -\u0026gt; str: ... vocab_size: è¯è¡¨å¤§å°ï¼Œå³å¯èƒ½å‡ºç°çš„ tokenï¼ˆæ•´æ•° IDï¼‰æ€»æ•°ã€‚ 1. Character-based tokenization 1.1. Unicode æ¦‚è¿° ç»Ÿä¸€å…¨çƒå­—ç¬¦ç¼–ç çš„æ ‡å‡†ï¼ˆçº¦ 150,000 ä¸ªå­—ç¬¦ï¼‰ ord(char)ï¼šè·å–å­—ç¬¦çš„åè¿›åˆ¶ç¼–ç  ord(\u0026#34;h\u0026#34;) # 104 ord(\u0026#34;ğŸ˜Š\u0026#34;) # 128522 1.2. ç¼–è§£ç  class CharacterTokenizer(Tokenizer): \u0026#34;\u0026#34;\u0026#34;Represent a string as a sequence of Unicode code points.\u0026#34;\u0026#34;\u0026#34; def encode(self, string: str) -\u0026gt; list[int]: return list(map(ord, string)) def decode(self, indices: list[int]) -\u0026gt; str: return \u0026#34;\u0026#34;.join(map(chr, indices)) ç¤ºä¾‹ï¼š\ntokenizer = CharacterTokenizer() string = \u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34; # @inspect string indices = tokenizer.encode(string) # @inspect indices reconstructed_string = tokenizer.decode(indices) # @inspect reconstructed_string è¾“å‡ºï¼š\nstring = \u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34; indices = [72, 101, 108, 108, 111, 44, 32, 127757, 33, 32, 20320, 22909, 33] reconstructed_string = \u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34; 1.3. å­˜åœ¨çš„é—®é¢˜ é—®é¢˜ä¸€ï¼šè¿™ä¼šæ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„è¯æ±‡è¡¨ï¼ˆvocabularyï¼‰\né—®é¢˜äºŒï¼šå¾ˆå¤šå­—ç¬¦å‡ºç°å‡ ç‡å¾ˆä½ï¼ˆä¾‹å¦‚ğŸŒï¼‰ï¼Œå¯¹è¯æ±‡è¡¨çš„ä½¿ç”¨å¹¶ä¸é«˜æ•ˆ\ndef get_compression_ratio(string: str, indices: list[int]) -\u0026gt; float: \u0026#34;\u0026#34;\u0026#34;Given `string` that has been tokenized into `indices`, .\u0026#34;\u0026#34;\u0026#34; num_bytes = len(bytes(string, encoding=\u0026#34;utf-8\u0026#34;)) # @inspect num_bytes num_tokens = len(indices) # @inspect num_tokens return num_bytes / num_tokens vocabulary_size = max(indices) + 1 # This is a lower bound @inspect vocabulary_size compression_ratio = get_compression_ratio(string, indices) # @inspect compression_ratio è¾“å‡ºï¼š\nvocabulary_size = 127758 num_bytes = 20 num_tokens = 13 compression_ratio = 1.5384615384615385 2. Byte-based tokenization Unicode å­—ç¬¦ä¸²ï¼ˆStringï¼‰å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸²å­—èŠ‚ï¼ˆByteï¼‰ï¼Œå…¶ä¸­å­—èŠ‚ï¼ˆå³å…«ä½äºŒè¿›åˆ¶ï¼‰å¯ä»¥è¡¨ç¤ºä¸º0åˆ°255çš„æ•°å­—\næœ€å¸¸è§çš„ Unicode ç¼–ç æ˜¯ UTF-8\nè¾“å…¥ï¼š\nbytes(\u0026#34;a\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;) bytes(\u0026#34;ğŸŒ\u0026#34;, encoding=\u0026#34;utf-8\u0026#34;) è¾“å‡ºï¼š\nb\u0026#34;a\u0026#34; # one byte b\u0026#34;\\xf0\\x9f\\x8c\\x8d\u0026#34;s # multiple bytes 2.1. ç¼–è§£ç  class ByteTokenizer(Tokenizer): \u0026#34;\u0026#34;\u0026#34;Represent a string as a sequence of bytes.\u0026#34;\u0026#34;\u0026#34; def encode(self, string: str) -\u0026gt; list[int]: string_bytes = string.encode(\u0026#34;utf-8\u0026#34;) # @inspect string_bytes indices = list(map(int, string_bytes)) # @inspect indices return indices def decode(self, indices: list[int]) -\u0026gt; str: string_bytes = bytes(indices) # @inspect string_bytes string = string_bytes.decode(\u0026#34;utf-8\u0026#34;) # @inspect string return string ç¤ºä¾‹ï¼š\ntokenizer = ByteTokenizer() string = \u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34; # @inspect string indices = tokenizer.encode(string) # @inspect indices reconstructed_string = tokenizer.decode(indices) # @inspect reconstructed_string è¾“å‡ºï¼š\nstring = \u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34; string_bytes = \u0026#34;b\u0026#39;Hello, \\\\xf0\\\\x9f\\\\x8c\\\\x8d!\\\\xe4\\\\xbd\\\\xa0\\\\xe5\\\\xa5\\\\xbd\u0026#39;\u0026#34; indices = [72, 101, 108, 108, 111, 44, 32, 240, 159, 140, 141, 33, 32, 228, 189, 160, 229, 165, 189, 33] reconstructed_string = \u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34; 2.2. å­˜åœ¨çš„é—®é¢˜ é—®é¢˜ä¸€ï¼šè™½ç„¶è¯æ±‡è¡¨å¾ˆå°ï¼ˆä»…ä¸º256ï¼‰ï¼Œä½†è¿™ä¹Ÿå¯¼è‡´åºåˆ—å¾ˆé•¿ã€‚è€Œåœ¨ Transformer ä¸­ï¼Œè®¡ç®—å¤æ‚åº¦æ˜¯éšç€åºåˆ—é•¿åº¦äºŒæ¬¡å¢é•¿çš„\nvocabulary_size = 256 # This is a lower bound @inspect vocabulary_size compression_ratio = get_compression_ratio(string, indices) # @inspect compression_ratio è¾“å‡ºï¼š\nnum_bytes = 20 num_tokens = 20 compression_ratio = 1.0 3. Word-based tokenization ä½¿ç”¨ç±»ä¼¼äºä¼ ç»ŸNLPåˆ†è¯æ–¹æ³•åˆ†ç¦»å­—ç¬¦ä¸²ï¼Œè¾“å…¥ï¼š\nstring = \u0026#34;I\u0026#39;ll say supercalifragilisticexpialidocious!\u0026#34; segments = regex.findall(r\u0026#34;\\w+|.\u0026#34;, string) # @inspect segments è¾“å‡ºï¼š\nsegments = [\u0026#34;I\u0026#34;, \u0026#34;ll\u0026#34;, \u0026#34;say\u0026#34;, \u0026#34;supercalifragilisticexpialidocious\u0026#34;, \u0026#34;!\u0026#34;] 3.1. ç¼–è§£ç  è¦å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªtokenizerï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›ç‰‡æ®µæ˜ å°„ä¸ºæ•´æ•° æ„å»ºä¸€ä¸ªä»æ¯ä¸ªç‰‡æ®µåˆ°æ•´æ•°çš„æ˜ å°„ 3.2. å­˜åœ¨çš„é—®é¢˜ è¯çš„æ•°é‡æ˜¯éå¸¸åºå¤§çš„ å¾ˆå¤šè¯å¾ˆå°‘å‡ºç°ï¼Œæ¨¡å‹ä¸ä¼šä»è¿™äº›è¯ä¸­å­¦ä¹ åˆ°å¾ˆå¤šå†…å®¹ å®ƒæ— æ³•æä¾›ä¸€ä¸ªå›ºå®šé•¿åº¦çš„è¯å…¸ 4. Byte Pair Encodingï¼ˆBPEï¼‰ ä¸»è¦æ€æƒ³ï¼šåœ¨åŸå§‹æ–‡æœ¬ä¸Šè®­ç»ƒtokenizerï¼Œè‡ªå‘çš„ç”Ÿæˆè¯æ±‡è¡¨\næ„å›¾ï¼šå¯¹äºå¸¸è§çš„å­—ç¬¦åºåˆ—ï¼Œå¯ä»¥ä»…ç”¨ä¸€ä¸ªtokenè¡¨ç¤ºï¼›å¯¹äºä¸å¸¸è§çš„å­—ç¬¦åºåˆ—ï¼Œåˆ™ç”¨å¤šä¸ªtokenè¡¨ç¤º\nç®—æ³•ç®€è¿°ï¼šé¦–å…ˆå°†æ¯ä¸€ä¸ªbyteçœ‹ä½œæ˜¯ä¸€ä¸ªtokenï¼Œéšåé€æ¸åˆå¹¶å¸¸å‡ºç°çš„ç›¸é‚»tokenä¸ºä¸€ä¸ªæ–°token\n4.1. ç®—æ³•æµç¨‹ def merge(indices: list[int], pair: tuple[int, int], new_index: int) -\u0026gt; list[int]: # @inspect indices, @inspect pair, @inspect new_index \u0026#34;\u0026#34;\u0026#34;Return `indices`, but with all instances of `pair` replaced with `new_index`.\u0026#34;\u0026#34;\u0026#34; new_indices = [] # @inspect new_indices i = 0 # @inspect i while i \u0026lt; len(indices): if i + 1 \u0026lt; len(indices) and indices[i] == pair[0] and indices[i + 1] == pair[1]: new_indices.append(new_index) i += 2 else: new_indices.append(indices[i]) i += 1 return new_indices 4.2. BPE ç¼–ç å™¨ class BPETokenizer(Tokenizer): \u0026#34;\u0026#34;\u0026#34;BPE tokenizer given a set of merges and a vocabulary.\u0026#34;\u0026#34;\u0026#34; def __init__(self, params: BPETokenizerParams): self.params = params def encode(self, string: str) -\u0026gt; list[int]: indices = list(map(int, string.encode(\u0026#34;utf-8\u0026#34;))) # @inspect indices # Note: this is a very slow implementation for pair, new_index in self.params.merges.items(): # @inspect pair, @inspect new_index indices = merge(indices, pair, new_index) return indices def decode(self, indices: list[int]) -\u0026gt; str: bytes_list = list(map(self.params.vocab.get, indices)) # @inspect bytes_list string = b\u0026#34;\u0026#34;.join(bytes_list).decode(\u0026#34;utf-8\u0026#34;) # @inspect string return string 4.3. è®­ç»ƒ BPE def train_bpe(string: str, num_merges: int) -\u0026gt; BPETokenizerParams: # @inspect string, @inspect num_merges # Start with the list of bytes of string. indices = list(map(int, string.encode(\u0026#34;utf-8\u0026#34;))) # @inspect indices merges: dict[tuple[int, int], int] = {} # index1, index2 =\u0026gt; merged index vocab: dict[int, bytes] = {x: bytes([x]) for x in range(256)} # index -\u0026gt; bytes for i in range(num_merges): # Count the number of occurrences of each pair of tokens counts = defaultdict(int) for index1, index2 in zip(indices, indices[1:]): # For each adjacent pair counts[(index1, index2)] += 1 # @inspect counts # Find the most common pair. pair = max(counts, key=counts.get) # @inspect pair index1, index2 = pair # Merge that pair. new_index = 256 + i # @inspect new_index merges[pair] = new_index # @inspect merges vocab[new_index] = vocab[index1] + vocab[index2] # @inspect vocab indices = merge(indices, pair, new_index) # @inspect indices return BPETokenizerParams(vocab=vocab, merges=merges) ç¤ºä¾‹:\ntext = \u0026#34;the cat in the hat\u0026#34; # @inspect string params = train_bpe(text, num_merges=3) string = \u0026#34;the quick brown fox\u0026#34; # @inspect string tokenizer = BPETokenizer(params) indices = tokenizer.encode(string) # @inspect indices reconstructed_string = tokenizer.decode(indices) # @inspect reconstructed_string ä»£ç é€»è¾‘ä¸ºï¼š\nåˆå§‹åŒ–è¯æ±‡è¡¨ï¼Œç”¨0-255è¡¨å¾byte ä¾æ¬¡å¯»æ‰¾æœ€å¤šæ¬¡å‡ºç°çš„ç›¸é‚»byte (116, 104) \u0026ndash;\u0026gt; 256 å³ (\u0026rsquo;t\u0026rsquo;, \u0026lsquo;h\u0026rsquo;) \u0026ndash;\u0026gt; \u0026rsquo;th\u0026rsquo; (256, 101) \u0026ndash;\u0026gt; 257 å³ (\u0026rsquo;th\u0026rsquo;, \u0026rsquo;e\u0026rsquo;) \u0026ndash;\u0026gt; \u0026rsquo;the' (257, 32) \u0026ndash;\u0026gt; 258 å³ ï¼ˆ\u0026rsquo;the\u0026rsquo;, \u0026rsquo; \u0026lsquo;ï¼‰\u0026ndash;\u0026gt; \u0026rsquo;the ' è¯æ±‡è¡¨é•¿åº¦æ›´æ–°è‡³259 ç”¨æ–°è¯æ±‡è¡¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œç¼–ç  ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/tokenization/","summary":"\u003cp\u003eğŸ‘‰ åœ¨çº¿ä½“éªŒåœ°å€ï¼š\u003ca href=\"https://tiktokenizer.vercel.app\"\u003eTokenization å¯è§†åŒ–å·¥å…·\u003c/a\u003e\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eåŸå§‹çš„æ–‡æœ¬ç»Ÿä¸€è¡¨å¾ä¸º Unicode å­—ç¬¦ä¸²\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eè¯­è¨€æ¨¡å‹ä¼šå¯¹ä¸€ç³»åˆ—tokenï¼ˆé€šå¸¸ç”¨æ•´æ•°ç´¢å¼•è¡¨ç¤ºï¼‰ä¸Šçš„å¯èƒ½æ€§è¿›è¡Œå»ºæ¨¡ï¼Œæ„æˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eindices\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e15496\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e995\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬éœ€è¦ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eâœ… ä¸€ä¸ªæ–¹æ³•ï¼š\u003cstrong\u003eå°†å­—ç¬¦ä¸²ç¼–ç ä¸º token\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eâœ… ä¸€ä¸ªæ–¹æ³•ï¼š\u003cstrong\u003eå°† token è§£ç å›å­—ç¬¦ä¸²\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\u003ccode\u003evocab_size\u003c/code\u003e: è¯è¡¨å¤§å°ï¼Œå³å¯èƒ½å‡ºç°çš„ tokenï¼ˆæ•´æ•° IDï¼‰æ€»æ•°ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"1-character-based-tokenization\"\u003e1. Character-based tokenization\u003c/h2\u003e\n\u003ch3 id=\"11-unicode-æ¦‚è¿°\"\u003e1.1. Unicode æ¦‚è¿°\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eç»Ÿä¸€å…¨çƒå­—ç¬¦ç¼–ç çš„æ ‡å‡†ï¼ˆçº¦ 150,000 ä¸ªå­—ç¬¦ï¼‰\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eord(char)\u003c/code\u003eï¼šè·å–å­—ç¬¦çš„åè¿›åˆ¶ç¼–ç \u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eord\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;h\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e     \u003cspan class=\"c1\"\u003e# 104\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eord\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;ğŸ˜Š\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e    \u003cspan class=\"c1\"\u003e# 128522\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"12-ç¼–è§£ç \"\u003e1.2. ç¼–è§£ç \u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eCharacterTokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34;Represent a string as a sequence of Unicode code points.\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e]:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eord\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003echr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eç¤ºä¾‹\u003c/strong\u003eï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCharacterTokenizer\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Hello, ğŸŒ! ä½ å¥½!\u0026#34;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# @inspect string\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eindices\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# @inspect indices\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ereconstructed_string\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etokenizer\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edecode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# @inspect reconstructed_string\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eè¾“å‡º\u003c/strong\u003eï¼š\u003c/p\u003e","title":"Tokenization"},{"content":"åˆ†ç±»è¯„ä¼°æŒ‡æ ‡ TP / TN / FP / FN åŸºæœ¬æ¦‚å¿µ\nå‡è®¾æˆ‘ä»¬åšçš„æ˜¯â€œæ£€æµ‹æ˜¯å¦ç”Ÿç—…â€çš„ä»»åŠ¡ï¼Œæ¨¡å‹é¢„æµ‹ç»“æœ vs å®é™…æƒ…å†µå¦‚ä¸‹è¡¨ï¼š\nå®é™…æƒ…å†µ\\é¢„æµ‹ç»“æœ é¢„æµ‹ä¸ºé˜³æ€§ï¼ˆç”Ÿç—…ï¼‰ é¢„æµ‹ä¸ºé˜´æ€§ï¼ˆæ²¡ç—…ï¼‰ å®é™…æ˜¯é˜³æ€§ï¼ˆç”Ÿç—…ï¼‰ âœ… TPï¼ˆçœŸæ­£ï¼‰ âŒ FNï¼ˆå‡è´Ÿï¼‰ å®é™…æ˜¯é˜´æ€§ï¼ˆæ²¡ç—…ï¼‰ âŒ FPï¼ˆå‡æ­£ï¼‰ âœ… TNï¼ˆçœŸè´Ÿï¼‰ TP (True Positive)ï¼šé¢„æµ‹â€œæœ‰ç—…â€ï¼Œå®é™…ä¹Ÿâ€œæœ‰ç—…â€ â†’ åˆ¤æ–­æ­£ç¡® TN (True Negative)ï¼šé¢„æµ‹â€œæ²¡ç—…â€ï¼Œå®é™…ä¹Ÿâ€œæ²¡ç—…â€ â†’ åˆ¤æ–­æ­£ç¡® FP (False Positive)ï¼šé¢„æµ‹â€œæœ‰ç—…â€ï¼Œå®é™…å´â€œæ²¡ç—…â€ â†’ è¯¯æŠ¥ FN (False Negative)ï¼šé¢„æµ‹â€œæ²¡ç—…â€ï¼Œå®é™…å´â€œæœ‰ç—…â€ â†’ æ¼æŠ¥ï¼ˆæ›´ä¸¥é‡ï¼‰ å‡†ç¡®ç‡ï¼ˆAccuracyï¼‰ æ¨¡å‹åˆ¤æ–­æ­£ç¡®çš„æ€»ä½“æ¯”ä¾‹ $$ Accuracy = \\frac{(TP + TN)}{(TP + TN + FP + FN)} $$\nå¬å›ç‡ï¼ˆRecallï¼‰ åœ¨æ‰€æœ‰çœŸæ­£ä¾‹ä¸­ï¼Œæ¨¡å‹è¯†åˆ«å‡ºæ¥çš„æ¯”ä¾‹ï¼ˆä¸æ¼æ‰ï¼‰ $$ Recall = \\frac{TP}{(TP + FN)} $$\nç²¾ç¡®ç‡ï¼ˆPrecisionï¼‰ æ¨¡å‹é¢„æµ‹ä¸ºæ­£ä¸­ï¼Œç¡®å®ä¸ºæ­£çš„æ¯”ä¾‹ï¼ˆä¸å†¤æ‰ï¼‰ $$ Precision = \\frac{TP}{(TP + FP)} $$\nF1-score ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡ $$ F1 = \\frac{2 Ã— (Precision Ã— Recall)}{(Precision + Recall)} $$\næ’åºè´¨é‡è¯„ä¼°æŒ‡æ ‡ å¹³å‡å‡†ç¡®ç‡ï¼ˆAverage Precisionï¼ŒAPï¼‰ ä¸€å¥è¯è§£é‡Šï¼šä¸€ä¸ªç±»åˆ«çš„å¹³å‡â€œç²¾ç¡®ç‡â€ï¼Œä»¥æŸä¸€ç±»åˆ«çš„ç›®æ ‡æ£€æµ‹ä¸ºä¾‹ï¼š\n1. å¯¹é¢„æµ‹æ¡†æŒ‰ç½®ä¿¡åˆ†æ•°ä»é«˜åˆ°ä½æ’åº æ¯ä¸ªé¢„æµ‹ç»“æœéƒ½æœ‰ï¼š\nä½ç½®æ¡†ï¼ˆbounding boxï¼‰ åˆ†æ•°ï¼ˆconfidenceï¼‰ é¢„æµ‹æ ‡ç­¾ æŒ‰é¢„æµ‹åˆ†æ•°ä»é«˜åˆ°ä½æ’åº\n2. åˆ¤æ–­æ¯ä¸ªé¢„æµ‹æ˜¯ TP è¿˜æ˜¯ FP ä¾æ¬¡éå†é¢„æµ‹æ¡†ï¼š\nå¦‚æœä¸æŸä¸ªå°šæœªåŒ¹é…çš„çœŸå®æ¡† IoU â‰¥ é˜ˆå€¼ï¼ˆå¦‚ 0.5ï¼‰ï¼Œåˆ™ä¸º TP å¦åˆ™ä¸º FP è®°å½•æ¯ä¸ªé¢„æµ‹çš„ TP/FP æ ‡è®°\n3. è®¡ç®—ç´¯è®¡ Precision \u0026amp; Recall éå†æ¯ä¸ªé¢„æµ‹ç‚¹ï¼Œä»ç¬¬ä¸€ä¸ªå¼€å§‹ï¼Œæ¯é¢„æµ‹ä¸€ä¸ªéƒ½æ›´æ–°ï¼š\nç´¯ç§¯ TP æ•°ï¼ˆTP_iï¼‰ ç´¯ç§¯ FP æ•°ï¼ˆFP_iï¼‰ ç„¶åç®—ï¼š\nprecision_i = TP_i / (TP_i + FP_i) recall_i = TP_i / GT_total # GT_total ä¸ºæ€»çš„çœŸå®æ¡†æ•°é‡ 4. ç”» PR æ›²çº¿ \u0026amp; è®¡ç®—é¢ç§¯ é€æ­¥ç§¯åˆ†:\n# Recall, Precision å·²æŒ‰ recall å‡åºæ’åˆ— AP = 0 for i in range(1, len(recall)): AP += precision[i] * (recall[i] - recall[i-1]) mAPï¼ˆmean Average Precisionï¼‰ æ‰€æœ‰ç±»åˆ«çš„ AP å¹³å‡å€¼\n$$ mAP = \\sum_i AP_i $$\nmAP@IoU=0.5ï¼ˆmAP@0.5ï¼‰ é¢„æµ‹çš„æ¡†å’ŒçœŸå®æ¡†çš„ IoUï¼ˆäº¤å¹¶æ¯”ï¼‰â‰¥ 0.5 æ—¶ï¼Œæ‰ç®—æ­£ç¡®ï¼ˆTPï¼‰ ç„¶åè®¡ç®—æ¯ä¸ªç±»çš„ APï¼Œå†å¹³å‡ï¼Œå°±æ˜¯ mAP@0.5 mAP@0.5:0.95 IoU ä» 0.5 åˆ° 0.95ï¼Œæ¯éš” 0.05 è®¡ç®—ä¸€æ¬¡ï¼ˆå…± 10 ä¸ª IoU é˜ˆå€¼ï¼‰ å¹³å‡è¿™ 10 ä¸ª AP â†’ å¾—åˆ°æœ€ç»ˆ mAP mAP@k å¸¸ç”¨äº å›¾åƒæ£€ç´¢ / æ¨èç³»ç»Ÿ / å¤šæ ‡ç­¾æ’åºï¼š\nè¡¨ç¤ºåœ¨æ¯æ¬¡æ£€ç´¢çš„å‰ k ä¸ªç»“æœ ä¸­ï¼Œè®¡ç®— APï¼Œç„¶åå¯¹æ‰€æœ‰æŸ¥è¯¢æ±‚å¹³å‡\nä¸¾ä¾‹ ä½ æœç´¢â€œç‹—â€ï¼Œæ¨¡å‹è¿”å›å‰10å¼ å›¾ç‰‡ï¼š\næœ‰6å¼ æ˜¯ç‹—ï¼Œ4å¼ ä¸æ˜¯ï¼Œä¸”ç‹—åˆ†å¸ƒåœ¨ç¬¬1ã€2ã€3ã€6ã€7ã€9ä½ ä½ è®¡ç®—è¿™äº›ä½ç½®ä¸Šçš„ Precisionï¼Œå†æ±‚å¹³å‡ â†’ å¾—åˆ° AP@10 å¯¹æ‰€æœ‰ç”¨æˆ·æŸ¥è¯¢æ±‚å¹³å‡ â†’ å¾—åˆ° mAP@10 Captionä»»åŠ¡æŒ‡æ ‡ SPICE ä¸ºä»€ä¹ˆéœ€è¦ SPICEï¼Ÿ ä¼ ç»ŸæŒ‡æ ‡å¦‚ï¼š\nBLEUï¼šå…³æ³¨ n-gram åŒ¹é…ï¼ˆåƒæœºå™¨ç¿»è¯‘ï¼‰ ROUGEï¼šå…³æ³¨å¬å›ç‡ï¼ˆé€‚åˆæ‘˜è¦ï¼‰ CIDErï¼šè€ƒè™‘ TF-IDF åŠ æƒçš„ n-gram åŒ¹é… å®ƒä»¬éƒ½çœ‹çš„æ˜¯â€œè¯â€å’Œâ€œçŸ­è¯­â€é‡ä¸é‡å¤ï¼Œå´å¿½ç•¥äº†è¯­ä¹‰ç»“æ„æ˜¯å¦å¯¹ã€‚\nè€Œ SPICE çš„ç†å¿µæ˜¯ï¼š\nâ€œäººç±»è¯„ä»·å›¾åƒæè¿°æ—¶ï¼Œçœ‹çš„æ˜¯ä½ æœ‰æ²¡æœ‰è¯´å‡ºå¯¹çš„å¯¹è±¡ã€å±æ€§å’Œå…³ç³»ã€‚â€\nSPICE è®¡ç®—æ–¹æ³• æ ¸å¿ƒæ€æƒ³ï¼š æŠŠå¥å­è½¬æ¢ä¸ºä¸€ä¸ªè¯­ä¹‰å›¾ï¼ˆscene graphï¼‰ï¼šå¯¹è±¡ + å±æ€§ + å…³ç³»ï¼Œç„¶åæ¯”è¾ƒæœºå™¨æè¿°å’Œå‚è€ƒæè¿°çš„è¯­ä¹‰å›¾æœ‰å¤šç›¸ä¼¼\nè¯­ä¹‰å›¾ç»“æ„å®šä¹‰ ä¸€å¥è¯è¢«è¡¨ç¤ºä¸ºä¸€ç»„ä¸‰å…ƒç»„ï¼ˆtriplesï¼‰ï¼š\nG = {object, attribute, relation} ä¾‹å¦‚ï¼š\nSentence: \u0026#34;A red car is parked beside a white house\u0026#34; G = { (object: car), (object: house), (attribute: car, red), (attribute: house, white), (relation: car, beside, house) } æ•°å­¦å…¬å¼å®šä¹‰ è¾“å…¥ï¼š\n$G$: ç”Ÿæˆå¥å­çš„è¯­ä¹‰ä¸‰å…ƒç»„é›†åˆï¼ˆGraph of candidateï¼‰ $R$: æ‰€æœ‰å‚è€ƒå¥å­çš„è¯­ä¹‰ä¸‰å…ƒç»„é›†åˆï¼ˆGraph of referencesï¼‰ ç›®æ ‡ï¼š\nè®¡ç®— $F_1$ score between $G$ and $R$ åŒ¹é…é›†åˆï¼š\nPrecision: $$ P = \\frac{|\\mathcal{G} \\cap \\mathcal{R}|}{|\\mathcal{G}|} $$ â€‹\nRecall: $$ R = \\frac{|\\mathcal{G} \\cap \\mathcal{R}|}{|\\mathcal{R}|} $$\nF1-score: $$ F_1 = \\frac{2PR}{P + R} $$\nå³ï¼š$\\text{SPICE} = F_1(G, R)$\nåˆ†åˆ«ç»Ÿè®¡ï¼š\nå¯¹è±¡åŒ¹é…ï¼ˆobject F1ï¼‰\nå±æ€§åŒ¹é…ï¼ˆattribute F1ï¼‰\nå…³ç³»åŒ¹é…ï¼ˆrelation F1ï¼‰\nç”šè‡³æ˜¯é¢œè‰²ã€æ•°é‡ã€å¤§å°ç­‰ç»†åˆ†ç±»åˆ«\næœ€ç»ˆ SPICE å¾—åˆ†æ˜¯å®ƒä»¬çš„åŠ æƒå¹³å‡ï¼š\n$$ \\text{SPICE}=\\sum_i w_i \\cdot F_1^i $$\nå…¶ä¸­ $F_1^i$ æ˜¯æ¯ç§è¯­ä¹‰ç±»åˆ«ï¼ˆå¯¹è±¡ã€å±æ€§ç­‰ï¼‰çš„ F1ï¼Œ$w_i$ æ˜¯æ¯ç±»çš„æƒé‡\n","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/metric/","summary":"\u003ch2 id=\"åˆ†ç±»è¯„ä¼°æŒ‡æ ‡\"\u003eåˆ†ç±»è¯„ä¼°æŒ‡æ ‡\u003c/h2\u003e\n\u003cblockquote\u003e\n\u003cp\u003eTP / TN / FP / FN åŸºæœ¬æ¦‚å¿µ\u003c/p\u003e\n\u003cp\u003eå‡è®¾æˆ‘ä»¬åšçš„æ˜¯â€œæ£€æµ‹æ˜¯å¦ç”Ÿç—…â€çš„ä»»åŠ¡ï¼Œæ¨¡å‹é¢„æµ‹ç»“æœ vs å®é™…æƒ…å†µå¦‚ä¸‹è¡¨ï¼š\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eå®é™…æƒ…å†µ\\é¢„æµ‹ç»“æœ\u003c/th\u003e\n          \u003cth\u003eé¢„æµ‹ä¸ºé˜³æ€§ï¼ˆç”Ÿç—…ï¼‰\u003c/th\u003e\n          \u003cth\u003eé¢„æµ‹ä¸ºé˜´æ€§ï¼ˆæ²¡ç—…ï¼‰\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eå®é™…æ˜¯é˜³æ€§ï¼ˆç”Ÿç—…ï¼‰\u003c/td\u003e\n          \u003ctd\u003eâœ… TPï¼ˆçœŸæ­£ï¼‰\u003c/td\u003e\n          \u003ctd\u003eâŒ FNï¼ˆå‡è´Ÿï¼‰\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eå®é™…æ˜¯é˜´æ€§ï¼ˆæ²¡ç—…ï¼‰\u003c/td\u003e\n          \u003ctd\u003eâŒ FPï¼ˆå‡æ­£ï¼‰\u003c/td\u003e\n          \u003ctd\u003eâœ… TNï¼ˆçœŸè´Ÿï¼‰\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eTP (True Positive)\u003c/strong\u003eï¼šé¢„æµ‹â€œæœ‰ç—…â€ï¼Œå®é™…ä¹Ÿâ€œæœ‰ç—…â€ â†’ åˆ¤æ–­æ­£ç¡®\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eTN (True Negative)\u003c/strong\u003eï¼šé¢„æµ‹â€œæ²¡ç—…â€ï¼Œå®é™…ä¹Ÿâ€œæ²¡ç—…â€ â†’ åˆ¤æ–­æ­£ç¡®\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eFP (False Positive)\u003c/strong\u003eï¼šé¢„æµ‹â€œæœ‰ç—…â€ï¼Œå®é™…å´â€œæ²¡ç—…â€ â†’ è¯¯æŠ¥\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eFN (False Negative)\u003c/strong\u003eï¼šé¢„æµ‹â€œæ²¡ç—…â€ï¼Œå®é™…å´â€œæœ‰ç—…â€ â†’ æ¼æŠ¥ï¼ˆæ›´ä¸¥é‡ï¼‰\u003c/li\u003e\n\u003c/ul\u003e\u003c/blockquote\u003e\n\u003chr\u003e\n\u003ch3 id=\"å‡†ç¡®ç‡accuracy\"\u003eå‡†ç¡®ç‡ï¼ˆAccuracyï¼‰\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eæ¨¡å‹åˆ¤æ–­æ­£ç¡®çš„æ€»ä½“æ¯”ä¾‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e$$\nAccuracy = \\frac{(TP + TN)}{(TP + TN + FP + FN)}\n$$\u003c/p\u003e\n\u003chr\u003e\n\u003ch3 id=\"å¬å›ç‡recall\"\u003eå¬å›ç‡ï¼ˆRecallï¼‰\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eåœ¨æ‰€æœ‰çœŸæ­£ä¾‹ä¸­ï¼Œæ¨¡å‹è¯†åˆ«å‡ºæ¥çš„æ¯”ä¾‹ï¼ˆä¸æ¼æ‰ï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e$$\nRecall = \\frac{TP}{(TP + FN)}\n$$\u003c/p\u003e","title":"è®°å½•100ç§è¯„ä»·æŒ‡æ ‡"},{"content":"GPT-1 å‡ºå‘ç‚¹ ç›®å‰å°šä¸æ¸…æ¥šå“ªç§ç±»å‹çš„ä¼˜åŒ–ç›®æ ‡æœ€æœ‰æ•ˆåœ°å­¦ä¹ å¯¹è¿ç§»æœ‰æ•ˆçš„æ–‡æœ¬è¡¨ç¤ºï¼ˆä¸ªäººç†è§£å¯¹äºä¸åŒçš„NLPä»»åŠ¡ï¼Œä¸çŸ¥é“å“ªç§ä¼˜åŒ–ç›®æ ‡æ˜¯æœ€å¥½çš„ï¼‰\næ–¹æ³• åŠç›‘ç£çš„æ–¹æ³• Transformerï¼ˆç”¨äºå¤„ç†é•¿æœŸä¾èµ–æ€§çš„æ›´å¤šç»“æ„åŒ–è®°å¿†ï¼‰\u0026ndash;\u0026gt; å¼ºå¤§çš„è¿ç§»æ€§èƒ½ğŸ”¤ 1. éç›‘ç£é¢„è®­ç»ƒï¼ˆUnsupervised pre-trainingï¼‰ ä¼˜åŒ–ç›®æ ‡ï¼š\nç»™å®šä¸€ç»„ unsupervised corpus of tokens $U = \\{u_1, \\cdots , u_n\\}$\n$$ L_1(U) = \\sum_i \\log{P(u_i | u_{i-k}, \\cdots, u_{i-1}; \\Theta)}, i \\in {1,\\cdots, n} $$\nkæ˜¯ä¸Šä¸‹æ–‡çª—å£çš„å¤§å°ï¼Œä½¿ç”¨å…·æœ‰å‚æ•°$Î¸$çš„ç¥ç»ç½‘ç»œå¯¹æ¡ä»¶æ¦‚ç‡$P$è¿›è¡Œå»ºæ¨¡ï¼› è¿™é‡Œçš„ $P(u_i | u_{i-k}, \\cdots, u_{i-1}; \\Theta)$ æŒ‡çš„æ˜¯å·²çŸ¥æ¨¡å‹å‚æ•°$Î¸$ä¸å‰ n ä¸ªtokençš„æƒ…å†µä¸‹ï¼Œé¢„æµ‹å‡ºç¬¬ i ä¸ªtokençš„æ¦‚ç‡ ç”±äºGPTä½¿ç”¨çš„æ˜¯éç›‘ç£é¢„è®­ç»ƒæ–¹æ³•ï¼Œåœ¨ç»™å®šä¸€æ®µæ–‡æœ¬ä¸­çš„ k ä¸ªtokenæ—¶ï¼Œå°±æ˜¯è¦è®©æ¨¡å‹é¡ºåˆ©çš„é¢„æµ‹å‡ºç¬¬ i ä¸ªtokenã€‚å› æ­¤å°†æ¯ä¸ªtokençš„é¢„æµ‹æ¦‚ç‡ $P(u_i | u_{i-k}, \\cdots, u_{i-1}; \\Theta)$ æ±‚å’Œå¹¶æœ€å¤§åŒ–ï¼Œå°±æ˜¯è¯¥æ¨¡å‹çš„ä¼˜åŒ–ç›®æ ‡ï¼Œè¯¥ç›®æ ‡é€‚ç”¨äºä»»ä½•ä»»åŠ¡ã€‚ï¼ˆè§£å†³å‡ºå‘ç‚¹é—®é¢˜ï¼‰\næ¨¡å‹æ¶æ„ï¼š\nmulti-layer Transformer decoder\n$$ \\begin{aligned} h_0 \u0026amp;= UW_e + W_p \\\\ h_i \u0026amp;= \\text{transformer block}(h_{i-1}) \\\\ P(u) \u0026amp;= \\text{softmax}(h_n W_e^T) \\end{aligned} $$\nWe is the token embedding matrix\nWp is the position embedding matrix\n2. åŸºäºç›‘ç£çš„å¾®è°ƒï¼ˆSupervised fine-tuningï¼‰ å‡è®¾æœ‰ä¸€æ ‡æ³¨è¿‡çš„æ•°æ®é›†ï¼Œå…¶åŒ…å«ï¼š\na sequence of input tokens, $x1, \\cdots , xm$ label $y$ è·å¾—æœ€åä¸€å±‚Transformerå—çš„æ¿€æ´»å±‚è¾“å‡º$h^m_l$\n$$ P(y|x^1, \\dots, x^m) = \\text{softmax}(h_l^m W_y) $$\n$$ L_2(\\hat{C}) = \\sum_{(x, y)} \\log P(y|x^1, \\dots, x^m) $$\nå’Œç›®æ ‡å‡½æ•° L1 æ„é€ ç±»ä¼¼ï¼Œä¸è¿‡æ˜¯ä»¤é¢„æµ‹æ ‡ç­¾æ¦‚ç‡æœ€å¤§\n$$ L_3(\\hat{C}) = L_2(\\hat{C}) + \\lambda * L_1(\\hat{C}) $$\nå¾®è°ƒä»»åŠ¡ä¸­çš„ä¼˜åŒ–ç›®æ ‡å‡½æ•°ç”±L1å’ŒL2ç»„æˆã€‚\n3. ä¸åŒä»»åŠ¡çš„è¾“å…¥æ„é€ ï¼ˆTask-specific input transformationsï¼‰ ç®€å•è®²è®²ç›¸ä¼¼åº¦ä»»åŠ¡ã€‚ç”±äºGPTæ˜¯å•å‘çš„æ¨¡å‹ï¼ˆTransformeræ˜¯ä¸€ä¸ªè¯ä¸€ä¸ªè¯çš„ç”Ÿæˆçš„ï¼‰ï¼Œæ‰€ä»¥åœ¨å¤„ç†ç›¸ä¼¼åº¦ä»»åŠ¡æ—¶ï¼ŒText 1 å’Œ Text 2 çš„å…ˆåé¡ºåºå¾ˆé‡è¦ï¼Œå¯ä»¥æŒ‰ç…§ä¸åŒçš„æ’åˆ—é¡ºåºæ’æ”¾ï¼Œåˆ©ç”¨GPTè®¡ç®—ç›¸ä¼¼åº¦å–å¹³å‡ç›¸ä¼¼åº¦ã€‚\nGPT-2 å‡ºå‘ç‚¹ åˆ›å»ºMachine Learningç³»ç»Ÿçš„ä¸»è¦æ–¹æ³•æ˜¯æ”¶é›†ä¸€ä¸ªç”¨äºè®­ç»ƒçš„æ•°æ®é›†ï¼Œåœ¨æŸä¸€ç‰¹å®šé¢†åŸŸä½¿ç”¨æŸä¸€ç‰¹å®šæ•°æ®é›†æ˜¯å¯¼è‡´æ¨¡å‹ç¼ºä¹æ³›åŒ–æ€§èƒ½çš„ä¸»è¦åŸå› ã€‚\næ–¹æ³• Multitask learning å¤šä»»åŠ¡å­¦ä¹  \u0026ndash;\u0026gt; è¯­è¨€æ¨¡å‹å¯ä»¥åœ¨zero-shotè®¾ç½®ä¸­æ‰§è¡Œä¸‹æ¸¸ä»»åŠ¡ï¼Œåœ¨æ²¡æœ‰ä»»ä½•å‚æ•°æˆ–æ¶æ„ä¿®æ”¹çš„æƒ…å†µä¸‹\npre-training + supervised finetuning\næ¨¡å‹çš„ä¼˜åŒ–ç›®æ ‡ä¸º p(output|input, task)ï¼Œå…·ä½“å¯ä»¥æè¿°ä¸º {task(è§†ä½œprompt), input, output}ï¼š\nä¾‹1ï¼ša translation training example can be written as the sequence (translate to french, english text, french text) ä¾‹2ï¼šreading comprehension training example can be written as (answer the question, document, question, answer) è®­ç»ƒæ•°æ® Redditç½‘ç«™ä¸Šè‡³å°‘åŒ…å« 3 karmaçš„æ–‡ç« ï¼Œçˆ¬å–äº†4500ä¸‡ä¸ªé“¾æ¥ï¼Œæœ€ç»ˆè·å¾—800ä¸‡ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«40GBçš„æ–‡æœ¬å†…å®¹ æ¨¡å‹ ä¸GPTå¤§è‡´ä¸€è‡´\nGPT-3 å‡ºå‘ç‚¹ å¤§å¤šæ•°è¯­è¨€æ¨¡å‹åœ¨ä»»åŠ¡ä¸å¯çŸ¥çš„æƒ…å†µä¸‹ï¼Œä»ç„¶éœ€è¦ç‰¹å®šäºä»»åŠ¡çš„æ•°æ®é›†å’Œç‰¹å®šäºä»»åŠ¡çš„å¾®è°ƒ\néœ€è¦é’ˆå¯¹ä»»åŠ¡çš„ã€åŒ…å«æ ‡æ³¨å®ä¾‹çš„å¤§æ•°æ®é›† åœ¨å¾®è°ƒæ•°æ®é›†ä¸Šçš„æ•ˆæœå¥½å¹¶ä¸ä»£è¡¨æ¨¡å‹çš„æ³›åŒ–æ€§èƒ½è‰¯å¥½ æ–¹æ³• meta-learningï¼šè®­ç»ƒä¸€ä¸ªæ³›åŒ–æ€§ä¸é”™çš„æ¨¡å‹\nin-context learningï¼šåœ¨åç»­è¿‡ç¨‹ä¸­ï¼Œå³ä½¿å·²çŸ¥ä¸€äº›è®­ç»ƒæ ·æœ¬ï¼Œä¹Ÿä¸æ›´æ–°æ¨¡å‹æƒé‡ï¼ˆä¸ªäººç†è§£å°±æ˜¯åœ¨æé—®è¿‡ç¨‹ä¸­åŒ…å«ä¸€äº›è®­ç»ƒæ ·æœ¬ï¼‰ï¼š\nzero-shot one-shot few-shot æ¨¡å‹åŠå…¶æ¶æ„ ä½¿ç”¨ä¸GPT-2ç›¸åŒçš„æ¨¡å‹å’Œæ¶â€‹â€‹æ„ Sparse Transformer 8ç§ä¸åŒå°ºå¯¸ å‚è€ƒæ–‡çŒ® GPTï¼ŒGPT-2ï¼ŒGPT-3 è®ºæ–‡ç²¾è¯»ã€è®ºæ–‡ç²¾è¯»ã€‘ Improving language understanding by generative pre-training Language models are unsupervised multitask learners Language Models are Few-Shot Learners ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/gpt/","summary":"\u003ch2 id=\"gpt-1\"\u003eGPT-1\u003c/h2\u003e\n\u003ch3 id=\"å‡ºå‘ç‚¹\"\u003eå‡ºå‘ç‚¹\u003c/h3\u003e\n\u003cp\u003eç›®å‰å°šä¸æ¸…æ¥šå“ªç§ç±»å‹çš„ä¼˜åŒ–ç›®æ ‡æœ€æœ‰æ•ˆåœ°å­¦ä¹ å¯¹è¿ç§»æœ‰æ•ˆçš„æ–‡æœ¬è¡¨ç¤ºï¼ˆä¸ªäººç†è§£å¯¹äºä¸åŒçš„NLPä»»åŠ¡ï¼Œä¸çŸ¥é“å“ªç§ä¼˜åŒ–ç›®æ ‡æ˜¯æœ€å¥½çš„ï¼‰\u003c/p\u003e\n\u003ch3 id=\"æ–¹æ³•\"\u003eæ–¹æ³•\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eåŠç›‘ç£çš„æ–¹æ³•\u003c/li\u003e\n\u003cli\u003eTransformerï¼ˆç”¨äºå¤„ç†é•¿æœŸä¾èµ–æ€§çš„æ›´å¤šç»“æ„åŒ–è®°å¿†ï¼‰\u0026ndash;\u0026gt; å¼ºå¤§çš„è¿ç§»æ€§èƒ½ğŸ”¤\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"1-éç›‘ç£é¢„è®­ç»ƒunsupervised-pre-training\"\u003e1. éç›‘ç£é¢„è®­ç»ƒï¼ˆUnsupervised pre-trainingï¼‰\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eä¼˜åŒ–ç›®æ ‡ï¼š\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eç»™å®šä¸€ç»„ unsupervised corpus of tokens $U = \\{u_1, \\cdots , u_n\\}$\u003c/p\u003e\n\u003cp\u003e$$\nL_1(U) = \\sum_i \\log{P(u_i | u_{i-k}, \\cdots, u_{i-1}; \\Theta)}, i \\in {1,\\cdots, n}\n$$\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ekæ˜¯ä¸Šä¸‹æ–‡çª—å£çš„å¤§å°ï¼Œä½¿ç”¨å…·æœ‰å‚æ•°$Î¸$çš„ç¥ç»ç½‘ç»œå¯¹æ¡ä»¶æ¦‚ç‡$P$è¿›è¡Œå»ºæ¨¡ï¼›\u003c/li\u003e\n\u003cli\u003eè¿™é‡Œçš„ $P(u_i | u_{i-k}, \\cdots, u_{i-1}; \\Theta)$ æŒ‡çš„æ˜¯å·²çŸ¥æ¨¡å‹å‚æ•°$Î¸$ä¸å‰ n ä¸ªtokençš„æƒ…å†µä¸‹ï¼Œé¢„æµ‹å‡ºç¬¬ i ä¸ªtokençš„æ¦‚ç‡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç”±äºGPTä½¿ç”¨çš„æ˜¯éç›‘ç£é¢„è®­ç»ƒæ–¹æ³•ï¼Œåœ¨ç»™å®šä¸€æ®µæ–‡æœ¬ä¸­çš„ k ä¸ªtokenæ—¶ï¼Œå°±æ˜¯è¦è®©æ¨¡å‹é¡ºåˆ©çš„é¢„æµ‹å‡ºç¬¬ i ä¸ªtokenã€‚å› æ­¤å°†æ¯ä¸ªtokençš„é¢„æµ‹æ¦‚ç‡ $P(u_i | u_{i-k}, \\cdots, u_{i-1}; \\Theta)$ æ±‚å’Œå¹¶æœ€å¤§åŒ–ï¼Œå°±æ˜¯è¯¥æ¨¡å‹çš„ä¼˜åŒ–ç›®æ ‡ï¼Œè¯¥ç›®æ ‡é€‚ç”¨äºä»»ä½•ä»»åŠ¡ã€‚ï¼ˆè§£å†³å‡ºå‘ç‚¹é—®é¢˜ï¼‰\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eæ¨¡å‹æ¶æ„ï¼š\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003emulti-layer Transformer decoder\u003c/p\u003e\n\u003cp\u003e$$\n\\begin{aligned}\nh_0 \u0026amp;= UW_e + W_p \\\\\nh_i \u0026amp;= \\text{transformer block}(h_{i-1}) \\\\\nP(u) \u0026amp;= \\text{softmax}(h_n W_e^T)\n\\end{aligned}\n$$\u003c/p\u003e","title":"GPTç³»åˆ—"},{"content":"LoRA LORAæ˜¯ä¸€ç§ä½èµ„æºå¾®è°ƒå¤§æ¨¡å‹æ–¹æ³•ï¼Œå‡ºè‡ªè®ºæ–‡LoRA: Low-Rank Adaptation of Large Language Modelsã€‚ ä½¿ç”¨LORAï¼Œè®­ç»ƒå‚æ•°ä»…ä¸ºæ•´ä½“å‚æ•°çš„ä¸‡åˆ†ä¹‹ä¸€ã€GPUæ˜¾å­˜ä½¿ç”¨é‡å‡å°‘2/3ä¸”ä¸ä¼šå¼•å…¥é¢å¤–çš„æ¨ç†è€—æ—¶.\næ ¸å¿ƒæ€æƒ³ ä½ç§©åˆ†è§£: ä¸ç›´æ¥æ›´æ–°é¢„è®­ç»ƒæ¨¡å‹çš„æƒé‡,è€Œæ˜¯å­¦ä¹ ä½ç§©åˆ†è§£çŸ©é˜µ å‚æ•°æ•ˆç‡: æ˜¾è‘—å‡å°‘éœ€è¦è®­ç»ƒçš„å‚æ•°æ•°é‡ åŸå§‹æƒé‡ä¿æŒ: ä¿æŒé¢„è®­ç»ƒæ¨¡å‹çš„æƒé‡ä¸å˜,åªè®­ç»ƒé¢å¤–çš„ä½ç§©çŸ©é˜µ æŠ€æœ¯åŸç† 1. é«˜æ•ˆå¾®è°ƒåŸºæœ¬åŸç† full fine-tuing\nä»¥è¯­è¨€æ¨¡å‹ä¸ºä¾‹ï¼Œåœ¨å¾®è°ƒè¿‡ç¨‹ä¸­æ¨¡å‹åŠ è½½é¢„è®­ç»ƒå‚æ•°$\\Phi_0$è¿›è¡Œåˆå§‹åŒ–,å¹¶é€šè¿‡æœ€å¤§åŒ–æ¡ä»¶è¯­è¨€æ¨¡å‹æ¦‚ç‡è¿›è¡Œå‚æ•°æ›´æ–°$\\Phi_0 + \\Delta \\Phi$ï¼Œå³ï¼š\n$$ \\max_{\\Phi} \\sum_{(x,y)\\in\\mathcal{Z}} \\sum^{\\lvert y \\rvert}_{t=1} \\log{(P^{\\Phi}(y_t|x,y \u0026lt; t))} $$\nè¿™ç§å¾®è°ƒæ–¹å¼ä¸»è¦çš„ç¼ºç‚¹æ˜¯æˆ‘ä»¬å­¦ä¹ åˆ°çš„å‚æ•°å¢é‡$\\Delta \\Phi$çš„ç»´åº¦å’Œé¢„è®­ç»ƒå‚æ•°$\\Phi_0$æ˜¯ä¸€è‡´çš„ï¼Œè¿™ç§å¾®è°ƒæ–¹å¼æ‰€éœ€çš„èµ„æºå¾ˆå¤šï¼Œä¸€èˆ¬è¢«ç§°ä¸ºfull fine-tuingã€‚\né«˜æ•ˆå¾®è°ƒ\nç ”ç©¶è€…è®¤ä¸ºå¯ä»¥ç”¨æ›´å°‘çš„å‚æ•°è¡¨ç¤ºä¸Šè¿°è¦å­¦ä¹ çš„å‚æ•°å¢é‡$\\Delta \\Phi = \\Delta \\Phi(\\Theta)$ï¼Œå…¶ä¸­$\\lvert \\Theta \\rvert \\ll \\lvert \\Phi_0 \\rvert$ï¼ŒåŸå…ˆå¯»æ‰¾çš„ä¼˜åŒ–ç›®æ ‡å˜ä¸ºå¯»æ‰¾ï¼š\n$$ \\max_{\\Theta} \\sum_{(x,y)\\in\\mathcal{Z}} \\sum^{\\lvert y \\rvert}_{t=1} \\log{(P^{\\Phi_0 + \\Delta \\Phi(\\Theta)}(y_t|x,y \u0026lt; t))} $$\nè¿™ç§ä»…å¾®è°ƒä¸€éƒ¨åˆ†å‚æ•°çš„æ–¹æ³•ç§°ä¸ºé«˜æ•ˆå¾®è°ƒã€‚é’ˆå¯¹é«˜æ•ˆå¾®è°ƒï¼Œç ”ç©¶è€…æœ‰å¾ˆå¤šçš„å®ç°æ–¹å¼(å¦‚Adapterã€prefixtuingç­‰)ã€‚æœ¬æ–‡ä½œè€…æ—¨åœ¨ä½¿ç”¨ä¸€ä¸ªä½ç§©çŸ©é˜µæ¥ç¼–ç ï¼Œç›¸æ¯”äºå…¶ä»–æ–¹æ³•ï¼ŒLORAä¸ä¼šå¢åŠ æ¨ç†è€—æ—¶ä¸”æ›´ä¾¿äºä¼˜åŒ–ã€‚\n2. æ•°å­¦è¡¨è¾¾ Aghajanyançš„ç ”ç©¶è¡¨æ˜ï¼šé¢„è®­ç»ƒæ¨¡å‹æ‹¥æœ‰æå°çš„å†…åœ¨ç»´åº¦(instrisic dimension)ï¼Œå³å­˜åœ¨ä¸€ä¸ªæä½ç»´åº¦çš„å‚æ•°ï¼Œå¾®è°ƒå®ƒå’Œåœ¨å…¨å‚æ•°ç©ºé—´ä¸­å¾®è°ƒèƒ½èµ·åˆ°ç›¸åŒçš„æ•ˆæœã€‚\nç»™å®šåŸå§‹æƒé‡çŸ©é˜µ $W_{\\theta} \\in \\mathbb{R}^{d \\times k}$, LoRA é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œå‚æ•°æ›´æ–°:\n$$ W = W_{\\theta} + BA $$\nå…¶ä¸­:\n$B \\in \\mathbb{R}^{d \\times r}$ï¼Œåˆå§‹åŒ–ä¸º0çŸ©é˜µ $A \\in \\mathbb{R}^{r \\times k}$ï¼Œåˆå§‹åŒ–ä¸ºé«˜æ–¯åˆ†å¸ƒçŸ©é˜µ $r \\ll \\min{(k, d)}$ï¼Œr æ˜¯ç§© (rank),é€šå¸¸è¿œå°äº d å’Œ k åˆå§‹åŒ–$W = W_{\\theta} + \\mathbf{0} \\times A = W_{\\theta}$ 3. ä½ç§©åˆ†è§£çš„ä¼˜åŠ¿ å‚æ•°é‡å‡å°‘: ä» $d \\times k$ å‡å°‘åˆ° $r \\times (d+k)$ å†…å­˜æ•ˆç‡: å¯ä»¥ä½¿ç”¨æ›´å°çš„æ˜¾å­˜è¿›è¡Œè®­ç»ƒ è®¡ç®—æ•ˆç‡: é™ä½äº†è®¡ç®—å¤æ‚åº¦ å‚è€ƒæ–‡çŒ® LoRA: Low-Rank Adaptation of Large Language Models LORAå¾®è°ƒç³»åˆ—(ä¸€)ï¼šLORAå’Œå®ƒçš„åŸºæœ¬åŸç† ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/lora/","summary":"\u003ch2 id=\"lora\"\u003eLoRA\u003c/h2\u003e\n\u003cp align=\"center\"\u003e\n  \u003cimg src=\"lora_overview.png\" alt=\"lora_overview\" width=60% /\u003e\n\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eLORAæ˜¯ä¸€ç§ä½èµ„æº\u003cstrong\u003eå¾®è°ƒ\u003c/strong\u003eå¤§æ¨¡å‹æ–¹æ³•ï¼Œå‡ºè‡ªè®ºæ–‡\u003ca href=\"https://arxiv.org/pdf/2106.09685\"\u003eLoRA: Low-Rank Adaptation of Large Language Models\u003c/a\u003eã€‚\nä½¿ç”¨LORAï¼Œè®­ç»ƒå‚æ•°ä»…ä¸ºæ•´ä½“å‚æ•°çš„ä¸‡åˆ†ä¹‹ä¸€ã€GPUæ˜¾å­˜ä½¿ç”¨é‡å‡å°‘2/3ä¸”ä¸ä¼šå¼•å…¥é¢å¤–çš„æ¨ç†è€—æ—¶.\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch3 id=\"æ ¸å¿ƒæ€æƒ³\"\u003eæ ¸å¿ƒæ€æƒ³\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eä½ç§©åˆ†è§£\u003c/strong\u003e: ä¸ç›´æ¥æ›´æ–°é¢„è®­ç»ƒæ¨¡å‹çš„æƒé‡,è€Œæ˜¯å­¦ä¹ ä½ç§©åˆ†è§£çŸ©é˜µ\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå‚æ•°æ•ˆç‡\u003c/strong\u003e: æ˜¾è‘—å‡å°‘éœ€è¦è®­ç»ƒçš„å‚æ•°æ•°é‡\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eåŸå§‹æƒé‡ä¿æŒ\u003c/strong\u003e: ä¿æŒé¢„è®­ç»ƒæ¨¡å‹çš„æƒé‡ä¸å˜,åªè®­ç»ƒé¢å¤–çš„ä½ç§©çŸ©é˜µ\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"æŠ€æœ¯åŸç†\"\u003eæŠ€æœ¯åŸç†\u003c/h3\u003e\n\u003ch4 id=\"1-é«˜æ•ˆå¾®è°ƒåŸºæœ¬åŸç†\"\u003e1. é«˜æ•ˆå¾®è°ƒåŸºæœ¬åŸç†\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003efull fine-tuing\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eä»¥è¯­è¨€æ¨¡å‹ä¸ºä¾‹ï¼Œåœ¨å¾®è°ƒè¿‡ç¨‹ä¸­æ¨¡å‹åŠ è½½é¢„è®­ç»ƒå‚æ•°$\\Phi_0$è¿›è¡Œåˆå§‹åŒ–,å¹¶é€šè¿‡æœ€å¤§åŒ–æ¡ä»¶è¯­è¨€æ¨¡å‹æ¦‚ç‡è¿›è¡Œå‚æ•°æ›´æ–°$\\Phi_0 + \\Delta \\Phi$ï¼Œå³ï¼š\u003c/p\u003e\n\u003cp\u003e$$\n\\max_{\\Phi} \\sum_{(x,y)\\in\\mathcal{Z}} \\sum^{\\lvert y \\rvert}_{t=1} \\log{(P^{\\Phi}(y_t|x,y \u0026lt; t))}\n$$\u003c/p\u003e\n\u003cp\u003eè¿™ç§å¾®è°ƒæ–¹å¼ä¸»è¦çš„ç¼ºç‚¹æ˜¯æˆ‘ä»¬å­¦ä¹ åˆ°çš„å‚æ•°å¢é‡$\\Delta \\Phi$çš„ç»´åº¦å’Œé¢„è®­ç»ƒå‚æ•°$\\Phi_0$æ˜¯ä¸€è‡´çš„ï¼Œè¿™ç§å¾®è°ƒæ–¹å¼æ‰€éœ€çš„èµ„æºå¾ˆå¤šï¼Œä¸€èˆ¬è¢«ç§°ä¸º\u003cstrong\u003efull fine-tuing\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eé«˜æ•ˆå¾®è°ƒ\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eç ”ç©¶è€…è®¤ä¸ºå¯ä»¥ç”¨æ›´å°‘çš„å‚æ•°è¡¨ç¤ºä¸Šè¿°è¦å­¦ä¹ çš„å‚æ•°å¢é‡$\\Delta \\Phi = \\Delta \\Phi(\\Theta)$ï¼Œå…¶ä¸­$\\lvert \\Theta \\rvert \\ll \\lvert \\Phi_0 \\rvert$ï¼ŒåŸå…ˆå¯»æ‰¾çš„ä¼˜åŒ–ç›®æ ‡å˜ä¸ºå¯»æ‰¾ï¼š\u003c/p\u003e\n\u003cp\u003e$$\n\\max_{\\Theta} \\sum_{(x,y)\\in\\mathcal{Z}} \\sum^{\\lvert y \\rvert}_{t=1} \\log{(P^{\\Phi_0 + \\Delta \\Phi(\\Theta)}(y_t|x,y \u0026lt; t))}\n$$\u003c/p\u003e\n\u003cp\u003eè¿™ç§ä»…å¾®è°ƒä¸€éƒ¨åˆ†å‚æ•°çš„æ–¹æ³•ç§°ä¸º\u003cstrong\u003eé«˜æ•ˆå¾®è°ƒ\u003c/strong\u003eã€‚é’ˆå¯¹é«˜æ•ˆå¾®è°ƒï¼Œç ”ç©¶è€…æœ‰å¾ˆå¤šçš„å®ç°æ–¹å¼(å¦‚Adapterã€prefixtuingç­‰)ã€‚æœ¬æ–‡ä½œè€…æ—¨åœ¨ä½¿ç”¨ä¸€ä¸ªä½ç§©çŸ©é˜µæ¥ç¼–ç ï¼Œç›¸æ¯”äºå…¶ä»–æ–¹æ³•ï¼ŒLORAä¸ä¼šå¢åŠ æ¨ç†è€—æ—¶ä¸”æ›´ä¾¿äºä¼˜åŒ–ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4 id=\"2-æ•°å­¦è¡¨è¾¾\"\u003e2. æ•°å­¦è¡¨è¾¾\u003c/h4\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://arxiv.org/abs/2012.13255\"\u003eAghajanyançš„ç ”ç©¶\u003c/a\u003eè¡¨æ˜ï¼šé¢„è®­ç»ƒæ¨¡å‹æ‹¥æœ‰æå°çš„å†…åœ¨ç»´åº¦(instrisic dimension)ï¼Œå³å­˜åœ¨ä¸€ä¸ªæä½ç»´åº¦çš„å‚æ•°ï¼Œå¾®è°ƒå®ƒå’Œåœ¨å…¨å‚æ•°ç©ºé—´ä¸­å¾®è°ƒèƒ½èµ·åˆ°ç›¸åŒçš„æ•ˆæœã€‚\u003c/p\u003e","title":"LoRA: å¤§æ¨¡å‹ä½ç§©é€‚é…æ–¹æ³•è¯¦è§£"},{"content":"è‡ªå®šä¹‰post_metaæ˜¾ç¤º æœ€åç¼–è¾‘(Lastmod)\nåœ¨config.yamlä¸­æ·»åŠ ï¼š\nfrontmatter: date: - date - publishDate - lastmod lastmod: - :git - :fileModTime - lastmod - date - publishDate æœ€åç¼–è¾‘æ—¶é—´æœƒæ ¹æ“šfrontmatterä¸­çš„é †åºå–å€¼\n:gitï¼šæœƒå»æŠ“gitæäº¤ç´€éŒ„çš„æ—¥æœŸï¼Œä¸”å¿…é ˆæ–¼config.ymlä¸­å•Ÿç”¨enableGitInfo = true(æ²’è©¦æˆåŠŸ) :fileModTimeï¼šæ ¹æ“šæœ¬æ©Ÿçš„æ–‡ä»¶æœ€å¾Œä¿®æ”¹ç´€éŒ„ lastmodï¼šå¯ä»¥åœ¨æ–‡ç« çš„frontmatterå€å¡Šä¸­ç›´æ¥è¨­å®š dateï¼šå¯ä»¥åœ¨æ–‡ç« çš„frontmatterå€å¡Šä¸­ç›´æ¥è¨­å®š publishDateï¼šæ–‡ç« ç™¼å¸ƒçš„æ—¥æœŸ ä¿®æ”¹ post_meta.html æ–‡ä»¶\n\u0026lt;!-- layouts/partials/post_meta.html --\u0026gt; {{ $scratch := newScratch }} {{ if not .Date.IsZero }} {{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u0026lt;span class=\u0026#34;post-meta-item\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; width=\u0026#34;16\u0026#34; height=\u0026#34;16\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34;\u0026gt;\u0026lt;rect x=\u0026#34;3\u0026#34; y=\u0026#34;4\u0026#34; width=\u0026#34;18\u0026#34; height=\u0026#34;18\u0026#34; rx=\u0026#34;2\u0026#34; ry=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;/rect\u0026gt;\u0026lt;line x1=\u0026#34;16\u0026#34; y1=\u0026#34;2\u0026#34; x2=\u0026#34;16\u0026#34; y2=\u0026#34;6\u0026#34;\u0026gt;\u0026lt;/line\u0026gt;\u0026lt;line x1=\u0026#34;8\u0026#34; y1=\u0026#34;2\u0026#34; x2=\u0026#34;8\u0026#34; y2=\u0026#34;6\u0026#34;\u0026gt;\u0026lt;/line\u0026gt;\u0026lt;line x1=\u0026#34;3\u0026#34; y1=\u0026#34;10\u0026#34; x2=\u0026#34;21\u0026#34; y2=\u0026#34;10\u0026#34;\u0026gt;\u0026lt;/line\u0026gt;\u0026lt;/svg\u0026gt; %s\u0026lt;/span\u0026gt;` (.Date | time.Format (default \u0026#34;January 2, 2006\u0026#34; site.Params.DateFormat)))) }} {{ end }} {{ if not .Lastmod.IsZero }} {{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u0026lt;span class=\u0026#34;post-meta-item\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; width=\u0026#34;16\u0026#34; height=\u0026#34;16\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M12 19l7-7 3 3-7 7-3-3z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;path d=\u0026#34;M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;path d=\u0026#34;M2 2l7.586 7.586\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;circle cx=\u0026#34;11\u0026#34; cy=\u0026#34;11\u0026#34; r=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;/circle\u0026gt;\u0026lt;/svg\u0026gt; %s\u0026lt;/span\u0026gt;` (.Lastmod | time.Format (default \u0026#34;January 2, 2006\u0026#34; site.Params.DateFormat)))) }} {{ end }} {{ if (.Param \u0026#34;ShowWordCount\u0026#34;) }} {{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u0026lt;span class=\u0026#34;post-meta-item\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; width=\u0026#34;16\u0026#34; height=\u0026#34;16\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;path d=\u0026#34;M14 2v6h6\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;line x1=\u0026#34;8\u0026#34; y1=\u0026#34;13\u0026#34; x2=\u0026#34;16\u0026#34; y2=\u0026#34;13\u0026#34;\u0026gt;\u0026lt;/line\u0026gt;\u0026lt;line x1=\u0026#34;8\u0026#34; y1=\u0026#34;17\u0026#34; x2=\u0026#34;16\u0026#34; y2=\u0026#34;17\u0026#34;\u0026gt;\u0026lt;/line\u0026gt;\u0026lt;line x1=\u0026#34;8\u0026#34; y1=\u0026#34;9\u0026#34; x2=\u0026#34;12\u0026#34; y2=\u0026#34;9\u0026#34;\u0026gt;\u0026lt;/line\u0026gt;\u0026lt;/svg\u0026gt; %s\u0026lt;/span\u0026gt;` (i18n \u0026#34;words\u0026#34; .WordCount | default (printf \u0026#34;%d words\u0026#34; .WordCount)))) }} {{ end }} {{ if (.Param \u0026#34;ShowReadingTime\u0026#34;) }} {{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u0026lt;span class=\u0026#34;post-meta-item\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; width=\u0026#34;16\u0026#34; height=\u0026#34;16\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34;\u0026gt;\u0026lt;circle cx=\u0026#34;12\u0026#34; cy=\u0026#34;12\u0026#34; r=\u0026#34;10\u0026#34;\u0026gt;\u0026lt;/circle\u0026gt;\u0026lt;polyline points=\u0026#34;12 6 12 12 16 14\u0026#34;\u0026gt;\u0026lt;/polyline\u0026gt;\u0026lt;/svg\u0026gt; %s\u0026lt;/span\u0026gt;` (i18n \u0026#34;read_time\u0026#34; .ReadingTime | default (printf \u0026#34;%d min\u0026#34; .ReadingTime)))) }} {{ end }} {{ with (partial \u0026#34;author.html\u0026#34; .) }} {{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u0026lt;span class=\u0026#34;post-meta-item\u0026#34;\u0026gt;\u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; width=\u0026#34;16\u0026#34; height=\u0026#34;16\u0026#34; viewBox=\u0026#34;0 0 24 24\u0026#34; fill=\u0026#34;none\u0026#34; stroke=\u0026#34;currentColor\u0026#34; stroke-width=\u0026#34;2\u0026#34; stroke-linecap=\u0026#34;round\u0026#34; stroke-linejoin=\u0026#34;round\u0026#34;\u0026gt;\u0026lt;path d=\u0026#34;M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\u0026#34;\u0026gt;\u0026lt;/path\u0026gt;\u0026lt;circle cx=\u0026#34;12\u0026#34; cy=\u0026#34;7\u0026#34; r=\u0026#34;4\u0026#34;\u0026gt;\u0026lt;/circle\u0026gt;\u0026lt;/svg\u0026gt; %s\u0026lt;/span\u0026gt;` .)) }} {{ end }} {{ with ($scratch.Get \u0026#34;meta\u0026#34;) }} {{ delimit . \u0026#34; ï½œ \u0026#34; | safeHTML }} {{ end }} æ·»åŠ  CSS æ ·å¼æ¥è°ƒæ•´å›¾æ ‡çš„æ˜¾ç¤ºæ•ˆæœ\n/* assests/css/extended/blank.css */ .post-meta-item { display: inline-flex; align-items: center; gap: 4px; } .post-meta-item svg { stroke: var(--secondary); } åˆ—è¡¨é¡µé¢éšè— ï¼ˆå¯é€‰ï¼‰\nè‹¥ä¸å¸Œæœ›åˆ—è¡¨é¡µå‡ºç°ReadingTimeï¼Œåˆ™å¤åˆ¶ä¸€ä»½layouts/partials/post_meta.htmlï¼Œå‘½åä¸ºpost_meta_list.htmlï¼Œå°†post_meta_list.htmlä¸­çš„å¦‚ä¸‹ä»£ç åˆ å»\n\u0026lt;!-- layouts/partials/post_meta_list.html --\u0026gt; \u0026lt;!-- åˆ æ‰ --\u0026gt; {{ if (.Param \u0026#34;ShowReadingTime\u0026#34;) }} ... {{ end }} å¹¶åœ¨layouts/_default/list.htmlä¸­å°†ï¼š\n\u0026lt;!-- layouts/_default/list.html --\u0026gt; {{- partial \u0026#34;post_meta.html\u0026#34; . -}} ä¿®æ”¹ä¸º\n\u0026lt;!-- layouts/_default/list.html --\u0026gt; {{- partial \u0026#34;post_meta_list.html\u0026#34; . -}} ä»£ç å—æ”¹è¿› ä»£ç å—ç¼©è¿›è®¾ç½® åœ¨ blank.css ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š\n/* assets/css/extended/blank.css */ .post-content pre { /* ä»£ç å—ç¼©è¿›æ ·å¼ */ margin-left: 2em; /* ç¼©è¿›è·ç¦» */ } .post-content li pre { /* åˆ—è¡¨ä¸­çš„ä»£ç å—é¢å¤–ç¼©è¿› */ margin-left: 4em; /* åˆ—è¡¨ä¸­çš„ä»£ç å—ç¼©è¿›æ›´å¤š */ } PaperMod ä¸»é¢˜çš„è¯­æ³•é«˜äº®è®¾ç½® config.yamlä¸­è®¾ç½®æ­£ç¡®çš„è¯­æ³•é«˜äº®ï¼š\nparams: # ...existing code... assets: disableHLJS: false # å¯ç”¨ highlight.js # è®¾ç½®ä»£ç é«˜äº®ä¸»é¢˜ syntax_highlighter: \u0026#34;highlight.js\u0026#34; é«˜äº®ä»£ç è¯­æ³•å¦‚ä¸‹ï¼š\nprint(\u0026#34;ç¬¬ä¸€è¡Œ\u0026#34;) print(\u0026#34;ç¬¬äºŒè¡Œ\u0026#34;) print(\u0026#34;**è¿™ä¸€è¡Œä¼šé«˜äº®**\u0026#34;) print(\u0026#34;ç¬¬å››è¡Œ\u0026#34;) é™åˆ¶ä»£ç å—é•¿åº¦ é™åˆ¶ä»£ç å—é•¿åº¦ï¼Œè¶…å‡ºéƒ¨åˆ†æ»šåŠ¨\n/* assets/css/extended/blank.css */ .post-content pre { /* ä»£ç å—ç¼©è¿›æ ·å¼ */ max-height: 400px; /* æœ€å¤§é«˜åº¦ï¼Œå¯è‡ªå®šä¹‰ */ overflow: auto; /* è¶…å‡ºéƒ¨åˆ†æ»šåŠ¨ */ } è®¾ç½®æ»šåŠ¨æ¡å¤§å°\n.post-content pre::-webkit-scrollbar { width: 10px; /* æ›´ç»†çš„æ»šåŠ¨æ¡ */ height: 10px; } åšå®¢æ–‡ç« å°é¢å›¾ç‰‡ç¼©å°å¹¶ç§»åˆ°ä¾§è¾¹ å¤åˆ¶list.html\nä»themes/PaperMod/layouts/_default/list.htmlä¸­å¤åˆ¶ä¸€ä»½list.htmlæ”¾ç½®äºlayouts/_default/list.htmlï¼Œå¹¶å°†\n\u0026lt;!-- layouts/_default/list.html --\u0026gt; \u0026lt;article class=\u0026#34;{{ $class }}\u0026#34;\u0026gt; {{- $isHidden := (.Param \u0026#34;cover.hiddenInList\u0026#34;) | default (.Param \u0026#34;cover.hidden\u0026#34;) | default false }} {{- partial \u0026#34;cover.html\u0026#34; (dict \u0026#34;cxt\u0026#34; . \u0026#34;IsSingle\u0026#34; false \u0026#34;isHidden\u0026#34; $isHidden) }} \u0026lt;header class=\u0026#34;entry-header\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;entry-hint-parent\u0026#34;\u0026gt; {{- .Title }} {{- if .Draft }} \u0026lt;span class=\u0026#34;entry-hint\u0026#34; title=\u0026#34;Draft\u0026#34;\u0026gt; \u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; height=\u0026#34;20\u0026#34; viewBox=\u0026#34;0 -960 960 960\u0026#34; fill=\u0026#34;currentColor\u0026#34;\u0026gt; \u0026lt;path d=\u0026#34;M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z\u0026#34; /\u0026gt; \u0026lt;/svg\u0026gt; \u0026lt;/span\u0026gt; {{- end }} \u0026lt;/h2\u0026gt; \u0026lt;/header\u0026gt; {{- if (ne (.Param \u0026#34;hideSummary\u0026#34;) true) }} \u0026lt;div class=\u0026#34;entry-content\u0026#34;\u0026gt; \u0026lt;p\u0026gt;{{ .Summary | plainify | htmlUnescape }}{{ if .Truncated }}...{{ end }}\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; {{- end }} {{- if not (.Param \u0026#34;hideMeta\u0026#34;) }} \u0026lt;footer class=\u0026#34;entry-footer\u0026#34;\u0026gt; {{- partial \u0026#34;post_meta.html\u0026#34; . -}} \u0026lt;/footer\u0026gt; {{- end }} \u0026lt;a class=\u0026#34;entry-link\u0026#34; aria-label=\u0026#34;post link to {{ .Title | plainify }}\u0026#34; href=\u0026#34;{{ .Permalink }}\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/article\u0026gt; ä¿®æ”¹ä¸º\n\u0026lt;!-- layouts/_default/list.html --\u0026gt; \u0026lt;article class=\u0026#34;{{ $class }}\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;post-info\u0026#34;\u0026gt; \u0026lt;header class=\u0026#34;entry-header\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;{{ .Title }}\u0026lt;/h2\u0026gt; \u0026lt;/header\u0026gt; {{- if .Description }} \u0026lt;section class=\u0026#34;entry-content\u0026#34;\u0026gt; \u0026lt;p\u0026gt;{{ .Description }}\u0026lt;/p\u0026gt; \u0026lt;/section\u0026gt; {{- else if (ne (.Param \u0026#34;hideSummary\u0026#34;) true) }} \u0026lt;section class=\u0026#34;entry-content\u0026#34;\u0026gt; \u0026lt;p\u0026gt;{{ .Summary | plainify | htmlUnescape }}{{ if .Truncated }}...{{ end }}\u0026lt;/p\u0026gt; \u0026lt;/section\u0026gt; {{- end }} {{- if not (.Param \u0026#34;hideMeta\u0026#34;) }} \u0026lt;footer class=\u0026#34;entry-footer\u0026#34;\u0026gt; {{- partial \u0026#34;post_meta.html\u0026#34; . -}} \u0026lt;/footer\u0026gt; {{- end }} \u0026lt;/div\u0026gt; {{- $isHidden := (.Param \u0026#34;cover.hiddenInList\u0026#34;) | default (.Param \u0026#34;cover.hidden\u0026#34;) | default false }} {{- partial \u0026#34;cover.html\u0026#34; (dict \u0026#34;cxt\u0026#34; . \u0026#34;IsHome\u0026#34; true \u0026#34;isHidden\u0026#34; $isHidden) }} \u0026lt;a class=\u0026#34;entry-link\u0026#34; aria-label=\u0026#34;post link to {{ .Title | plainify }}\u0026#34; href=\u0026#34;{{ .Permalink }}\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/article\u0026gt; æ·»åŠ è‡ªå®šä¹‰æ ·å¼\n/* assets/css/extended/blank.css */ .post-entry { display: flex; flex-direction: row; align-items: center; } .entry-cover { overflow: hidden; /* padding-left: 18px; */ height: 100%; width: 50%; margin-bottom: unset; border-radius: 12px; /* ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´åœ†è§’å¤§å° */ } .entry-cover img { border-radius: 12px; } .post-info { display: inline-block; overflow: hidden; width: 90%; } ä¾§è¾¹é¦–å›¾æ”¾å¤§åŠ¨ç”»\n/* assets/css/extended/blank.css */ .post-entry img{ transition: all 0.3s ease-out; transform:scale(1,1); } .post-entry:hover img{ transition: all 0.3s ease-out; transform:scale(1.02,1.02); } è‡ªå®šä¹‰ Post Footer å¤åˆ¶single.html åœ¨è·¯å¾„themes/PaperMod/layouts/_defaultæ‰¾åˆ°single.htmlè¿™ä¸ªæ–‡ä»¶ï¼Œå¤åˆ¶åˆ°layouts/_default/single.htmlè¿™ä¸ªä½ç½®\nä¿®æ”¹post-footeræ®µè½ æ‰¾åˆ°\n\u0026lt;!-- layouts/_default/single.html --\u0026gt; \u0026lt;footer class=\u0026#34;post-footer\u0026#34;\u0026gt; ... \u0026lt;/footer\u0026gt; ä¿®æ”¹ä¸º\n\u0026lt;!-- layouts/_default/single.html --\u0026gt; \u0026lt;footer class=\u0026#34;post-footer\u0026#34;\u0026gt; {{- $tags := .Language.Params.Taxonomies.tag | default \u0026#34;tags\u0026#34; }} \u0026lt;p style=\u0026#34;font-size: medium; margin-bottom: 5px; font-weight: bold;\u0026#34;\u0026gt;tags:\u0026lt;/p\u0026gt; \u0026lt;ul class=\u0026#34;post-tags\u0026#34;\u0026gt; {{- range ($.GetTerms $tags) }} \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;{{ .Permalink }}\u0026#34;\u0026gt;{{ .LinkTitle }}\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; {{- end }} \u0026lt;/ul\u0026gt; {{- $categories := .Language.Params.Taxonomies.categories | default \u0026#34;categories\u0026#34; }} \u0026lt;p style=\u0026#34;font-size: medium; margin-bottom: 5px; font-weight: bold;\u0026#34;\u0026gt;categories:\u0026lt;/p\u0026gt; \u0026lt;ul class=\u0026#34;post-tags\u0026#34;\u0026gt; {{- range ($.GetTerms $categories) }} \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;{{ .Permalink }}\u0026#34;\u0026gt;{{ .LinkTitle }}\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; {{- end }} \u0026lt;/ul\u0026gt; {{- if (.Param \u0026#34;ShowPostNavLinks\u0026#34;) }} {{- partial \u0026#34;post_nav_links.html\u0026#34; . }} {{- end }} {{- if (and site.Params.ShowShareButtons (ne .Params.disableShare true)) }} {{- partial \u0026#34;share_icons.html\u0026#34; . -}} {{- end }} \u0026lt;/footer\u0026gt; æ•ˆæœ åšå®¢æœ«å°¾æ”¾å‚è€ƒé“¾æ¥ åœ¨blank.cssé‡ŒåŠ ä¸€ç‚¹æ ·å¼\n/* assets/css/extended/blank.css */ /* æµ…è‰²æ¨¡å¼ */ .zhihu-ref { background: #f6f7fa; border-radius: 8px; padding: 1.2em 1.5em 1.2em 1.5em; margin-top: 2em; font-size: 1em; box-shadow: 0 2px 8px rgba(0,0,0,0.03); border-left: 4px solid #0084ff; transition: background 0.3s, border-color 0.3s; } .zhihu-ref-title { font-weight: bold; color: #175199; margin-bottom: 0.5em; font-size: 1.1em; } .zhihu-ref a { color: #175199; } .zhihu-ref a:hover { color: #0084ff; } /* æ·±è‰²æ¨¡å¼ï¼ˆPaperModä¸»é¢˜æ·±è‰²classä¸º .darkï¼‰ */ .dark .zhihu-ref { background: #23272e; border-left: 4px solid #3ea6ff; } .dark .zhihu-ref-title, .dark .zhihu-ref a { color: #3ea6ff; } .dark .zhihu-ref a:hover { color: #8cc8ff; } markdownä¸­è¯­æ³•å¦‚ä¸‹\n\u0026lt;hr\u0026gt; \u0026lt;div class=\u0026#34;references\u0026#34;\u0026gt; \u0026lt;h3\u0026gt;å‚è€ƒèµ„æ–™\u0026lt;/h3\u0026gt; \u0026lt;ol\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;https://gohugo.io/documentation/\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Hugo å®˜æ–¹æ–‡æ¡£\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;https://github.com/adityatelange/hugo-PaperMod\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;PaperMod ä¸»é¢˜\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;https://www.markdownguide.org/\u0026#34; target=\u0026#34;_blank\u0026#34;\u0026gt;Markdown Guide\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ol\u0026gt; \u0026lt;/div\u0026gt; æ•ˆæœå¦‚ä¸‹\nä¾§è¾¹ç›®å½•è®¾ç½® åœ¨layouts/partialsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºtoc.htmlï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\n\u0026lt;!-- layouts/partials/toc.html --\u0026gt; {{- $headers := findRE \u0026#34;\u0026lt;h[1-6].*?\u0026gt;(.|\\n])+?\u0026lt;/h[1-6]\u0026gt;\u0026#34; .Content -}} {{- $has_headers := ge (len $headers) 1 -}} {{- if $has_headers -}} \u0026lt;aside id=\u0026#34;toc-container\u0026#34; class=\u0026#34;toc-container wide\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;toc\u0026#34;\u0026gt; \u0026lt;details {{if (.Param \u0026#34;TocOpen\u0026#34;) }} open{{ end }}\u0026gt; \u0026lt;summary accesskey=\u0026#34;c\u0026#34; title=\u0026#34;(Alt + C)\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;details\u0026#34;\u0026gt;{{- i18n \u0026#34;toc\u0026#34; | default \u0026#34;Table of Contents\u0026#34; }}\u0026lt;/span\u0026gt; \u0026lt;/summary\u0026gt; \u0026lt;div class=\u0026#34;inner\u0026#34;\u0026gt; {{- $largest := 6 -}} {{- range $headers -}} {{- $headerLevel := index (findRE \u0026#34;[1-6]\u0026#34; . 1) 0 -}} {{- $headerLevel := len (seq $headerLevel) -}} {{- if lt $headerLevel $largest -}} {{- $largest = $headerLevel -}} {{- end -}} {{- end -}} {{- $firstHeaderLevel := len (seq (index (findRE \u0026#34;[1-6]\u0026#34; (index $headers 0) 1) 0)) -}} {{- $.Scratch.Set \u0026#34;bareul\u0026#34; slice -}} \u0026lt;ul\u0026gt; {{- range seq (sub $firstHeaderLevel $largest) -}} \u0026lt;ul\u0026gt; {{- $.Scratch.Add \u0026#34;bareul\u0026#34; (sub (add $largest .) 1) -}} {{- end -}} {{- range $i, $header := $headers -}} {{- $headerLevel := index (findRE \u0026#34;[1-6]\u0026#34; . 1) 0 -}} {{- $headerLevel := len (seq $headerLevel) -}} {{/* get id=\u0026#34;xyz\u0026#34; */}} {{- $id := index (findRE \u0026#34;(id=\\\u0026#34;(.*?)\\\u0026#34;)\u0026#34; $header 9) 0 }} {{- /* strip id=\u0026#34;\u0026#34; to leave xyz, no way to get regex capturing groups in hugo */ -}} {{- $cleanedID := replace (replace $id \u0026#34;id=\\\u0026#34;\u0026#34; \u0026#34;\u0026#34;) \u0026#34;\\\u0026#34;\u0026#34; \u0026#34;\u0026#34; }} {{- $header := replaceRE \u0026#34;\u0026lt;h[1-6].*?\u0026gt;((.|\\n])+?)\u0026lt;/h[1-6]\u0026gt;\u0026#34; \u0026#34;$1\u0026#34; $header -}} {{- if ne $i 0 -}} {{- $prevHeaderLevel := index (findRE \u0026#34;[1-6]\u0026#34; (index $headers (sub $i 1)) 1) 0 -}} {{- $prevHeaderLevel := len (seq $prevHeaderLevel) -}} {{- if gt $headerLevel $prevHeaderLevel -}} {{- range seq $prevHeaderLevel (sub $headerLevel 1) -}} \u0026lt;ul\u0026gt; {{/* the first should not be recorded */}} {{- if ne $prevHeaderLevel . -}} {{- $.Scratch.Add \u0026#34;bareul\u0026#34; . -}} {{- end -}} {{- end -}} {{- else -}} \u0026lt;/li\u0026gt; {{- if lt $headerLevel $prevHeaderLevel -}} {{- range seq (sub $prevHeaderLevel 1) -1 $headerLevel -}} {{- if in ($.Scratch.Get \u0026#34;bareul\u0026#34;) . -}} \u0026lt;/ul\u0026gt; {{/* manually do pop item */}} {{- $tmp := $.Scratch.Get \u0026#34;bareul\u0026#34; -}} {{- $.Scratch.Delete \u0026#34;bareul\u0026#34; -}} {{- $.Scratch.Set \u0026#34;bareul\u0026#34; slice}} {{- range seq (sub (len $tmp) 1) -}} {{- $.Scratch.Add \u0026#34;bareul\u0026#34; (index $tmp (sub . 1)) -}} {{- end -}} {{- else -}} \u0026lt;/ul\u0026gt; \u0026lt;/li\u0026gt; {{- end -}} {{- end -}} {{- end -}} {{- end }} \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#{{- $cleanedID -}}\u0026#34; aria-label=\u0026#34;{{- $header | plainify -}}\u0026#34;\u0026gt;{{- $header | safeHTML -}}\u0026lt;/a\u0026gt; {{- else }} \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#{{- $cleanedID -}}\u0026#34; aria-label=\u0026#34;{{- $header | plainify -}}\u0026#34;\u0026gt;{{- $header | safeHTML -}}\u0026lt;/a\u0026gt; {{- end -}} {{- end -}} \u0026lt;!-- {{- $firstHeaderLevel := len (seq (index (findRE \u0026#34;[1-6]\u0026#34; (index $headers 0) 1) 0)) -}} --\u0026gt; {{- $firstHeaderLevel := $largest }} {{- $lastHeaderLevel := len (seq (index (findRE \u0026#34;[1-6]\u0026#34; (index $headers (sub (len $headers) 1)) 1) 0)) }} \u0026lt;/li\u0026gt; {{- range seq (sub $lastHeaderLevel $firstHeaderLevel) -}} {{- if in ($.Scratch.Get \u0026#34;bareul\u0026#34;) (add . $firstHeaderLevel) }} \u0026lt;/ul\u0026gt; {{- else }} \u0026lt;/ul\u0026gt; \u0026lt;/li\u0026gt; {{- end -}} {{- end }} \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/details\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/aside\u0026gt; \u0026lt;script\u0026gt; let activeElement; let elements; window.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, function (event) { checkTocPosition(); elements = document.querySelectorAll(\u0026#39;h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]\u0026#39;); // Make the first header active activeElement = elements[0]; const id = encodeURI(activeElement.getAttribute(\u0026#39;id\u0026#39;)).toLowerCase(); document.querySelector(`.inner ul li a[href=\u0026#34;#${id}\u0026#34;]`).classList.add(\u0026#39;active\u0026#39;); }, false); window.addEventListener(\u0026#39;resize\u0026#39;, function(event) { checkTocPosition(); }, false); window.addEventListener(\u0026#39;scroll\u0026#39;, () =\u0026gt; { // Check if there is an object in the top half of the screen or keep the last item active activeElement = Array.from(elements).find((element) =\u0026gt; { if ((getOffsetTop(element) - window.pageYOffset) \u0026gt; 0 \u0026amp;\u0026amp; (getOffsetTop(element) - window.pageYOffset) \u0026lt; window.innerHeight/2) { return element; } }) || activeElement elements.forEach(element =\u0026gt; { const id = encodeURI(element.getAttribute(\u0026#39;id\u0026#39;)).toLowerCase(); if (element === activeElement){ document.querySelector(`.inner ul li a[href=\u0026#34;#${id}\u0026#34;]`).classList.add(\u0026#39;active\u0026#39;); } else { document.querySelector(`.inner ul li a[href=\u0026#34;#${id}\u0026#34;]`).classList.remove(\u0026#39;active\u0026#39;); } }) }, false); const main = parseInt(getComputedStyle(document.body).getPropertyValue(\u0026#39;--article-width\u0026#39;), 10); const toc = parseInt(getComputedStyle(document.body).getPropertyValue(\u0026#39;--toc-width\u0026#39;), 10); const gap = parseInt(getComputedStyle(document.body).getPropertyValue(\u0026#39;--gap\u0026#39;), 10); function checkTocPosition() { const width = document.body.scrollWidth; if (width - main - (toc * 2) - (gap * 4) \u0026gt; 0) { document.getElementById(\u0026#34;toc-container\u0026#34;).classList.add(\u0026#34;wide\u0026#34;); } else { document.getElementById(\u0026#34;toc-container\u0026#34;).classList.remove(\u0026#34;wide\u0026#34;); } } function getOffsetTop(element) { if (!element.getClientRects().length) { return 0; } let rect = element.getBoundingClientRect(); let win = element.ownerDocument.defaultView; return rect.top + win.pageYOffset; } \u0026lt;/script\u0026gt; {{- end }} ä¿®æ”¹css:\n/* assets/css/extended/blank.css */ :root { --nav-width: 1380px; --article-width: 650px; --toc-width: 300px; } .toc { margin: 0 2px 40px 2px; border: 1px solid var(--border); background: var(--entry); border-radius: var(--radius); padding: 0.4em; } .toc-container.wide { position: absolute; height: 100%; border-right: 1px solid var(--border); left: calc((var(--toc-width) + var(--gap)) * -1); top: calc(var(--gap) * 2); width: var(--toc-width); } .wide .toc { position: sticky; top: var(--gap); border: unset; background: unset; border-radius: unset; width: 100%; margin: 0 2px 40px 2px; } .toc details summary { cursor: zoom-in; margin-inline-start: 20px; padding: 12px 0; } .toc details[open] summary { font-weight: 500; } .toc-container.wide .toc .inner { margin: 0; } .active { font-size: 110%; font-weight: 600; } .toc ul { list-style-type: circle; } .toc .inner { margin: 0 0 0 20px; padding: 0px 15px 15px 20px; font-size: 16px; } .toc li ul { margin-inline-start: calc(var(--gap) * 0.5); list-style-type: none; } .toc li { list-style: none; font-size: 0.95rem; padding-bottom: 5px; } .toc li a:hover { color: var(--secondary); } æŒ‰ç…§LastModå‚æ•°è¿›è¡Œæ–‡ç« æ’åº Postsç•Œé¢ ä¿®æ”¹layouts/_default/list.htmlå¦‚ä¸‹\n\u0026lt;!-- layouts/_default/list.html --\u0026gt; {{- if .IsHome }} {{- $pages = where site.RegularPages \u0026#34;Type\u0026#34; \u0026#34;in\u0026#34; site.Params.mainSections }} {{- $pages = where $pages \u0026#34;Params.hiddenInHomeList\u0026#34; \u0026#34;!=\u0026#34; \u0026#34;true\u0026#34; }} {{- end }} {{- $pages := $pages.ByLastmod.Reverse }} \u0026lt;!-- æ·»åŠ è¿™è¡Œä»£ç  --\u0026gt; {{- $paginator := .Paginate $pages }} archivesç•Œé¢ å¤åˆ¶themes/PaperMod/layouts/_default/archives.htmlè‡³layouts/_defaultï¼Œå°†\n\u0026lt;!-- layouts/_default/archives.html --\u0026gt; {{- range $pages.GroupByPublishDate \u0026#34;2006\u0026#34; }} ... {{- range .Pages.GroupByDate \u0026#34;January\u0026#34; }} ... {{- range .Pages }} ... {{- end }} ... {{- end }} ... {{- end }} ä¿®æ”¹ä¸º\n\u0026lt;!-- layouts/_default/archives.html --\u0026gt; {{- range $pages.GroupByParamDate \u0026#34;lastmod\u0026#34; \u0026#34;2006\u0026#34; }} ... {{- range .Pages.GroupByParamDate \u0026#34;lastmod\u0026#34; \u0026#34;January\u0026#34; }} ... {{- range .Pages.ByLastmod.Reverse }} ... {{- end }} ... {{- end }} ... {{- end }} å‚è€ƒæ–‡çŒ® å°Må¹³ç¢ç¢å¿µ-å°Må¹³éƒ¨è½æ ¼æ•´å½¢æ‰‹è¡“ CSDN-Hugoåšå®¢PaperModä¸»é¢˜ç›®å½•æ”¾åœ¨ä¾§è¾¹ ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/hugo-papermod/","summary":"\u003ch2 id=\"è‡ªå®šä¹‰post_metaæ˜¾ç¤º\"\u003eè‡ªå®šä¹‰post_metaæ˜¾ç¤º\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eæœ€åç¼–è¾‘(Lastmod)\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eåœ¨\u003ccode\u003econfig.yaml\u003c/code\u003eä¸­æ·»åŠ ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-yaml\" data-lang=\"yaml\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003efrontmatter\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003edate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003edate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003epublishDate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003elastmod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nt\"\u003elastmod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"l\"\u003egit\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"l\"\u003efileModTime\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003elastmod\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003edate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e- \u003cspan class=\"l\"\u003epublishDate\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæœ€åç¼–è¾‘æ—¶é—´æœƒæ ¹æ“šfrontmatterä¸­çš„é †åºå–å€¼\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003e:git\u003c/code\u003eï¼šæœƒå»æŠ“gitæäº¤ç´€éŒ„çš„æ—¥æœŸï¼Œä¸”å¿…é ˆæ–¼config.ymlä¸­å•Ÿç”¨enableGitInfo = true(æ²’è©¦æˆåŠŸ)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003e:fileModTime\u003c/code\u003eï¼šæ ¹æ“šæœ¬æ©Ÿçš„æ–‡ä»¶æœ€å¾Œä¿®æ”¹ç´€éŒ„\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003elastmod\u003c/code\u003eï¼šå¯ä»¥åœ¨æ–‡ç« çš„frontmatterå€å¡Šä¸­ç›´æ¥è¨­å®š\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edate\u003c/code\u003eï¼šå¯ä»¥åœ¨æ–‡ç« çš„frontmatterå€å¡Šä¸­ç›´æ¥è¨­å®š\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epublishDate\u003c/code\u003eï¼šæ–‡ç« ç™¼å¸ƒçš„æ—¥æœŸ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eä¿®æ”¹ post_meta.html æ–‡ä»¶\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c\"\u003e\u0026lt;!-- layouts/partials/post_meta.html --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ $scratch := newScratch }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ if not .Date.IsZero }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;post-meta-item\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/svg\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eviewBox\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0 0 24 24\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003efill\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;none\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;currentColor\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-width\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linecap\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linejoin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003erect\u003c/span\u003e \u003cspan class=\"na\"\u003ex\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;4\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;18\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;18\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003erx\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ery\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003erect\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e \u003cspan class=\"na\"\u003ex1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ex2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;6\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e \u003cspan class=\"na\"\u003ex1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;8\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ex2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;8\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;6\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e \u003cspan class=\"na\"\u003ex1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;3\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;10\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ex2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;21\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;10\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e %s\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e` (.Date | time.Format (default \u0026#34;January 2, 2006\u0026#34; site.Params.DateFormat)))) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ end }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ if not .Lastmod.IsZero }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;post-meta-item\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/svg\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eviewBox\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0 0 24 24\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003efill\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;none\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;currentColor\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-width\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linecap\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linejoin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e \u003cspan class=\"na\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;M12 19l7-7 3 3-7 7-3-3z\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e \u003cspan class=\"na\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e \u003cspan class=\"na\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;M2 2l7.586 7.586\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ecircle\u003c/span\u003e \u003cspan class=\"na\"\u003ecx\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;11\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ecy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;11\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003er\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ecircle\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e %s\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e` (.Lastmod | time.Format (default \u0026#34;January 2, 2006\u0026#34; site.Params.DateFormat)))) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ end }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ if (.Param \u0026#34;ShowWordCount\u0026#34;) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;post-meta-item\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/svg\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eviewBox\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0 0 24 24\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003efill\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;none\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;currentColor\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-width\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linecap\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linejoin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e \u003cspan class=\"na\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e \u003cspan class=\"na\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;M14 2v6h6\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e \u003cspan class=\"na\"\u003ex1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;8\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;13\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ex2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;13\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e \u003cspan class=\"na\"\u003ex1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;8\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;17\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ex2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;17\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e \u003cspan class=\"na\"\u003ex1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;8\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey1\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;9\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ex2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;12\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ey2\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;9\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eline\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e %s\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e` (i18n \u0026#34;words\u0026#34; .WordCount | default (printf \u0026#34;%d words\u0026#34; .WordCount)))) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ end }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ if (.Param \u0026#34;ShowReadingTime\u0026#34;) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;post-meta-item\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/svg\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eviewBox\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0 0 24 24\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003efill\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;none\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;currentColor\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-width\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linecap\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linejoin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ecircle\u003c/span\u003e \u003cspan class=\"na\"\u003ecx\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;12\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ecy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;12\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003er\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;10\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ecircle\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003epolyline\u003c/span\u003e \u003cspan class=\"na\"\u003epoints\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;12 6 12 12 16 14\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003epolyline\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e %s\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e` (i18n \u0026#34;read_time\u0026#34; .ReadingTime | default (printf \u0026#34;%d min\u0026#34; .ReadingTime)))) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ end }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ with (partial \u0026#34;author.html\u0026#34; .) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ $scratch.Add \u0026#34;meta\u0026#34; (slice (printf `\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;post-meta-item\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e \u003cspan class=\"na\"\u003exmlns\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;http://www.w3.org/2000/svg\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003eviewBox\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;0 0 24 24\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003efill\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;none\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;currentColor\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-width\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linecap\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003estroke-linejoin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;round\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e \u003cspan class=\"na\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ecircle\u003c/span\u003e \u003cspan class=\"na\"\u003ecx\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;12\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003ecy\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;7\u0026#34;\u003c/span\u003e \u003cspan class=\"na\"\u003er\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;4\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ecircle\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003esvg\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e %s\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003espan\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e` .)) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ end }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ with ($scratch.Get \u0026#34;meta\u0026#34;) }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ delimit . \u0026#34; ï½œ \u0026#34; | safeHTML }}\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{{ end }}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eæ·»åŠ  CSS æ ·å¼æ¥è°ƒæ•´å›¾æ ‡çš„æ˜¾ç¤ºæ•ˆæœ\u003c/strong\u003e\u003c/p\u003e","title":"PaperModè¿›åŒ–è®º"},{"content":"I. CLIP å¯¹æ¯”é¢„è®­ç»ƒï¼š\nä»ç½‘ç»œä¸Šæ”¶é›†Nä¸ªå›¾ç‰‡-æ–‡æœ¬å¯¹ï¼ˆOpenAIæ”¶é›†äº†4äº¿ä¸ªå›¾ç‰‡æ–‡æœ¬å¯¹ï¼‰ä½œä¸ºæ­£æ ·æœ¬ï¼›\nNå¼ å›¾ç‰‡ä¸å‰©ä¸‹çš„N-1å¼ å›¾ç‰‡å¯¹åº”çš„æ–‡æœ¬ç»„æˆæ•°æ®å¯¹ï¼Œä½œä¸ºè´Ÿæ ·æœ¬ï¼ˆå³æ–‡æœ¬æè¿°å’Œå›¾ç‰‡å†…å®¹ä¸ç¬¦ï¼‰ï¼›\nNå¼ å›¾ç‰‡é€å…¥å›¾åƒç¼–ç å™¨ï¼Œå¯¹åº”æ–‡æœ¬é€å…¥æ–‡æœ¬ç¼–ç å™¨ï¼Œå°†å›¾åƒç‰¹å¾ä¸æ–‡æœ¬ç‰¹å¾åšç‚¹ç§¯ï¼Œå¾—åˆ°ç›¸ä¼¼åº¦çŸ©é˜µï¼›\nå°†çŸ©é˜µçš„æ¯ä¸€è¡Œå½“ä½œæ˜¯ä¸€ä¸ªNç±»é¢„æµ‹çš„ç»“æœï¼Œä»¥ç¬¬ i è¡Œä¸ºä¾‹ï¼Œä¸ºäº†ä½¿ç¬¬ i è¡Œã€ç¬¬ i åˆ—çš„å€¼æœ€å¤§ï¼ˆåœ¨ç¬¬ i è¡Œä¸­ç›¸ä¼¼åº¦æœ€å¤§ï¼‰ï¼Œæˆ‘ä»¬çš„ label åº”è¯¥ä¹Ÿæ˜¯ iï¼Œå°†ç¬¬ i è¡Œä¸ label ä½œ cross entropyï¼Œå³å¯å®ŒæˆçŸ©é˜µçš„ä¼˜åŒ–ï¼›\nå°†çŸ©é˜µçš„æ¯ä¸€åˆ—å½“ä½œæ˜¯ä¸€ä¸ªNç±»é¢„æµ‹çš„ç»“æœï¼Œä»¥ç¬¬ i åˆ—ä¸ºä¾‹ï¼Œä¸ºäº†ä½¿ç¬¬ i åˆ—ã€ç¬¬ i è¡Œçš„å€¼æœ€å¤§ï¼ˆåœ¨ç¬¬ i åˆ—ä¸­ç›¸ä¼¼åº¦æœ€å¤§ï¼‰ï¼Œæˆ‘ä»¬çš„ label åº”è¯¥ä¹Ÿæ˜¯ iï¼Œå°†ç¬¬ i åˆ—ä¸ label ä½œ cross entropyï¼Œå³å¯å®ŒæˆçŸ©é˜µçš„ä¼˜åŒ–ã€‚\nä» label ä¸­æ„å»ºæ•°æ®åˆ†ç±»å™¨ï¼š\nç”¨æ–‡æœ¬æ ‡ç­¾æ„å»ºå¥å­ï¼Œé€å…¥æ–‡æœ¬ç¼–ç å™¨å¾—åˆ°æ–‡æœ¬ç‰¹å¾ã€‚ ç”¨äºzero-shoté¢„æµ‹ï¼š\nå°†æ ‡ç­¾æ„å»ºçš„æ–‡æœ¬ç‰¹å¾ä¸å›¾åƒç‰¹å¾è¿›è¡Œç›¸ä¼¼åº¦åŒ¹é…ï¼Œä»è€Œå®Œæˆé¢„æµ‹ã€‚ II. åˆ©ç”¨CLIPåšè¯­ä¹‰åˆ†å‰² 2.1 LSeg ä¸CLIPçš„å…³ç³»ï¼š\nåˆ©ç”¨å·²ç»å¯¹é½å¥½çš„ CLIP ç‰¹å¾ç©ºé—´ï¼Œå°†è¯­ä¹‰æ ‡ç­¾å’Œåƒç´ ç‰¹å¾æ˜ å°„åˆ°åŒä¸€ç©ºé—´ï¼Œé€šè¿‡ç›¸ä¼¼æ€§è¿›è¡Œåˆ†å‰²é¢„æµ‹ï¼›\næ–‡æœ¬ç¼–ç å™¨ï¼šä¸CLIPä¿æŒä¸€è‡´ï¼Œè®­ç»ƒæ—¶ä¸æ›´æ–°å‚æ•°\u0026#x2744;\u0026#xfe0f;ï¼›\nä¸CLIPä¸åŒçš„ç‚¹ï¼š\næ–¹æ³• è®­ç»ƒæ–¹å¼ æ–‡æœ¬ç¼–ç å™¨å‚æ•° ç›¸ä¼¼åº¦è®¡ç®— CLIP å¯¹æ¯”å­¦ä¹  å¯è®­ç»ƒ è®¡ç®—å›¾åƒæ–‡æœ¬å¯¹çš„ç›¸ä¼¼åº¦ LSeg æœ‰ç›‘ç£å­¦ä¹  å†»ç»“ è®¡ç®—å›¾åƒç‰¹å¾ä¸æ–‡æœ¬ç‰¹å¾ä¹‹é—´çš„ç›¸ä¼¼åº¦ CLIPçš„è¾“å…¥ï¼šå¤šä¸ªå›¾åƒæ–‡æœ¬å¯¹ LSegçš„è¾“å…¥ï¼šä¸€å¼ å›¾åƒ+æ ‡ç­¾ï¼ˆå¯çœ‹ä½œå›¾åƒçš„æè¿°æ–‡æœ¬ï¼‰ 2.2 GroupViT ä¸CLIPå’ŒLSegçš„å…³ç³»ï¼š æ–¹æ³• è®­ç»ƒæ–¹å¼ ç›¸ä¼¼åº¦è®¡ç®— CLIP å¯¹æ¯”å­¦ä¹  è®¡ç®—å›¾åƒæ–‡æœ¬å¯¹çš„ç›¸ä¼¼åº¦ LSeg æœ‰ç›‘ç£å­¦ä¹  è®¡ç®—å›¾åƒç‰¹å¾ä¸æ–‡æœ¬ç‰¹å¾ä¹‹é—´çš„ç›¸ä¼¼åº¦ GroupViT å¯¹æ¯”å­¦ä¹  è®¡ç®—å›¾åƒæ–‡æœ¬å¯¹çš„ç›¸ä¼¼åº¦ LSegçš„è®­ç»ƒæ–¹å¼ï¼šåˆ©ç”¨å·²ç»å¯¹é½å¥½çš„ CLIP ç‰¹å¾ç©ºé—´è¿›è¡Œæœ‰ç›‘ç£è®­ç»ƒï¼› GroupViTçš„è®­ç»ƒæ–¹å¼ï¼šè°ƒæ•´CLIPä¸­è§†è§‰ç¼–ç å™¨çš„æ¶æ„ï¼Œä»¥é€‚åº”è¯­ä¹‰åˆ†å‰²ä»»åŠ¡ï¼Œè¿›è¡Œä¸CLIPä¸€è‡´çš„å¯¹æ¯”å­¦ä¹ ã€‚ æ¶æ„ç»†èŠ‚ï¼š æ¨¡å‹è¾“å…¥ï¼šå›¾åƒPatchs + å¯å­¦ä¹ Group Tokens åˆ†å‰²æµç¨‹ï¼šé€šè¿‡Group Blockå°†Patchç‰¹å¾åˆ†é…ç»™å¯å­¦ä¹ Group Tokens å¯å­¦ä¹ Group Tokensï¼šç±»ä¼¼äºèšç±»ä¸­å¿ƒ III. åˆ©ç”¨CLIPåšç›®æ ‡æ£€æµ‹ 3.1 ViLD Vanilla Detector = Head + Classifier + äº¤å‰ç†µæœ‰ç›‘ç£ ViLD-text = Head + ç›¸ä¼¼åº¦åŒ¹é… + äº¤å‰ç†µæœ‰ç›‘ç£ ç›¸ä¼¼åº¦åŒ¹é…æµç¨‹ï¼ˆCLIPæµç¨‹ï¼‰ï¼š nä¸ªæ ‡ç­¾é€šè¿‡æç¤ºè¯å·¥ç¨‹é€å…¥æ–‡æœ¬ç¼–ç å™¨å¾—åˆ°nä¸ªæ–‡æœ¬ç¼–ç ï¼› ä¸ºé˜²æ­¢æ–‡æœ¬ç¼–ç æ— æ³•æè¿°æ‰€æœ‰region embeddingsï¼Œå¼•å…¥èƒŒæ™¯ç¼–ç æè¿°å‰©ä½™çš„region embeddingsï¼› region embeddingsä¸æ–‡æœ¬ç¼–ç å’ŒèƒŒæ™¯ç¼–ç åšç›¸ä¼¼åº¦åŒ¹é…ï¼Œå¾—åˆ°nä¸ªText Embeddingså’Œä¸€ä¸ªBackgroundï¼Œè¿™ä¸€æ­¥æ›¿ä»£Classifierï¼Œä¸”åœ¨è®­ç»ƒä¸­å†»ç»“\u0026#x2744;\u0026#xfe0f;ï¼› ViLD-image = æ•™å¸ˆç½‘ç»œ + å­¦ç”Ÿç½‘ç»œ + L1çŸ¥è¯†è’¸é¦ æ•™å¸ˆç½‘ç»œï¼šCLIPå›¾åƒç¼–ç å™¨ å­¦ç”Ÿç½‘ç»œï¼šVanilla Detector ä¸ºäº†å‡å°‘è®­ç»ƒé‡ï¼Œåˆ©ç”¨é¢„è®­ç»ƒæ£€æµ‹æ¨¡å‹æå‰æå–mä¸ªregion embeddings ViLD = ViLD-text + ViLD-image IV. åˆ©ç”¨CLIPåšVisual Grounding 4.1 GLIP æœ¬è´¨ä¸ºæœ‰ç›‘ç£è®­ç»ƒï¼› è®¡ç®—Regionså’ŒWordsä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œä»è€Œå®ŒæˆRegionsçš„åˆ†ç±»/captionã€‚ æ¨¡å‹çš„è®­ç»ƒé˜¶æ®µï¼Œå¿…é¡»çŸ¥é“Regionså’ŒCaptionä¸­Wordsä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œä¸ºæ­¤ï¼š Detectionæ•°æ®é›†ï¼šåˆ©ç”¨Bounding Boxesçš„æ ‡æ³¨æ„é€ Captionï¼ˆä¾‹å¦‚Banana\u0026ndash;\u0026gt;There is a banana.ï¼‰ Captionæ•°æ®é›†ï¼šåˆ©ç”¨åœ¨Detectionæ•°æ®é›†ä¸Šè®­ç»ƒå¥½çš„GLIPæ¨¡å‹åœ¨Captionæ•°æ®é›†ä¸­æ‰¾åˆ°Regionså’ŒWordsä¹‹é—´çš„å…³ç³»ï¼Œæ„é€ ä¼ªæ ‡ç­¾ã€‚ V. åˆ©ç”¨CLIPåšå›¾åƒç”Ÿæˆ 5.1 CLIPasso å·¥ä½œå‡ºå‘ç‚¹ å‘ç°é—®é¢˜ï¼šä»¥å¾€çš„ç®€ç¬”ç”»ç”Ÿæˆæ–¹æ³•ï¼Œä»…é€‚ç”¨äºæŸä¸€ç‰¹å®šç±»åˆ«\nè§£å†³é—®é¢˜ï¼šåˆ©ç”¨CLIPæ¨¡å‹å¼ºå¤§çš„æ³›åŒ–æ€§ï¼Œå®Œæˆå¯¹æ‰€æœ‰ç±»åˆ«çš„ç®€ç¬”ç”»ç”Ÿæˆ\nå·¥ä½œæµç¨‹ ç”Ÿæˆç®€ç¬”ç”»ï¼š é¦–å…ˆåˆ©ç”¨å›¾åƒç¼–ç å™¨ï¼Œè·å–å›¾åƒçš„çƒ­å›¾ æ ¹æ®çƒ­å›¾é‡‡æ ·ç‚¹ é€šè¿‡å¯å­¦ä¹ å‚æ•°èšåˆç‚¹ï¼Œç”Ÿæˆè´å…¹æ›²çº¿ï¼Œä»è€Œè·å¾—ç®€ç¬”ç”» åˆ©ç”¨CLIPçº¦æŸç”Ÿæˆï¼š å°†ç”Ÿæˆçš„ç®€ç¬”ç”»å’ŒåŸå›¾é€å…¥ä¸¤ä¸ªä¸åŒçš„CLIPå›¾åƒç¼–ç å™¨ $L_g$çº¦æŸä¸¤å¼ å›¾çš„å‡ ä½•ä¿¡æ¯ï¼Œè¶Šæ¥è¿‘è¶Šå¥½ $L_s$çº¦æŸä¸¤å¼ å›¾çš„è¯­ä¹‰ä¿¡æ¯ï¼Œè¶Šæ¥è¿‘è¶Šå¥½ VI. åˆ©ç”¨CLIPåšè§†é¢‘æ£€ç´¢ 6.1 CLIP4Clip å·¥ä½œå‡ºå‘ç‚¹ CLIPæ˜¯ä¸ºå›¾åƒ-æ–‡æœ¬å¯¹è®¾è®¡çš„æ¨¡å‹ã€‚å¯¹äºè§†é¢‘æ£€ç´¢ä»»åŠ¡æ¥è¯´ï¼Œå…¶æœ¬è´¨ä¸Šæ˜¯ä¸€æ®µæ–‡æœ¬å’Œå¤šå¼ å›¾åƒï¼ˆè§†é¢‘å¸§ï¼‰è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°æœ€ç›¸å…³çš„è§†é¢‘å¸§ CLIP4Clipæ¢ç´¢äº†ä¸‰ç§åŒ¹é…æ–¹æ³•; Parameter-free Typeï¼šä¸éœ€è¦å‚æ•°çš„æ¨¡å—ï¼Œä¾‹å¦‚å‡å€¼æ± åŒ–ï¼ˆæ²¡è€ƒè™‘æ—¶åºï¼‰ Sequential Typeï¼šæ—¶åºæ¨¡å—ï¼Œä¾‹å¦‚LSTMå’ŒTransformer Tight Typeï¼šä½¿ç”¨ä¸€ä¸ªTransformer Encoderå…±åŒå­¦ä¹ æ–‡æœ¬ç‰¹å¾å’Œè§†é¢‘ç‰¹å¾ï¼Œè¾“å‡ºç›¸ä¼¼åº¦ 6.2 ActionCLIP ä¸CLIP4Clipç±»ä¼¼\nVII. åˆ©ç”¨CLIPåšè¯­éŸ³è¯†åˆ« 7.1 AudioCLIP æ·»åŠ éŸ³é¢‘ç¼–ç å™¨ï¼Œä»¿ç…§CLIPæ¶æ„æ„é€ éŸ³é¢‘-å›¾åƒå¯¹æ¯”å­¦ä¹ å’ŒéŸ³é¢‘-æ–‡æœ¬å¯¹æ¯”å­¦ä¹ \nVIII. åˆ©ç”¨CLIPåšä¸‰ç»´ç†è§£ 8.1 PointCLIP å°†ç‚¹äº‘æ˜ å°„åˆ°äºŒç»´ç©ºé—´ï¼› æ„é€ Promptï¼šPoint Cloud Depth Map of a [CLASS] IX. åˆ©ç”¨CLIPåšæ·±åº¦ä¼°è®¡ 9.1 DepthCLIP æ„å»ºä¸ƒç±»æ–‡æœ¬Promptï¼š\u0026ldquo;This object is [distance class]\u0026quot;ï¼Œ[distance class]ï¼š â€™giantâ€™ â€™extremely closeâ€™ â€™closeâ€™ â€™not in distanceâ€™ â€™a little remoteâ€™ â€™farâ€™ â€™unseenâ€™ ç½‘ç»œç»“æ„ä¸LSegç±»ä¼¼ï¼Œé€šè¿‡Softmaxå®Œæˆåˆ†ç±»é¢„æµ‹ å‚è€ƒæ–‡çŒ® CLIP æ”¹è¿›å·¥ä½œä¸²è®²ï¼ˆä¸Šï¼‰ã€è®ºæ–‡ç²¾è¯»Â·42ã€‘ CLIP æ”¹è¿›å·¥ä½œä¸²è®²ï¼ˆä¸‹ï¼‰ã€è®ºæ–‡ç²¾è¯»Â·42ã€‘ ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/clip/","summary":"\u003ch2 id=\"i-clip\"\u003eI. CLIP\u003c/h2\u003e\n\u003cp align=\"center\"\u003e\n  \u003cimg src=\"clip.png\" alt=\"clip\" /\u003e\n\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eå¯¹æ¯”é¢„è®­ç»ƒï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eä»ç½‘ç»œä¸Šæ”¶é›†Nä¸ªå›¾ç‰‡-æ–‡æœ¬å¯¹ï¼ˆOpenAIæ”¶é›†äº†4äº¿ä¸ªå›¾ç‰‡æ–‡æœ¬å¯¹ï¼‰ä½œä¸ºæ­£æ ·æœ¬ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNå¼ å›¾ç‰‡ä¸å‰©ä¸‹çš„N-1å¼ å›¾ç‰‡å¯¹åº”çš„æ–‡æœ¬ç»„æˆæ•°æ®å¯¹ï¼Œä½œä¸ºè´Ÿæ ·æœ¬ï¼ˆå³æ–‡æœ¬æè¿°å’Œå›¾ç‰‡å†…å®¹ä¸ç¬¦ï¼‰ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eNå¼ å›¾ç‰‡é€å…¥å›¾åƒç¼–ç å™¨ï¼Œå¯¹åº”æ–‡æœ¬é€å…¥æ–‡æœ¬ç¼–ç å™¨ï¼Œå°†å›¾åƒç‰¹å¾ä¸æ–‡æœ¬ç‰¹å¾åšç‚¹ç§¯ï¼Œå¾—åˆ°ç›¸ä¼¼åº¦çŸ©é˜µï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå°†çŸ©é˜µçš„æ¯ä¸€è¡Œå½“ä½œæ˜¯ä¸€ä¸ªNç±»é¢„æµ‹çš„ç»“æœï¼Œä»¥ç¬¬ i è¡Œä¸ºä¾‹ï¼Œä¸ºäº†ä½¿ç¬¬ i è¡Œã€ç¬¬ i åˆ—çš„å€¼æœ€å¤§ï¼ˆåœ¨ç¬¬ i è¡Œä¸­ç›¸ä¼¼åº¦æœ€å¤§ï¼‰ï¼Œæˆ‘ä»¬çš„ label åº”è¯¥ä¹Ÿæ˜¯ iï¼Œå°†ç¬¬ i è¡Œä¸ label ä½œ cross entropyï¼Œå³å¯å®ŒæˆçŸ©é˜µçš„ä¼˜åŒ–ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå°†çŸ©é˜µçš„æ¯ä¸€åˆ—å½“ä½œæ˜¯ä¸€ä¸ªNç±»é¢„æµ‹çš„ç»“æœï¼Œä»¥ç¬¬ i åˆ—ä¸ºä¾‹ï¼Œä¸ºäº†ä½¿ç¬¬ i åˆ—ã€ç¬¬ i è¡Œçš„å€¼æœ€å¤§ï¼ˆåœ¨ç¬¬ i åˆ—ä¸­ç›¸ä¼¼åº¦æœ€å¤§ï¼‰ï¼Œæˆ‘ä»¬çš„ label åº”è¯¥ä¹Ÿæ˜¯ iï¼Œå°†ç¬¬ i åˆ—ä¸ label ä½œ cross entropyï¼Œå³å¯å®ŒæˆçŸ©é˜µçš„ä¼˜åŒ–ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä» label ä¸­æ„å»ºæ•°æ®åˆ†ç±»å™¨ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨æ–‡æœ¬æ ‡ç­¾æ„å»ºå¥å­ï¼Œé€å…¥æ–‡æœ¬ç¼–ç å™¨å¾—åˆ°æ–‡æœ¬ç‰¹å¾ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eç”¨äºzero-shoté¢„æµ‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå°†æ ‡ç­¾æ„å»ºçš„æ–‡æœ¬ç‰¹å¾ä¸å›¾åƒç‰¹å¾è¿›è¡Œç›¸ä¼¼åº¦åŒ¹é…ï¼Œä»è€Œå®Œæˆé¢„æµ‹ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"ii-åˆ©ç”¨clipåšè¯­ä¹‰åˆ†å‰²\"\u003eII. åˆ©ç”¨CLIPåšè¯­ä¹‰åˆ†å‰²\u003c/h2\u003e\n\u003ch3 id=\"21-lseg\"\u003e2.1 LSeg\u003c/h3\u003e\n\u003cp align=\"center\"\u003e\n  \u003cimg src=\"lseg.png\" alt=\"lseg\" /\u003e\n\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eä¸CLIPçš„å…³ç³»ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eåˆ©ç”¨å·²ç»å¯¹é½å¥½çš„ CLIP ç‰¹å¾ç©ºé—´ï¼Œå°†è¯­ä¹‰æ ‡ç­¾å’Œåƒç´ ç‰¹å¾æ˜ å°„åˆ°åŒä¸€ç©ºé—´ï¼Œé€šè¿‡ç›¸ä¼¼æ€§è¿›è¡Œåˆ†å‰²é¢„æµ‹ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæ–‡æœ¬ç¼–ç å™¨ï¼šä¸CLIPä¿æŒä¸€è‡´ï¼Œè®­ç»ƒæ—¶ä¸æ›´æ–°å‚æ•°\u0026#x2744;\u0026#xfe0f;ï¼›\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eä¸CLIPä¸åŒçš„ç‚¹ï¼š\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eæ–¹æ³•\u003c/th\u003e\n          \u003cth\u003eè®­ç»ƒæ–¹å¼\u003c/th\u003e\n          \u003cth\u003eæ–‡æœ¬ç¼–ç å™¨å‚æ•°\u003c/th\u003e\n          \u003cth\u003eç›¸ä¼¼åº¦è®¡ç®—\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eCLIP\u003c/td\u003e\n          \u003ctd\u003eå¯¹æ¯”å­¦ä¹ \u003c/td\u003e\n          \u003ctd\u003eå¯è®­ç»ƒ\u003c/td\u003e\n          \u003ctd\u003eè®¡ç®—å›¾åƒæ–‡æœ¬å¯¹çš„ç›¸ä¼¼åº¦\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003eLSeg\u003c/td\u003e\n          \u003ctd\u003eæœ‰ç›‘ç£å­¦ä¹ \u003c/td\u003e\n          \u003ctd\u003eå†»ç»“\u003c/td\u003e\n          \u003ctd\u003eè®¡ç®—å›¾åƒç‰¹å¾ä¸æ–‡æœ¬ç‰¹å¾ä¹‹é—´çš„ç›¸ä¼¼åº¦\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cul\u003e\n\u003cli\u003eCLIPçš„è¾“å…¥ï¼šå¤šä¸ªå›¾åƒæ–‡æœ¬å¯¹\u003c/li\u003e\n\u003cli\u003eLSegçš„è¾“å…¥ï¼šä¸€å¼ å›¾åƒ+æ ‡ç­¾ï¼ˆå¯çœ‹ä½œå›¾åƒçš„æè¿°æ–‡æœ¬ï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"22-groupvit\"\u003e2.2 GroupViT\u003c/h3\u003e\n\u003cp align=\"center\"\u003e\n  \u003cimg src=\"groupvit_overview.png\" alt=\"groupvit_overview\" width=\"50%\" /\u003e\n\u003c/p\u003e","title":"CLIPåŠå…¶æ”¹è¿›å·¥ä½œ"},{"content":"screenåŸºæœ¬å‘½ä»¤ æ–°å»ºä¸€ä¸ªscreenä¼šè¯ screen -S \u0026lt;åå­—\u0026gt; æŸ¥çœ‹æ‰€æœ‰screenä¼šè¯ screen -ls æ¢å¤ä¹‹å‰åˆ†ç¦»çš„ä¼šè¯ screen -r \u0026lt;ä¼šè¯ID\u0026gt; é€€å‡ºå½“å‰screenä¼šè¯ é”®ç›˜ç‚¹å‡»ctrl+a , ç„¶åæŒ‰d æŸ¥çœ‹å½“å‰æ‰€åœ¨ä¼šè¯(id.name) echo $STY å…³é—­ä¼šè¯ å¦‚æœåœ¨ä¼šè¯ä¹‹ä¸­ï¼Œè¾“å…¥exitæˆ–è€…Ctrl+dæ¥ç»ˆæ­¢è¿™ä¸ªä¼šè¯ã€‚æˆåŠŸç»ˆæ­¢åï¼Œå¦‚æœæœ‰å…¶ä»–å¤„äºAttachedçŠ¶æ€çš„screenç•Œé¢ï¼Œä»–å°±ä¼šè·³åˆ°é‚£ä¸ªç•Œé¢ä¸­ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä»–å°±ä¼šè·³åˆ°é»˜è®¤ç•Œé¢ä¸Šã€‚\nåˆ é™¤ä¼šè¯\nscreen -X -S session_name quit æ¸…ç†ä¼šè¯ screen -wipe #æ¸…ç†é‚£äº›deadçš„ä¼šè¯ ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/screen/","summary":"\u003ch2 id=\"screenåŸºæœ¬å‘½ä»¤\"\u003escreenåŸºæœ¬å‘½ä»¤\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eæ–°å»ºä¸€ä¸ªscreenä¼šè¯\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003escreen -S \u0026lt;åå­—\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eæŸ¥çœ‹æ‰€æœ‰screenä¼šè¯\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003escreen -ls\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eæ¢å¤ä¹‹å‰åˆ†ç¦»çš„ä¼šè¯\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003escreen -r \u0026lt;ä¼šè¯ID\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eé€€å‡ºå½“å‰screenä¼šè¯\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eé”®ç›˜ç‚¹å‡»ctrl+a , ç„¶åæŒ‰d\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eæŸ¥çœ‹å½“å‰æ‰€åœ¨ä¼šè¯(id.name)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eecho $STY\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eå…³é—­ä¼šè¯\nå¦‚æœåœ¨ä¼šè¯ä¹‹ä¸­ï¼Œè¾“å…¥exitæˆ–è€…Ctrl+dæ¥ç»ˆæ­¢è¿™ä¸ªä¼šè¯ã€‚æˆåŠŸç»ˆæ­¢åï¼Œå¦‚æœæœ‰å…¶ä»–å¤„äºAttachedçŠ¶æ€çš„screenç•Œé¢ï¼Œä»–å°±ä¼šè·³åˆ°é‚£ä¸ªç•Œé¢ä¸­ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä»–å°±ä¼šè·³åˆ°é»˜è®¤ç•Œé¢ä¸Šã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eåˆ é™¤ä¼šè¯\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003escreen -X -S session_name quit\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003eæ¸…ç†ä¼šè¯\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003escreen -wipe #æ¸…ç†é‚£äº›deadçš„ä¼šè¯\n\u003c/code\u003e\u003c/pre\u003e","title":"ç»ˆç«¯å¤šè·¯å¤ç”¨å·¥å…·Screençš„ç”¨æ³•"},{"content":"Cross Attention æ¥è‡ªåšå®¢\nç®€ä»‹ Cross Attentionæ˜¯ï¼š\nèåˆä¸¤ç§ä¸åŒçš„åµŒå…¥åºåˆ—çš„æ³¨æ„åŠ›æœºåˆ¶ ä¸¤ä¸ªåºåˆ—å¿…é¡»åŒ…å«ç›¸åŒçš„ç»´åº¦ ä¸¤ä¸ªåºåˆ—å¯ä»¥æ¥è‡ªä¸åŒçš„æ¨¡æ€ï¼ˆä¾‹å¦‚æ–‡æœ¬ã€å›¾åƒã€å£°éŸ³ï¼‰ å…¶ä¸­ä¸€ä¸ªåºåˆ—ä½œä¸ºQueryçš„è¾“å…¥ï¼Œå†³å®šäº†è¾“å‡ºçš„é•¿åº¦ å¦ä¸€ä¸ªåºåˆ—ä½œä¸ºKeyå’ŒValueçš„è¾“å…¥ Cross Attention vs Self-attention Cross Attentionä¸Self-attentionåªæœ‰è¾“å…¥ä¸åŒã€‚Cross Attentionè¾“å…¥ä¸ºä¸¤ä¸ªç»´åº¦ç›¸åŒçš„åµŒå…¥åºåˆ—ï¼›Self-attentionè¾“å…¥ä¸ºä¸€ä¸ªåµŒå…¥åºåˆ—ï¼Œå…¶KQVå‡ç”±è¯¥åºåˆ—ç”Ÿæˆã€‚\nCross Attentionç®—æ³• æ‹¥æœ‰ä¸¤ä¸ªåºåˆ—S1ã€S2 è®¡ç®—S1çš„Kã€V è®¡ç®—S2çš„Q æ ¹æ®Kå’ŒQè®¡ç®—æ³¨æ„åŠ›çŸ©é˜µ å°†Våº”ç”¨äºæ³¨æ„åŠ›çŸ©é˜µ è¾“å‡ºçš„åºåˆ—é•¿åº¦ä¸S2ä¸€è‡´ $$ \\pmb{\\text{softmax}}((W_Q S_2)(W_K S_1)^\\mathrm{T})W_v S_1 $$\n","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/cross_attention/","summary":"\u003ch2 id=\"cross-attention\"\u003eCross Attention\u003c/h2\u003e\n\u003cp\u003eæ¥è‡ª\u003ca href=\"https://vaclavkosar.com/ml/cross-attention-in-transformer-architecture\"\u003eåšå®¢\u003c/a\u003e\u003c/p\u003e\n\u003ch3 id=\"ç®€ä»‹\"\u003eç®€ä»‹\u003c/h3\u003e\n\u003cp\u003eCross Attentionæ˜¯ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eèåˆä¸¤ç§ä¸åŒçš„åµŒå…¥åºåˆ—çš„æ³¨æ„åŠ›æœºåˆ¶\u003c/li\u003e\n\u003cli\u003eä¸¤ä¸ªåºåˆ—å¿…é¡»åŒ…å«\u003cstrong\u003eç›¸åŒçš„ç»´åº¦\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eä¸¤ä¸ªåºåˆ—å¯ä»¥æ¥è‡ªä¸åŒçš„æ¨¡æ€ï¼ˆä¾‹å¦‚æ–‡æœ¬ã€å›¾åƒã€å£°éŸ³ï¼‰\u003c/li\u003e\n\u003cli\u003eå…¶ä¸­ä¸€ä¸ªåºåˆ—ä½œä¸º\u003cstrong\u003eQueryçš„è¾“å…¥\u003c/strong\u003eï¼Œå†³å®šäº†è¾“å‡ºçš„é•¿åº¦\u003c/li\u003e\n\u003cli\u003eå¦ä¸€ä¸ªåºåˆ—ä½œä¸º\u003cstrong\u003eKeyå’ŒValueçš„è¾“å…¥\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"cross-attention-vs-self-attention\"\u003eCross Attention vs Self-attention\u003c/h3\u003e\n\u003cp\u003eCross Attentionä¸Self-attentionåªæœ‰è¾“å…¥ä¸åŒã€‚Cross Attentionè¾“å…¥ä¸ºä¸¤ä¸ªç»´åº¦ç›¸åŒçš„åµŒå…¥åºåˆ—ï¼›Self-attentionè¾“å…¥ä¸ºä¸€ä¸ªåµŒå…¥åºåˆ—ï¼Œå…¶KQVå‡ç”±è¯¥åºåˆ—ç”Ÿæˆã€‚\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"cross attention\" loading=\"lazy\" src=\"/cspaulia-blog/posts/cross_attention/cross_attention.png\"\u003e\u003c/p\u003e\n\u003ch3 id=\"cross-attentionç®—æ³•\"\u003eCross Attentionç®—æ³•\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eæ‹¥æœ‰ä¸¤ä¸ªåºåˆ—S1ã€S2\u003c/li\u003e\n\u003cli\u003eè®¡ç®—S1çš„Kã€V\u003c/li\u003e\n\u003cli\u003eè®¡ç®—S2çš„Q\u003c/li\u003e\n\u003cli\u003eæ ¹æ®Kå’ŒQè®¡ç®—æ³¨æ„åŠ›çŸ©é˜µ\u003c/li\u003e\n\u003cli\u003eå°†Våº”ç”¨äºæ³¨æ„åŠ›çŸ©é˜µ\u003c/li\u003e\n\u003cli\u003eè¾“å‡ºçš„åºåˆ—é•¿åº¦ä¸S2ä¸€è‡´\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e$$\n\\pmb{\\text{softmax}}((W_Q S_2)(W_K S_1)^\\mathrm{T})W_v S_1\n$$\u003c/p\u003e","title":"äº¤å‰æ³¨æ„åŠ›æœºåˆ¶"},{"content":"GELU $$ \\text{GELU}(x) = 0.5x(1+\\tanh(\\sqrt{\\frac{2}{\\pi}}(x+0.044715x^3))) $$\nä¼˜ç‚¹ å…·æœ‰æ›´å…‰æ»‘çš„å¯¼æ•°ï¼šGELUå‡½æ•°çš„å¯¼æ•°æ˜¯è¿ç»­çš„ï¼Œè¿™ä½¿å¾—åœ¨è®­ç»ƒæ·±åº¦ç¥ç»ç½‘ç»œæ—¶å¯ä»¥æ›´å®¹æ˜“åœ°ä¼ æ’­æ¢¯åº¦ï¼Œé¿å…äº†ReLUå‡½æ•°åœ¨$x=0$å¤„çš„å¯¼æ•°ä¸è¿ç»­çš„é—®é¢˜ï¼Œä»è€Œå‡å°‘äº†è®­ç»ƒè¿‡ç¨‹ä¸­å‡ºç°çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚ å¯ä»¥æé«˜æ¨¡å‹çš„æ€§èƒ½ï¼šåœ¨å®é™…ä»»åŠ¡ä¸­ï¼Œä½¿ç”¨GELUå‡½æ•°çš„æ¨¡å‹é€šå¸¸æ¯”ä½¿ç”¨ReLUå‡½æ•°çš„æ¨¡å‹è¡¨ç°æ›´å¥½ï¼Œå°¤å…¶æ˜¯åœ¨è‡ªç„¶è¯­è¨€å¤„ç†å’Œè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­ã€‚ å¯ä»¥åŠ é€Ÿæ”¶æ•›ï¼šGELUå‡½æ•°åœ¨æ¿€æ´»å‡½æ•°çš„éçº¿æ€§å˜æ¢ä¸­å¼•å…¥äº†ç±»ä¼¼äºsigmoidå‡½æ•°çš„å˜æ¢ï¼Œè¿™ä½¿å¾—GELUå‡½æ•°çš„è¾“å‡ºå¯ä»¥è½åœ¨ä¸€ä¸ªæ›´å¹¿çš„èŒƒå›´å†…ï¼Œæœ‰åŠ©äºåŠ é€Ÿæ¨¡å‹çš„æ”¶æ•›é€Ÿåº¦ã€‚ ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/activation/","summary":"\u003ch3 id=\"gelu\"\u003eGELU\u003c/h3\u003e\n\u003cp\u003e$$\n\\text{GELU}(x) = 0.5x(1+\\tanh(\\sqrt{\\frac{2}{\\pi}}(x+0.044715x^3)))\n$$\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"GELU_Derivative\" loading=\"lazy\" src=\"/cspaulia-blog/posts/activation/GELU_Derivative.jpg\"\u003e\u003c/p\u003e\n\u003ch4 id=\"ä¼˜ç‚¹\"\u003eä¼˜ç‚¹\u003c/h4\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eå…·æœ‰æ›´å…‰æ»‘çš„å¯¼æ•°\u003c/strong\u003eï¼šGELUå‡½æ•°çš„å¯¼æ•°æ˜¯è¿ç»­çš„ï¼Œè¿™ä½¿å¾—åœ¨è®­ç»ƒæ·±åº¦ç¥ç»ç½‘ç»œæ—¶å¯ä»¥æ›´å®¹æ˜“åœ°ä¼ æ’­æ¢¯åº¦ï¼Œé¿å…äº†ReLUå‡½æ•°åœ¨$x=0$å¤„çš„å¯¼æ•°ä¸è¿ç»­çš„é—®é¢˜ï¼Œä»è€Œå‡å°‘äº†è®­ç»ƒè¿‡ç¨‹ä¸­å‡ºç°çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå¯ä»¥æé«˜æ¨¡å‹çš„æ€§èƒ½\u003c/strong\u003eï¼šåœ¨å®é™…ä»»åŠ¡ä¸­ï¼Œä½¿ç”¨GELUå‡½æ•°çš„æ¨¡å‹é€šå¸¸æ¯”ä½¿ç”¨ReLUå‡½æ•°çš„æ¨¡å‹è¡¨ç°æ›´å¥½ï¼Œå°¤å…¶æ˜¯åœ¨è‡ªç„¶è¯­è¨€å¤„ç†å’Œè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­ã€‚\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eå¯ä»¥åŠ é€Ÿæ”¶æ•›\u003c/strong\u003eï¼šGELUå‡½æ•°åœ¨æ¿€æ´»å‡½æ•°çš„éçº¿æ€§å˜æ¢ä¸­å¼•å…¥äº†ç±»ä¼¼äºsigmoidå‡½æ•°çš„å˜æ¢ï¼Œè¿™ä½¿å¾—GELUå‡½æ•°çš„è¾“å‡ºå¯ä»¥è½åœ¨ä¸€ä¸ªæ›´å¹¿çš„èŒƒå›´å†…ï¼Œæœ‰åŠ©äºåŠ é€Ÿæ¨¡å‹çš„æ”¶æ•›é€Ÿåº¦ã€‚\u003c/li\u003e\n\u003c/ol\u003e","title":"æ”¶é›†Nä¸ªæ¿€æ´»å‡½æ•°"},{"content":"Layer Normalization åœ¨ä¸Šå›¾ä¸­ï¼Œ$N$è¡¨ç¤ºæ ·æœ¬è½´ï¼Œ$C$è¡¨ç¤ºé€šé“è½´ï¼Œ$F$æ˜¯æ¯ä¸ªé€šé“çš„ç‰¹å¾æ•°é‡ã€‚BNå¦‚å³ä¾§æ‰€ç¤ºï¼Œå®ƒæ˜¯å–ä¸åŒæ ·æœ¬çš„åŒä¸€ä¸ªé€šé“çš„ç‰¹å¾åšå½’ä¸€åŒ–ï¼›LNåˆ™æ˜¯å¦‚å·¦ä¾§æ‰€ç¤ºï¼Œå®ƒå–çš„æ˜¯åŒä¸€ä¸ªæ ·æœ¬çš„ä¸åŒé€šé“åšå½’ä¸€åŒ–\n1. BNçš„é—®é¢˜ 1.1. BNä¸Batch Size BNæ˜¯æŒ‰ç…§æ ·æœ¬æ•°è®¡ç®—å½’ä¸€åŒ–ç»Ÿè®¡é‡çš„ï¼Œå½“æ ·æœ¬æ•°å¾ˆå°‘æ—¶ï¼Œæ¯”å¦‚è¯´åªæœ‰4ä¸ªï¼Œè¿™å››ä¸ªæ ·æœ¬çš„å‡å€¼å’Œæ–¹å·®ä¾¿ä¸èƒ½åæ˜ å…¨å±€çš„ç»Ÿè®¡åˆ†å¸ƒæ¯ï¼Œæ‰€ä»¥åŸºäºå°‘é‡æ ·æœ¬çš„BNçš„æ•ˆæœä¼šå˜å¾—å¾ˆå·®ã€‚\n1.2. BNä¸RNN åœ¨ä¸€ä¸ªbatchä¸­ï¼Œé€šå¸¸å„ä¸ªæ ·æœ¬çš„é•¿åº¦éƒ½æ˜¯ä¸åŒçš„ï¼Œå½“ç»Ÿè®¡åˆ°æ¯”è¾ƒé åçš„æ—¶é—´ç‰‡æ—¶ï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­$t\u0026gt;4$æ—¶ï¼Œè¿™æ—¶åªæœ‰ä¸€ä¸ªæ ·æœ¬è¿˜æœ‰æ•°æ®ï¼ŒåŸºäºè¿™ä¸ªæ ·æœ¬çš„ç»Ÿè®¡ä¿¡æ¯ä¸èƒ½åæ˜ å…¨å±€åˆ†å¸ƒï¼Œæ‰€ä»¥è¿™æ—¶BNçš„æ•ˆæœå¹¶ä¸å¥½ã€‚\nå¦å¤–å¦‚æœåœ¨æµ‹è¯•æ—¶æˆ‘ä»¬é‡åˆ°äº†é•¿åº¦å¤§äºä»»ä½•ä¸€ä¸ªè®­ç»ƒæ ·æœ¬çš„æµ‹è¯•æ ·æœ¬ï¼Œæˆ‘ä»¬æ— æ³•æ‰¾åˆ°ä¿å­˜çš„å½’ä¸€åŒ–ç»Ÿè®¡é‡ï¼Œæ‰€ä»¥BNæ— æ³•è¿è¡Œã€‚\n2. LNè¯¦è§£ 2.1. MLPä¸­çš„LN å…ˆçœ‹MLPä¸­çš„LNã€‚è®¾$H$æ˜¯ä¸€å±‚ä¸­éšå±‚èŠ‚ç‚¹çš„æ•°é‡ï¼Œ$l$æ˜¯MLPçš„å±‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—LNçš„å½’ä¸€åŒ–ç»Ÿè®¡é‡$\\mu$å’Œ$\\sigma$ï¼š\n$$ \\mu^{l} = \\frac{1}{H} \\sum_{i=1}^{H} a^l_i ~~~~~~~ \\sigma^{l} = \\sqrt{\\frac{1}{H} \\sum_{i=1}^{H}(a^l_i-\\mu^l)^2} $$\næ³¨æ„ä¸Šé¢ç»Ÿè®¡é‡çš„è®¡ç®—æ˜¯å’Œæ ·æœ¬æ•°é‡æ²¡æœ‰å…³ç³»çš„ï¼Œå®ƒçš„æ•°é‡åªå–å†³äºéšå±‚èŠ‚ç‚¹çš„æ•°é‡ï¼Œæ‰€ä»¥åªè¦éšå±‚èŠ‚ç‚¹çš„æ•°é‡è¶³å¤Ÿå¤šï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯LNçš„å½’ä¸€åŒ–ç»Ÿè®¡é‡è¶³å¤Ÿå…·æœ‰ä»£è¡¨æ€§ã€‚é€šè¿‡$\\mu^{l}$å’Œ$\\sigma^{l}$ å¯ä»¥å¾—åˆ°å½’ä¸€åŒ–åçš„å€¼ï¼š\n$$ \\hat{a}^l = \\frac{a^l-\\mu^l}{\\sqrt{(\\sigma^l)^2+\\epsilon}} \\tag{1} $$\nå…¶ä¸­$\\epsilon$æ˜¯ä¸€ä¸ªå¾ˆå°çš„å°æ•°ï¼Œé˜²æ­¢é™¤0ã€‚\nåœ¨LNä¸­æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ç»„å‚æ•°æ¥ä¿è¯å½’ä¸€åŒ–æ“ä½œä¸ä¼šç ´åä¹‹å‰çš„ä¿¡æ¯ï¼Œåœ¨LNä¸­è¿™ç»„å‚æ•°å«åšå¢ï¼ˆgainï¼‰$g$å’Œåç½®ï¼ˆbiasï¼‰$b$ã€‚å‡è®¾æ¿€æ´»å‡½æ•°ä¸º$f$ï¼Œæœ€ç»ˆLNçš„è¾“å‡ºä¸ºï¼š\n$$ h^l = f(g^l \\odot \\hat{a}^l + b^l) \\tag{2} $$\nåˆå¹¶å…¬å¼(1)å’Œ(2)å¹¶å¿½ç•¥å‚æ•°$l$ï¼Œæœ‰ï¼š\n$$ h=f(\\frac{g}{\\sqrt{\\sigma^2+\\epsilon}} \\odot (a-\\mu) + b) $$\n2.2. RNNä¸­çš„LN å¯¹äºRNNæ—¶åˆ»$t$æ—¶çš„èŠ‚ç‚¹ï¼Œå…¶è¾“å…¥æ˜¯$t-1$æ—¶åˆ»çš„éšå±‚çŠ¶æ€$h^t$å’Œ$t$æ—¶åˆ»çš„è¾“å…¥æ•°æ®$\\text{x}_t$ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š\n$$ \\text{a}^t = W_{hh}h^{t-1}+W_{xh}\\text{x}^{t} $$\næ¥ç€æˆ‘ä»¬ä¾¿å¯ä»¥åœ¨$\\text{a}^t$ä¸Šé‡‡å–å’Œ1.1èŠ‚ä¸­å®Œå…¨ç›¸åŒçš„å½’ä¸€åŒ–è¿‡ç¨‹ï¼š\n$$ h^t=f(\\frac{g}{\\sqrt{\\sigma^2+\\epsilon}} \\odot (a^t-\\mu^t) + b) ~~~~~~ \\mu^{t} = \\frac{1}{H} \\sum_{i=1}^{H} a^t_i ~~~~~~~ \\sigma^{l} = \\sqrt{\\frac{1}{H} \\sum_{i=1}^{H}(a^t_i-\\mu^t)^2} $$\n","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/norm/","summary":"\u003ch3 id=\"layer-normalization\"\u003eLayer Normalization\u003c/h3\u003e\n\u003cp align=\"center\"\u003e\n  \u003cimg src=\"LNvsBN.jpg\" alt=\"LNvsBN\" /\u003e\n\u003c/p\u003e\n\u003cp\u003eåœ¨ä¸Šå›¾ä¸­ï¼Œ$N$è¡¨ç¤ºæ ·æœ¬è½´ï¼Œ$C$è¡¨ç¤ºé€šé“è½´ï¼Œ$F$æ˜¯æ¯ä¸ªé€šé“çš„ç‰¹å¾æ•°é‡ã€‚BNå¦‚å³ä¾§æ‰€ç¤ºï¼Œå®ƒæ˜¯å–\u003cstrong\u003eä¸åŒæ ·æœ¬çš„åŒä¸€ä¸ªé€šé“\u003c/strong\u003eçš„ç‰¹å¾åšå½’ä¸€åŒ–ï¼›LNåˆ™æ˜¯å¦‚å·¦ä¾§æ‰€ç¤ºï¼Œå®ƒå–çš„æ˜¯\u003cstrong\u003eåŒä¸€ä¸ªæ ·æœ¬çš„ä¸åŒé€šé“\u003c/strong\u003eåšå½’ä¸€åŒ–\u003c/p\u003e\n\u003ch4 id=\"1-bnçš„é—®é¢˜\"\u003e1. BNçš„é—®é¢˜\u003c/h4\u003e\n\u003ch5 id=\"11-bnä¸batch-size\"\u003e1.1. BNä¸Batch Size\u003c/h5\u003e\n\u003cp\u003eBNæ˜¯æŒ‰ç…§\u003cstrong\u003eæ ·æœ¬æ•°\u003c/strong\u003eè®¡ç®—å½’ä¸€åŒ–ç»Ÿè®¡é‡çš„ï¼Œå½“æ ·æœ¬æ•°å¾ˆå°‘æ—¶ï¼Œæ¯”å¦‚è¯´åªæœ‰4ä¸ªï¼Œè¿™å››ä¸ªæ ·æœ¬çš„å‡å€¼å’Œæ–¹å·®ä¾¿ä¸èƒ½åæ˜ å…¨å±€çš„ç»Ÿè®¡åˆ†å¸ƒæ¯ï¼Œæ‰€ä»¥åŸºäºå°‘é‡æ ·æœ¬çš„BNçš„æ•ˆæœä¼šå˜å¾—å¾ˆå·®ã€‚\u003c/p\u003e\n\u003ch5 id=\"12-bnä¸rnn\"\u003e1.2. BNä¸RNN\u003c/h5\u003e\n\u003cp align=\"center\"\u003e\n  \u003cimg src=\"RNN.jpg\" alt=\"RNN\" /\u003e\n\u003c/p\u003e\n\u003cp\u003eåœ¨ä¸€ä¸ªbatchä¸­ï¼Œé€šå¸¸å„ä¸ªæ ·æœ¬çš„é•¿åº¦éƒ½æ˜¯ä¸åŒçš„ï¼Œå½“ç»Ÿè®¡åˆ°æ¯”è¾ƒé åçš„æ—¶é—´ç‰‡æ—¶ï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­$t\u0026gt;4$æ—¶ï¼Œè¿™æ—¶åªæœ‰ä¸€ä¸ªæ ·æœ¬è¿˜æœ‰æ•°æ®ï¼ŒåŸºäºè¿™ä¸ªæ ·æœ¬çš„ç»Ÿè®¡ä¿¡æ¯ä¸èƒ½åæ˜ å…¨å±€åˆ†å¸ƒï¼Œæ‰€ä»¥è¿™æ—¶BNçš„æ•ˆæœå¹¶ä¸å¥½ã€‚\u003c/p\u003e\n\u003cp\u003eå¦å¤–å¦‚æœåœ¨æµ‹è¯•æ—¶æˆ‘ä»¬é‡åˆ°äº†é•¿åº¦å¤§äºä»»ä½•ä¸€ä¸ªè®­ç»ƒæ ·æœ¬çš„æµ‹è¯•æ ·æœ¬ï¼Œæˆ‘ä»¬æ— æ³•æ‰¾åˆ°ä¿å­˜çš„å½’ä¸€åŒ–ç»Ÿè®¡é‡ï¼Œæ‰€ä»¥BNæ— æ³•è¿è¡Œã€‚\u003c/p\u003e\n\u003ch4 id=\"2-lnè¯¦è§£\"\u003e2. LNè¯¦è§£\u003c/h4\u003e\n\u003ch5 id=\"21-mlpä¸­çš„ln\"\u003e2.1. MLPä¸­çš„LN\u003c/h5\u003e\n\u003cp\u003eå…ˆçœ‹MLPä¸­çš„LNã€‚è®¾$H$æ˜¯ä¸€å±‚ä¸­éšå±‚èŠ‚ç‚¹çš„æ•°é‡ï¼Œ$l$æ˜¯MLPçš„å±‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—LNçš„å½’ä¸€åŒ–ç»Ÿè®¡é‡$\\mu$å’Œ$\\sigma$ï¼š\u003c/p\u003e\n\u003cp\u003e$$\n\\mu^{l} = \\frac{1}{H} \\sum_{i=1}^{H} a^l_i ~~~~~~~\n\\sigma^{l} = \\sqrt{\\frac{1}{H} \\sum_{i=1}^{H}(a^l_i-\\mu^l)^2}\n$$\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ä¸Šé¢ç»Ÿè®¡é‡çš„è®¡ç®—æ˜¯å’Œæ ·æœ¬æ•°é‡æ²¡æœ‰å…³ç³»çš„ï¼Œå®ƒçš„æ•°é‡åªå–å†³äºéšå±‚èŠ‚ç‚¹çš„æ•°é‡ï¼Œæ‰€ä»¥åªè¦éšå±‚èŠ‚ç‚¹çš„æ•°é‡è¶³å¤Ÿå¤šï¼Œæˆ‘ä»¬å°±èƒ½ä¿è¯LNçš„å½’ä¸€åŒ–ç»Ÿè®¡é‡è¶³å¤Ÿå…·æœ‰ä»£è¡¨æ€§ã€‚é€šè¿‡$\\mu^{l}$å’Œ$\\sigma^{l}$\nå¯ä»¥å¾—åˆ°å½’ä¸€åŒ–åçš„å€¼ï¼š\u003c/p\u003e\n\u003cp\u003e$$\n\\hat{a}^l = \\frac{a^l-\\mu^l}{\\sqrt{(\\sigma^l)^2+\\epsilon}} \\tag{1}\n$$\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­$\\epsilon$æ˜¯ä¸€ä¸ªå¾ˆå°çš„å°æ•°ï¼Œé˜²æ­¢é™¤0ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨LNä¸­æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ç»„å‚æ•°æ¥ä¿è¯å½’ä¸€åŒ–æ“ä½œä¸ä¼šç ´åä¹‹å‰çš„ä¿¡æ¯ï¼Œåœ¨LNä¸­è¿™ç»„å‚æ•°å«åšå¢ï¼ˆgainï¼‰$g$å’Œåç½®ï¼ˆbiasï¼‰$b$ã€‚å‡è®¾æ¿€æ´»å‡½æ•°ä¸º$f$ï¼Œæœ€ç»ˆLNçš„è¾“å‡ºä¸ºï¼š\u003c/p\u003e\n\u003cp\u003e$$\nh^l = f(g^l \\odot \\hat{a}^l + b^l) \\tag{2}\n$$\u003c/p\u003e\n\u003cp\u003eåˆå¹¶å…¬å¼(1)å’Œ(2)å¹¶å¿½ç•¥å‚æ•°$l$ï¼Œæœ‰ï¼š\u003c/p\u003e\n\u003cp\u003e$$\nh=f(\\frac{g}{\\sqrt{\\sigma^2+\\epsilon}} \\odot (a-\\mu) + b)\n$$\u003c/p\u003e\n\u003ch5 id=\"22-rnnä¸­çš„ln\"\u003e2.2. RNNä¸­çš„LN\u003c/h5\u003e\n\u003cp\u003eå¯¹äºRNNæ—¶åˆ»$t$æ—¶çš„èŠ‚ç‚¹ï¼Œå…¶è¾“å…¥æ˜¯$t-1$æ—¶åˆ»çš„éšå±‚çŠ¶æ€$h^t$å’Œ$t$æ—¶åˆ»çš„è¾“å…¥æ•°æ®$\\text{x}_t$ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š\u003c/p\u003e\n\u003cp\u003e$$\n\\text{a}^t = W_{hh}h^{t-1}+W_{xh}\\text{x}^{t}\n$$\u003c/p\u003e\n\u003cp\u003eæ¥ç€æˆ‘ä»¬ä¾¿å¯ä»¥åœ¨$\\text{a}^t$ä¸Šé‡‡å–å’Œ1.1èŠ‚ä¸­å®Œå…¨ç›¸åŒçš„å½’ä¸€åŒ–è¿‡ç¨‹ï¼š\u003c/p\u003e\n\u003cp\u003e$$\nh^t=f(\\frac{g}{\\sqrt{\\sigma^2+\\epsilon}} \\odot (a^t-\\mu^t) + b) ~~~~~~\n\\mu^{t} = \\frac{1}{H} \\sum_{i=1}^{H} a^t_i ~~~~~~~\n\\sigma^{l} = \\sqrt{\\frac{1}{H} \\sum_{i=1}^{H}(a^t_i-\\mu^t)^2}\n$$\u003c/p\u003e","title":"æ”¶é›†Nä¸ªNormæ–¹æ³•"},{"content":"ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°Githubåº“ 1. åœ¨GitHubä¸Šåˆ›å»ºä»“åº“ï¼ˆè¿œç¨‹ä»“åº“ï¼‰ åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„ä»£ç ä»“åº“\n2. å®‰è£…/é…ç½®Git å®‰è£…ç•¥ï¼Œé…ç½® Gitï¼š\ngit config --global user.name \u0026quot;Your Name\u0026quot; git config --global user.email \u0026quot;your_email@example.com\u0026quot; è¿™é‡Œçš„ \u0026ldquo;Your Name\u0026rdquo; å’Œ \u0026ldquo;your_email@example.com\u0026rdquo; åˆ†åˆ«ä¸ºä½ çš„ç”¨æˆ·åå’Œé‚®ç®±åœ°å€\næ£€æŸ¥ Git æ˜¯å¦å·²ç»é…ç½®ç”¨æˆ·åå’Œé‚®ç®±ï¼š\ngit config --global user.name git config --global user.email 3. ä¸Šä¼ æ–‡ä»¶åˆ°Githubï¼ˆæœ¬åœ°ä»“åº“â€“\u0026gt;è¿œç¨‹ä»“åº“ï¼‰ åˆå§‹åŒ– Git ä»“åº“, æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit init å°† csj_project é¡¹ç›®æ–‡ä»¶å¤¹æ·»åŠ åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit add csj_project/ #æˆ–è€…è¾“å…¥ git add . å°†å½“å‰å·¥ä½œç›®å½•ä¸­çš„æ›´æ”¹ä¿å­˜åˆ°æœ¬åœ°ä»£ç ä»“åº“ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit commit -m \u0026quot;Initial commit\u0026quot; åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ï¼Œè·å–å¤åˆ¶è¯¥ä»“åº“çš„ SSH æˆ– HTTPS é“¾æ¥\nå°†æœ¬åœ°ä»“åº“ä¸è¿œç¨‹ä»“åº“è¿›è¡Œå…³è”ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit remote add origin \u0026lt;è¿œç¨‹ä»“åº“é“¾æ¥\u0026gt; \u0026lt;è¿œç¨‹ä»“åº“é“¾æ¥\u0026gt;å°±æ˜¯ä½ åˆšæ‰å¤åˆ¶çš„ä»“åº“çš„ SSH æˆ– HTTPS é“¾æ¥ï¼Œä¾‹å¦‚æˆ‘çš„å°±æ˜¯ï¼š https://github.com/CSPaulia/(åº“çš„åç§°).git å®Œæ•´å‘½ä»¤ git remote add origin https://github.com/CSPaulia/(åº“çš„åç§°).git å°†æœ¬åœ°ä»“åº“ä¸­çš„ä»£ç æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n#git push origin åˆ†æ”¯å #å®Œæ•´å‘½ä»¤ git push -u origin master ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/github-tips/","summary":"\u003ch2 id=\"ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°githubåº“\"\u003eä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°Githubåº“\u003c/h2\u003e\n\u003ch3 id=\"1-åœ¨githubä¸Šåˆ›å»ºä»“åº“è¿œç¨‹ä»“åº“\"\u003e1. åœ¨GitHubä¸Šåˆ›å»ºä»“åº“ï¼ˆè¿œç¨‹ä»“åº“ï¼‰\u003c/h3\u003e\n\u003cp\u003eåœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„ä»£ç ä»“åº“\u003c/p\u003e\n\u003ch3 id=\"2-å®‰è£…é…ç½®git\"\u003e2. å®‰è£…/é…ç½®Git\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eå®‰è£…ç•¥ï¼Œé…ç½® Gitï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e git config --global user.name \u0026quot;Your Name\u0026quot;\n git config --global user.email \u0026quot;your_email@example.com\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eè¿™é‡Œçš„ \u0026ldquo;Your Name\u0026rdquo; å’Œ \u0026ldquo;\u003ca href=\"mailto:your_email@example.com\"\u003eyour_email@example.com\u003c/a\u003e\u0026rdquo; åˆ†åˆ«ä¸ºä½ çš„ç”¨æˆ·åå’Œé‚®ç®±åœ°å€\u003c/p\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e\n\u003cp\u003eæ£€æŸ¥ Git æ˜¯å¦å·²ç»é…ç½®ç”¨æˆ·åå’Œé‚®ç®±ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e git config --global user.name\n git config --global user.email\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"3-ä¸Šä¼ æ–‡ä»¶åˆ°githubæœ¬åœ°ä»“åº“è¿œç¨‹ä»“åº“\"\u003e3. ä¸Šä¼ æ–‡ä»¶åˆ°Githubï¼ˆæœ¬åœ°ä»“åº“â€“\u0026gt;è¿œç¨‹ä»“åº“ï¼‰\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003eåˆå§‹åŒ– Git ä»“åº“, æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e git init\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå°† csj_project é¡¹ç›®æ–‡ä»¶å¤¹æ·»åŠ åˆ°æœ¬åœ°ä»“åº“ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e git add csj_project/\n #æˆ–è€…è¾“å…¥\n git add .\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå°†å½“å‰å·¥ä½œç›®å½•ä¸­çš„æ›´æ”¹ä¿å­˜åˆ°æœ¬åœ°ä»£ç ä»“åº“ä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e git commit -m \u0026quot;Initial commit\u0026quot;\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eåœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ï¼Œè·å–å¤åˆ¶è¯¥ä»“åº“çš„ SSH æˆ– HTTPS é“¾æ¥\u003c/p\u003e","title":"å¦‚ä½•ä¸Šä¼ æœ¬åœ°æ–‡ä»¶åˆ°Githubåº“"},{"content":"å›å¤æµç¨‹ æ•´ç†ç½—åˆ—æ‰€æœ‰å®¡ç¨¿äººçš„æ„è§ï¼Œå¹¶è¿›è¡Œåˆ†ç±»\nçº¦è€å¸ˆã€çº¦åŒé—¨å¸ˆå…„å§å¦¹å¼€å§‹è®¨è®ºï¼Œç»™å‡ºå›ç­”\næ•´ç†æ‰€æœ‰éœ€è¦è¡¥å……çš„å®éªŒï¼Œä¼°è®¡å¤§æ¦‚è¦ç”¨åˆ°å¤šå°‘çš„ç®—åŠ›èµ„æº\nå†™rebuttalæ–‡æ¡£\nè®ºæ®å‡†å¤‡\nç†è®ºè®ºè¯ï¼šç»™å‡ºè¯¦ç»†çš„æ¨å¯¼è¿‡ç¨‹ï¼ŒæŠŠè¿‡ç¨‹ç»™å¸ˆå…„ã€è€å¸ˆçœ‹ å®éªŒè®ºè¯ï¼šå¤šæ¬¡æ£€æŸ¥å®éªŒç»“æœ å¼•ç”¨è®ºè¯ï¼šæ˜ç¡®ç»™å‡ºè®ºæ®çš„ä½ç½®ï¼ˆæŠŠarXivçš„é“¾æ¥è´´å‡ºæ¥ï¼‰ è¡¨è¾¾è¦æ±‚\nç”¨ç¬¬äºŒäººç§°ç§°å‘¼å®¡ç¨¿äººï¼ˆæ‹‰è¿‘è·ç¦»ï¼‰ æ€åº¦è¯šæ³ã€æœ‰ç†æœ‰æ®ã€é€»è¾‘æ¸…æ™°ã€æœ‰äººæƒ…å‘³çš„è¡¨è¾¾ æ’°å†™æµç¨‹\nå…ˆå†™ä¸­æ–‡å›ç­” DeepLç¿»è¯‘ å†GPTæ¶¦è‰² å†™å®Œä¹‹åï¼Œç»™è€å¸ˆã€å¸ˆå…„è¿‡ç›®ï¼ï¼ï¼ï¼å†ç»Ÿä¸€è¿›è¡Œå›å¤ã€‚\nå¦‚æœå®¡ç¨¿äººç»§ç»­å›å¤ï¼Œåˆ™ç»§ç»­è®¨è®ºï¼š\nåŒ…æ‹¬ç»§ç»­å’Œå¸ˆå…„ã€è€å¸ˆè¿›è¡Œä¸€å¯¹ä¸€çš„äº¤æµ æ›´æ–°rebuttalæ–‡æ¡£ ","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/rebuttal/writing-tips-rebuttal/","summary":"\u003ch2 id=\"å›å¤æµç¨‹\"\u003eå›å¤æµç¨‹\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eæ•´ç†ç½—åˆ—\u003c/strong\u003eæ‰€æœ‰å®¡ç¨¿äººçš„æ„è§ï¼Œå¹¶è¿›è¡Œåˆ†ç±»\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eçº¦è€å¸ˆã€çº¦åŒé—¨å¸ˆå…„å§å¦¹å¼€å§‹\u003cstrong\u003eè®¨è®º\u003c/strong\u003eï¼Œç»™å‡ºå›ç­”\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eæ•´ç†æ‰€æœ‰éœ€è¦è¡¥å……çš„å®éªŒ\u003c/strong\u003eï¼Œä¼°è®¡å¤§æ¦‚è¦ç”¨åˆ°å¤šå°‘çš„\u003cstrong\u003eç®—åŠ›èµ„æº\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå†™rebuttalæ–‡æ¡£\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eè®ºæ®å‡†å¤‡\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç†è®ºè®ºè¯ï¼šç»™å‡ºè¯¦ç»†çš„æ¨å¯¼è¿‡ç¨‹ï¼ŒæŠŠè¿‡ç¨‹ç»™å¸ˆå…„ã€è€å¸ˆçœ‹\u003c/li\u003e\n\u003cli\u003eå®éªŒè®ºè¯ï¼šå¤šæ¬¡æ£€æŸ¥å®éªŒç»“æœ\u003c/li\u003e\n\u003cli\u003eå¼•ç”¨è®ºè¯ï¼šæ˜ç¡®ç»™å‡ºè®ºæ®çš„ä½ç½®ï¼ˆæŠŠarXivçš„é“¾æ¥è´´å‡ºæ¥ï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eè¡¨è¾¾è¦æ±‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eç”¨ç¬¬äºŒäººç§°ç§°å‘¼å®¡ç¨¿äººï¼ˆæ‹‰è¿‘è·ç¦»ï¼‰\u003c/li\u003e\n\u003cli\u003eæ€åº¦è¯šæ³ã€æœ‰ç†æœ‰æ®ã€é€»è¾‘æ¸…æ™°ã€æœ‰äººæƒ…å‘³çš„è¡¨è¾¾\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eæ’°å†™æµç¨‹\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå…ˆå†™ä¸­æ–‡å›ç­”\u003c/li\u003e\n\u003cli\u003eDeepLç¿»è¯‘\u003c/li\u003e\n\u003cli\u003eå†GPTæ¶¦è‰²\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå†™å®Œä¹‹åï¼Œ\u003cstrong\u003eç»™è€å¸ˆã€å¸ˆå…„è¿‡ç›®\u003c/strong\u003eï¼ï¼ï¼ï¼å†ç»Ÿä¸€è¿›è¡Œå›å¤ã€‚\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eå¦‚æœå®¡ç¨¿äººç»§ç»­å›å¤ï¼Œåˆ™ç»§ç»­è®¨è®ºï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eåŒ…æ‹¬ç»§ç»­å’Œå¸ˆå…„ã€è€å¸ˆè¿›è¡Œä¸€å¯¹ä¸€çš„äº¤æµ\u003c/li\u003e\n\u003cli\u003eæ›´æ–°rebuttalæ–‡æ¡£\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e","title":"è®ºæ–‡å›å¤æ–¹æ³•ï¼ˆRebuttal Methodï¼‰"},{"content":"åˆ†ç±»ä»»åŠ¡æŸå¤±å‡½æ•° äº¤å‰ç†µï¼ˆCross Entropyï¼‰ $$ \\text{H}_p(q) = \\sum_x q(x) \\log_2(\\frac{1}{p(x)}) = - \\sum_x q(x) \\log_2(p(x)) $$\näº¤å‰ç†µä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§è¡¨è¾¾ä¸¤ç§æ¦‚ç‡åˆ†å¸ƒçš„å·®å¼‚çš„æ–¹æ³•ã€‚på’Œqçš„åˆ†å¸ƒè¶Šä¸ç›¸åŒï¼Œpç›¸å¯¹äºqçš„äº¤å‰ç†µå°†è¶Šå¤§äºpçš„ç†µã€‚\nåœ¨å®é™…è®¡ç®—ä¸­ï¼Œ\n$$ \\text{L} = - \\sum_x q(y|x) \\log_2(p(y|x)) = - \\frac{1}{N} \\sum_x \\sum_c y_{xc} \\log_2(p(y_c|x)) $$\nå…¶ä¸­ï¼Œ$N$è¡¨ç¤ºæ ·æœ¬æ•°é‡ï¼Œ$x$è¡¨ç¤ºæ ·æœ¬ï¼Œ$c$è¡¨ç¤ºç±»åˆ«ï¼Œ$y_{xc}$è¡¨ç¤ºç±»åˆ«ä¸º$c$æ—¶$x$çš„é¢„æµ‹æ ‡ç­¾ï¼Œåªæœ‰$c$ä¸çœŸå®æ ‡ç­¾çš„ç±»åˆ«$\\hat{c}$ç›¸åŒæ—¶ï¼Œ$y_{x\\hat{c}} = 1$ï¼Œå³$q(y_{\\hat{c}}|x)=1/N$ï¼Œå…¶ä½™ç±»åˆ«$y_{xc} = 0$ï¼Œå³$q(y_c|x)=0/N=0$ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œ\né¢„æµ‹ï¼ˆsoftmaxå½’ä¸€åŒ–åï¼‰ çœŸå®å€¼ [0.1, 0.2, 0.7] [0, 0, 1] [0.3, 0.4, 0.3] [0, 1, 0] [0.1, 0.2, 0.7] [1, 0, 0] è®¡ç®—æŸå¤±å‡½æ•°å€¼ï¼š\n$$ \\text{sample 1 Loss} = - (0 \\times \\log{0.1} + 0 \\times \\log{0.2} + 1 \\times \\log{0.7}) = 0.36 $$\n$$ \\text{sample 2 Loss} = - (0 \\times \\log{0.3} + 1 \\times \\log{0.4} + 0 \\times \\log{0.3}) = 0.92 $$\n$$ \\text{sample 3 Loss} = - (1 \\times \\log{0.1} + 0 \\times \\log{0.2} + 0 \\times \\log{0.7}) = 2.30 $$\n$$ \\text{L} = \\frac{0.36+0.92+2.3}{3} = 1.19 $$\nKL æ•£åº¦ï¼ˆKL Divergenceï¼‰ $$ \\text{D}_{\\text{KL}}(q | p) = - \\sum_i q(x) \\log_2(p(x)) + \\sum_x p(x) \\log_2(p(x)) = \\text{H}_p(q) - \\text{H}(p) $$\nåœ¨äº¤å‰ç†µçš„åŸºç¡€ä¸Šå‡å»äº†pçš„ç†µï¼Œè¡¡é‡äº†ä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„è·ç¦»ã€‚\nåœ¨ç¥ç»ç½‘ç»œçš„è®­ç»ƒå½“ä¸­ï¼Œç”±äºpå¾€å¾€æ˜¯æ ‡ç­¾çš„åˆ†å¸ƒï¼Œpçš„ç†µå€¼æ˜¯ç¡®å®šçš„ã€‚æ‰€ä»¥KLæ•£åº¦å’Œäº¤å‰ç†µæ˜¯ç­‰ä»·çš„ã€‚ä½†æ˜¯ç”±äºäº¤å‰ç†µä¸æƒœè¦è®¡ç®—ä¿¡æ¯ç†µï¼Œè®¡ç®—æ›´åŠ ç®€å•ï¼Œæ‰€ä»¥äº¤å‰ç†µä½¿ç”¨æ›´åŠ å¹¿æ³›ã€‚\näºŒå€¼äº¤å‰ç†µï¼ˆBinary Cross Entropyï¼‰ æ¨¡å‹é¢„æµ‹ç»“æœï¼š\n$$ P_\\theta(y=1)=\\theta ~~~~~~~ P_\\theta(y=0)=1 - \\theta $$\nåˆå¹¶ä¸Šé¢ä¸¤ä¸ªå¼å­ï¼Œå¾—åˆ°ï¼š\n$$ p_\\theta(y) = \\theta^y(1-\\theta)^{(1-y)} $$\nè§‚æµ‹åˆ°è¿™äº›æ•°æ®ç‚¹çš„å¯¹æ•°ä¼¼ç„¶ä¸ºï¼š\n$$ l(\\theta) = \\log \\prod^N_{i=1} p_\\theta(y_i) = \\log \\prod^N_{i=1}\\theta^y(1-\\theta)^{(1-y)} = \\sum_{i=1}^N [y_i\\log \\theta + (1-y_i)\\log(1-\\theta)] $$\nè¿™ä¸ªæŸå¤±å‡½æ•°å°±æ˜¯$y_i$ä¸$\\theta$çš„äº¤å‰ç†µ$H_y(\\theta)$ã€‚\nå¹³è¡¡äº¤å‰ç†µï¼ˆBalenced Cross Entropyï¼‰ ä¸ºäº†è§£å†³æ ·æœ¬æ•°é‡ä¸å¹³è¡¡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ç»™Cross Entropyæ·»åŠ æƒé‡ã€‚ä»¥äºŒåˆ†ç±»é—®é¢˜ä¸¾ä¾‹ï¼ŒBinary Cross Entropyå·²ç»ä»‹ç»è¿‡Binary Cross Entropyï¼š\n$$ \\text{L} = - \\sum_{i=1}^N [y_i\\log p + (1-y_i)\\log(1-p)] $$\næ”¹å†™ä¸€ä¸‹ï¼Œ\n$$ \\text{L} = \\begin{cases} -\\log(p) \u0026amp; \\text{if}~y=1 \\\\ -\\log(1-p) \u0026amp; \\text{otherwise} \\end{cases} $$\nå†æ”¹å†™ä¸€ä¸‹ï¼Œ\n$$ p_t= \\begin{cases} \u0026amp; p \u0026amp; \\text{if}~y=1 \\\\ \u0026amp; 1-p \u0026amp; \\text{otherwise} \\end{cases} $$\n$$ \\text{L} = -\\log(p_t) $$\næ·»åŠ æƒé‡ï¼Œ\n$$ \\text{L} = -\\alpha_t\\log(p_t) $$\nå…¶ä¸­$y=1$æ—¶$\\alpha_t=\\alpha$ï¼›$y=0$æ—¶$\\alpha_t=1-\\alpha$ã€‚$\\frac{\\alpha}{1-\\alpha}=\\frac{n}{m}$ï¼Œ$n$ä¸º$y=0$çš„æ ·æœ¬ï¼ˆè´Ÿæ ·æœ¬ï¼‰ä¸ªæ•°ï¼Œ$m$ä¸º$y=1$çš„æ ·æœ¬ï¼ˆæ­£æ ·æœ¬ï¼‰ä¸ªæ•°ã€‚\nBalenced Cross Entropyç¡®å®è§£å†³äº†æ ·æœ¬ä¸å‡è¡¡é—®é¢˜ï¼Œä½†å¹¶æœªè§£å†³æ ·æœ¬éš¾æ˜“é—®é¢˜ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯¦è§Focal Loss.\nFocal Loss $$ \\text{FL}(p_t) = (1-p_t)^\\gamma\\log(p_t) $$\n$p_t$æ˜¯æ¨¡å‹é¢„æµ‹çš„ç»“æœçš„ç±»åˆ«æ¦‚ç‡å€¼ã€‚$âˆ’\\log(p_t)$å’Œäº¤å‰ç†µæŸå¤±å‡½æ•°ä¸€è‡´ï¼Œå› æ­¤å½“å‰æ ·æœ¬ç±»åˆ«å¯¹åº”çš„é‚£ä¸ª$p_t$å¦‚æœè¶Šå°ï¼Œè¯´æ˜é¢„æµ‹è¶Šä¸å‡†ç¡®ï¼Œé‚£ä¹ˆ$(1-p_t)^{\\gamma}$è¿™ä¸€é¡¹å°±ä¼šå¢å¤§ï¼Œè¿™ä¸€é¡¹ä¹Ÿä½œä¸ºå›°éš¾æ ·æœ¬çš„ç³»æ•°ï¼Œé¢„æµ‹è¶Šä¸å‡†ï¼ŒFocal Lossè¶Šå€¾å‘äºæŠŠè¿™ä¸ªæ ·æœ¬å½“ä½œå›°éš¾æ ·æœ¬ï¼Œè¿™ä¸ªç³»æ•°ä¹Ÿå°±è¶Šå¤§ï¼Œç›®çš„æ˜¯è®©å›°éš¾æ ·æœ¬å¯¹æŸå¤±å’Œæ¢¯åº¦çš„è´¡çŒ®æ›´å¤§ã€‚\nå‰é¢çš„$\\alpha_t$æ˜¯ç±»åˆ«æƒé‡ç³»æ•°ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªç±»åˆ«ä¸å¹³è¡¡çš„æ•°æ®é›†ï¼Œé‚£ä¹ˆä½ è‚¯å®šæƒ³å¯¹æ•°é‡å°‘çš„é‚£ä¸€ç±»åœ¨lossè´¡çŒ®ä¸Šèµ‹äºˆä¸€ä¸ªé«˜æƒé‡ï¼Œè¿™ä¸ª$\\alpha_t$å°±èµ·åˆ°è¿™æ ·çš„ä½œç”¨ã€‚å› æ­¤ï¼Œ$\\alpha_t$åº”è¯¥æ˜¯ä¸€ä¸ªå‘é‡ï¼Œå‘é‡çš„é•¿åº¦ç­‰äºç±»åˆ«çš„ä¸ªæ•°ï¼Œç”¨äºå­˜æ”¾å„ä¸ªç±»åˆ«çš„æƒé‡ã€‚ä¸€èˆ¬æ¥è¯´$\\alpha_t$ä¸­çš„å€¼ä¸ºæ¯ä¸€ä¸ªç±»åˆ«æ ·æœ¬æ•°é‡çš„å€’æ•°ï¼Œç›¸å½“äºå¹³è¡¡æ ·æœ¬çš„æ•°é‡å·®è·\nLovasz Loss Lovasz Lossçš„æ¨å¯¼ IoU (intersection-over-unionï¼Œä¹Ÿå«jaccard index)æ˜¯è‡ªç„¶å›¾åƒåˆ†å‰²æ¯”èµ›ä¸­å¸¸ç”¨çš„ä¸€ä¸ªè¡¡é‡åˆ†å‰²æ•ˆæœçš„è¯„ä»·æŒ‡æ ‡ï¼Œæ‰€ä»¥ä¸€ä¸ªè‡ªç„¶çš„æƒ³æ³•å°±æ˜¯èƒ½å¦å°†IoUä½œä¸ºloss functionæ¥ç›´æ¥ä¼˜åŒ–ã€‚äº¤å¹¶æ¯”å…¬å¼ï¼š\n$$ J_c(y^*, \\widetilde{y}) = \\frac{ | { y^* = c } \\cap { \\widetilde{y} = c } | }{ | { y^* = c } \\cup { \\widetilde{y} = c } | } $$\nå…¶ä¸­$y^{*}$è¡¨ç¤ºGround Truthæ ‡ç­¾ï¼Œ$\\widetilde{y}$è¡¨ç¤ºé¢„æµ‹æ ‡ç­¾ï¼Œ$\\vert \\cdot \\vert$è¡¨ç¤ºé›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚å¯ä»¥çœ‹å‡ºä¸Šå¼çš„å€¼æ˜¯ä»‹äº0åˆ°1ä¹‹é—´çš„ï¼Œç”±æ­¤å¯ä»¥è®¾è®¡å‡ºæŸå¤±å‡½æ•°ï¼š\n$$ \\Delta_{J_c}(y^{*},\\widetilde{y})=1-J_c(y^{*},\\widetilde{y}) $$\nè¿™ä¸ªæŸå¤±å‡½æ•°æ˜¯ç¦»æ•£çš„ï¼Œæ— æ³•ç›´æ¥æ±‚å¯¼ï¼Œéœ€è¦å¯¹å…¶åšå…‰æ»‘å»¶æ‹“ã€‚\næ”¹å†™ä¸€ä¸‹$\\Delta_{J_c}$,\n$$ \\Delta_{J_c} = 1-J_c(y^{*},\\widetilde{y}) = \\frac{\\vert M_c \\vert}{\\vert {y^{*}=c} \\cup M_c \\vert} \\tag{1} $$\nå…¶ä¸­ï¼Œ$M_c(y^{*},\\widetilde{y}) = {y^{*}=c,\\widetilde{y}\\neq c} \\cup {y^{*} \\neq c,\\widetilde{y}=c}$ï¼Œ$M_c$æ˜¯æŸå¤±å‡½æ•°çš„è‡ªå˜é‡ï¼Œå®ƒè¡¨è¾¾ç½‘ç»œåˆ†å‰²ç»“æœä¸Ground Truthæ ‡ç­¾ä¸åŒ¹é…çš„é›†åˆã€‚$M_c$çš„å®šä¹‰åŸŸä¸º${0,1}^p$ï¼Œå³$M_c \\in {0,1}^p$ï¼Œ$p$è¡¨ç¤ºé›†åˆ$M_c$ä¸­åƒç´ çš„ä¸ªæ•°ã€‚\nç”±äº(1)æ˜¯æ¬¡æ¨¡ï¼ˆsubmodularï¼‰å‡½æ•°ï¼Œæ•…å¯ä»¥å¯¹å…¶åšå…‰æ»‘å»¶æ‹“ã€‚\nå®šä¹‰1 è‹¥ä¸€ä¸ªé›†åˆå‡½æ•°$\\Delta:{0,1}^p \\rightarrow \\mathbb{R}$å¯¹äºæ‰€æœ‰çš„é›†åˆ$A,B \\in {0,1}^p$æ»¡è¶³\n$$ \\Delta(A) + \\Delta(B) \\geq \\Delta(A \\cup B) + \\Delta(A \\cap B) $$\nåˆ™æˆ‘ä»¬ç§°$\\Delta$æ˜¯æ¬¡æ¨¡å‡½æ•°ã€‚\nå®šä¹‰2 Lovasz extension ç°å­˜åœ¨ä¸€é›†åˆå‡½æ•°$\\Delta:{0,1}^p \\rightarrow \\mathbb{R}$ä¸”$\\Delta(\\pmb{0})=0$ï¼Œåˆ™å…¶Lovasz extensionä¸º\n$$ \\overline{\\Delta} = \\sum_{i=1}^p m_i g_i(\\pmb{m}) \\tag{2} $$\n$$ g_i(m) = \\Delta({\\pi_1,\\cdots,\\pi_i}) - \\Delta({\\pi_1,\\cdots,\\pi_{i-1}}) $$\n$\\pi$æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ ¹æ®å…ƒç´ $\\pmb{m}$é™åºæ’åºã€‚ä¾‹å¦‚ï¼Œ$x_{\\pi_1} \\geq x_{\\pi_2} \\geq \\cdots \\geq x_{\\pi_p}$ã€‚\næ­¤æ—¶$\\overline{\\Delta}$å·²ç»æ˜¯ä¸€ä¸ªè¿ç»­ã€åˆ†æ®µçº¿æ€§çš„å‡½æ•°äº†ï¼Œå¯ä»¥ç›´æ¥å¯¹è¯¯å·®$m$æ±‚å¯¼ï¼Œå¯¼æ•°ä¸º$g(m)$ã€‚\nLovasz Lossåœ¨å¤šç±»åˆ†å‰²ä¸­çš„åº”ç”¨ å‡è®¾$F_i(c)$è¡¨ç¤ºçš„æ˜¯æ¨¡å‹æœ€åè¾“å‡ºçš„åƒç´ $i$é¢„æµ‹ä¸ºç±»åˆ«$c$çš„éå½’ä¸€åŒ–åˆ†æ•°ï¼Œåˆ™å¯ä»¥é€šè¿‡softmaxå‡½æ•°å°†$F_i(c)$å½’ä¸€åŒ–å¾—åˆ°åƒç´ $i$é¢„æµ‹ä¸ºç±»åˆ«$c$çš„æ¦‚ç‡ï¼š\n$$ f_i(c) = \\frac{e^{F_i(c)}}{\\sum_{c\u0026rsquo; \\in C} e^{F_i(c\u0026rsquo;)}} $$\né‚£ä¹ˆ(2)ä¸­çš„$m_i(c)$å¯ä»¥å®šä¹‰ä¸º\n$$ m_i(c) = \\begin{cases} \u0026amp; 1-f_i(c) \u0026amp; \\text{if}~c=y_i^{*} \\\\ \u0026amp; f_i(c) \u0026amp; \\text{otherwise} \\end{cases} $$\né‚£ä¹ˆæŸå¤±å‡½æ•°ä¸º\n$$ loss(\\pmb{f}(c)) = \\overline{\\Delta_{J_c}}(\\pmb{m}(c)) $$\nè€ƒè™‘åˆ°ç±»åˆ«å¹³å‡mIoUçš„è®¡ç®—æ–¹å¼ï¼Œæœ€ç»ˆçš„æŸå¤±å‡½æ•°ä¸º\n$$ loss(\\pmb{f}) = \\frac{1}{\\vert C \\vert} \\sum_{c \\in C} \\overline{\\Delta_{J_c}}(\\pmb{m}(c)) $$\nLovasz Lossåœ¨å¤šç±»åˆ†å‰²ä¸­çš„ä»£ç æµç¨‹ æ­¥éª¤1 è®¡ç®—é¢„æµ‹ç»“æœçš„è¯¯å·®\nsigns = 2. * predictions.float() - 1. errors = (1. - logits * Variable(signs)) errors_sorted, perm = torch.sort(errors, dim=0, descending=True) è¿™ä¸€æ­¥å¾—åˆ°å…¬å¼(2)ä¸­çš„$m_i$ã€‚\næ­¥éª¤2 è®¡ç®—IoUå¾—åˆ†\ngts = gt_sorted.sum() intersection = gts - gt_sorted.float().cumsum(0) union = gts + (1 - gt_sorted).float().cumsum(0) jaccard = 1. - intersection / union è¿™ä¸€æ­¥å¾—åˆ°å…¬å¼(1)çš„å€¼ï¼Œå³IoUå¾—åˆ†ã€‚\næ­¥éª¤3 æ ¹æ®IoUå¾—åˆ†è®¡ç®—Lovasz extensionçš„æ¢¯åº¦\njaccard[1:p] = jaccard[1:p] - jaccard[0:-1] è¿™ä¸€æ­¥å¾—åˆ°å…¬å¼(2)ä¸­çš„$g_i(\\pmb{m})$ã€‚\næ­¥éª¤4 è®¡ç®—Loss\nloss = torch.dot(F.relu(errors_sorted), Variable(grad)) è¿™ä¸€æ­¥å¾—åˆ°å…¬å¼(2)çš„å€¼ã€‚\n","permalink":"https://cspaulia.github.io/cspaulia-blog/posts/loss/","summary":"\u003ch2 id=\"åˆ†ç±»ä»»åŠ¡æŸå¤±å‡½æ•°\"\u003eåˆ†ç±»ä»»åŠ¡æŸå¤±å‡½æ•°\u003c/h2\u003e\n\u003ch3 id=\"äº¤å‰ç†µcross-entropy\"\u003eäº¤å‰ç†µï¼ˆCross Entropyï¼‰\u003c/h3\u003e\n\u003cp\u003e$$\n\\text{H}_p(q) = \\sum_x q(x) \\log_2(\\frac{1}{p(x)}) = - \\sum_x q(x) \\log_2(p(x))\n$$\u003c/p\u003e\n\u003cp\u003eäº¤å‰ç†µä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§è¡¨è¾¾ä¸¤ç§æ¦‚ç‡åˆ†å¸ƒçš„å·®å¼‚çš„æ–¹æ³•ã€‚på’Œqçš„åˆ†å¸ƒè¶Šä¸ç›¸åŒï¼Œpç›¸å¯¹äºqçš„äº¤å‰ç†µå°†è¶Šå¤§äºpçš„ç†µã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨å®é™…è®¡ç®—ä¸­ï¼Œ\u003c/p\u003e\n\u003cp\u003e$$\n\\text{L} = - \\sum_x q(y|x) \\log_2(p(y|x))\n= - \\frac{1}{N} \\sum_x \\sum_c y_{xc} \\log_2(p(y_c|x))\n$$\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­ï¼Œ$N$è¡¨ç¤ºæ ·æœ¬æ•°é‡ï¼Œ$x$è¡¨ç¤ºæ ·æœ¬ï¼Œ$c$è¡¨ç¤ºç±»åˆ«ï¼Œ$y_{xc}$è¡¨ç¤ºç±»åˆ«ä¸º$c$æ—¶$x$çš„é¢„æµ‹æ ‡ç­¾ï¼Œåªæœ‰$c$ä¸çœŸå®æ ‡ç­¾çš„ç±»åˆ«$\\hat{c}$ç›¸åŒæ—¶ï¼Œ$y_{x\\hat{c}} = 1$ï¼Œå³$q(y_{\\hat{c}}|x)=1/N$ï¼Œå…¶ä½™ç±»åˆ«$y_{xc} = 0$ï¼Œå³$q(y_c|x)=0/N=0$ã€‚\u003c/p\u003e\n\u003cp\u003eä¸¾ä¸ªä¾‹å­ï¼Œ\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth style=\"text-align: center\"\u003eé¢„æµ‹ï¼ˆsoftmaxå½’ä¸€åŒ–åï¼‰\u003c/th\u003e\n          \u003cth style=\"text-align: center\"\u003eçœŸå®å€¼\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e[0.1, 0.2, 0.7]\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003e[0, 0, 1]\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e[0.3, 0.4, 0.3]\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003e[0, 1, 0]\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd style=\"text-align: center\"\u003e[0.1, 0.2, 0.7]\u003c/td\u003e\n          \u003ctd style=\"text-align: center\"\u003e[1, 0, 0]\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003eè®¡ç®—æŸå¤±å‡½æ•°å€¼ï¼š\u003c/p\u003e\n\u003cp\u003e$$\n\\text{sample 1 Loss} = - (0 \\times \\log{0.1} + 0 \\times \\log{0.2} + 1 \\times \\log{0.7}) = 0.36\n$$\u003c/p\u003e","title":"è®°å½•100ç§æŸå¤±å‡½æ•°ï¼ˆLoss Functionï¼‰"},{"content":"","permalink":"https://cspaulia.github.io/cspaulia-blog/series/","summary":"series","title":"Series"}]